{% extends "base/base.html" %}
{% load i18n %}
{% load humanize %}
{% load TRM_tags %}
{% block meta %}
    <meta name="keyword" content="{{company.name}}, Company, Jobs at {{company.name}}, Talent Aquisition, Hiring at {{company.name}}, vacancy at {{company.name}}, Recruitment at {{company.name}}, {{company.name}} Profile"/>
    <meta name="description" content="{{company.name}} Profile on SpotAxis"/>
{% endblock %}
{% block title %}{{ company.name }}{% endblock %}
{% block content %}
    {% if recruiter and recruiter.is_admin %}
        <!-- Update Image-->
        <div class="modal fade" id="updateimage-modal" role="dialog" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h5 class="modal-title">Update Logo</h5>
                    </div>
                    <div class="modal-body text-justify">
                        <form id="uploadimage-form" action="." method="post" enctype="multipart/form-data" class="mt10">
                            {% csrf_token %}
                            <input type="hidden" name="isimage" value="1">
                            <img class="img-responsive user-photo bordered company-logo" src="{{MEDIA_URL}}{{company.logo}}" alt="{{company.name}} Logo" style="margin:20px auto 20px">
                            {% if logo_form.logo.errors %}
                                <ul class="list-unstyled error-list">
                                    {% for error in logo_form.logo.errors %}
                                        <li>{{ error|escape }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            {{ logo_form.logo }}
                            <div class="mt20 text-right">
                                <button id="submit_btn" type="submit" class="btn btn-info">
                                    Update Logo
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div><!-- Update Image -->
    {%endif%}
    <div class="jumbotron no-padding bg-white pt20 pb20 collapse fade in">
        <div class="container">
            <div class="row no-margin">
                <div class="col-xs-12">
                    <div class="card-left card-large va-top mb20">
                        <img class="img-responsive bordered user-photo inline-block company-logo" src="{{ MEDIA_URL }}{{ company.logo }}" alt="{{company.name}} Logo">
                    </div>
                    <div class="inline-block card-block ml40 pt10">
                        <h2 class="text-light no-margin-y"> 
                            <span id="company-name" class="text-light">{{ company.name }}</span>
                        </h2>
                        <p>
                            <span><i class="fa fa-gears"></i> <span id="company-industry">{{ company.industry }}</span></span><br>
                            <span class="{% if not company.url %}hidden{%endif%}"><i class="fa fa-globe"></i> <a href="{{ company.url }}" target="_blank" id="company-url">{{ company.url }}</a></span><br>
                            
                        </p>
                    </div>
                    {% if request.user.is_anonymous %}
                        <a class="btn  btn-info btn-default pull-right visible-xs visible-sm" href="{% url 'auth_login' %}">Login</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <nav class="navbar navbar-affix navbar-default" id="navbar-affix">
        <div class="container-fluid" id="navbar_short">
            <ul class="nav navbar-nav">
                <li class="{% if isProfile %} active {% endif %}">
                    <a class="" href="{{request.user.recruiter.company.all.0.get_absolute_url}}">Profile</a>
                </li>
                <li class="{% if isTeam %} active {% endif %}">
                    <a class="" href="{% url 'companies_company_team_space' %}">Team</a>
                </li>
                {% if request.user.recruiter.is_admin %}
                    <li class="{% if isBilling %} active {% endif %}">
                        <a class="" href="{% url 'companies_billing' %}">Billing</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </nav>
    <div>
        {% if isProfile %}
            <section class="container-fluid text-center company-profile collapse fade in mt40 mb40" id="Profile">
                <div class="row"> 
                    <div class="col-xs-12 col-sm-4 col-md-3">
                        <div class="bg-white border-bottom border-light pl20 pr20 pt20 pb20 text-center">

                            <p class="mb5">
                                <span id="company-legal-name" class="lead">{{company.social_name}}</span>
                            </p>
                            <span class="center-block"><i class="fa fa-map-marker"></i> <span id="company-address">{% if company.city %}{{ company.city }}, {% endif %}{% if company.state %}{{ company.state }}, {% endif %}{{ company.nationality }}</span></span>
                            <span class="mb5"><i class="fa fa-phone"></i> <span id="company-phone">{{company.phone}}</span></span><br>
                            <span class="{%if not company.company_email %}hidden{%endif%}"><i class="fa fa-envelope"></i> <span id="company-email">{{ company.company_email }}</span></span><br>
                            <ul class="social-icons clearfix list-inline mt10">
                                <li class="{% if not company.linkedin %} hidden {%endif%}"><a href="{{ company.linkedin }}" target="_blank" class="btn btn-default btn-round" id="company-linkedin"><i class="fa fa-linkedin mt10"></i></a></li>
                                <li class="{% if not company.facebook %} hidden {%endif%}"><a href="{{ company.facebook }}" target="_blank" class="btn btn-default btn-round" id="company-facebook"><i class="fa fa-facebook mt10"></i></a></li>
                                <li class="{% if not company.twitter %} hidden {%endif%}"><a href="https://www.twitter.com/{{ company.twitter }}" target="_blank" class="btn btn-default btn-round" id="company-twitter"><i class="fa fa-twitter mt10"></i></a></li>
                                <li class="{% if not company.google %} hidden {%endif%}"><a href="{{ company.google }}" target="_blank" class="btn btn-default btn-round" id="company-google"><i class="fa fa-google-plus mt10"></i></a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h3 class="text-left text-light no-margin-top hidden">Description</h3>
                        <div class="bg-white border-bottom border-light br-2 pt20 pb20 pl20 pr20 text-justify">
                            <p class="pl40 pr40 wb">
                                <span id="company-description">
                                    {% if company.description %}
                                        {{ company.description|safe }}
                                    {% else %}
                                        {% trans 'No description provided' %}
                                    {% endif %}
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="border-bottom border-light br-2 pl40 pr40 pb20">
                            {%if recruiter and recruiter.is_admin %}
                                <a data-toggle="collapse" data-target=".company-profile" class="btn btn-info btn-block"><i class="fa fa-pencil"></i> {% trans 'Update Profile' %}</a>
                            {%endif%}
                        </div>
                    </div>
                </div>
            </section>
            {% if recruiter and recruiter.is_admin %}
                <section class="container company-profile form-section collapse fade mt40 mb40">
                    <div class="row">
                        <div class="col-md-8 col-md-push-2">
                            <h3 class="text-center text-light">Company Profile</h3>
                        </div>
                    </div>
                    <form id="company_form" enctype="multipart/form-data" action="." method="post" role="form" class="row mt10 mb20mb50" >
                        {% csrf_token %}
                        <div class="col-md-8 col-md-offset-2 bg-white border-bottom border-light br-2 pt20 pb20">
                            <div class="row mb20">
                                <a><img src="{{ MEDIA_URL }}{{ company.logo }}" alt="{{company.name}} Logo" class="img-responsive bordered user-photo center-block company-logo"><span class="fa fa-2x fa-camera pic-edit clickable mt15 text-info" data-toggle="modal" data-target="#updateimage-modal"></span></a>
                            </div>
                            <div class="row">
                                <!-- Tradename -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_name">{% trans 'Brand Name' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-building fa-lg"></i></div>
                                            {{ form_company.name }}
                                        </div>
                                    </div>
                                </div>
                                <!-- Business Name -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_social_name">{% trans 'Legal Name' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-building-o fa-lg"></i></div>
                                            {{ form_company.social_name }}
                                        </div>
                                    </div>
                                </div>
                            </div><!-- Tradename and Business Name -->

                            <div class="row">
                                <!-- Company Phone -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_phone">{% trans 'Phone' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-phone fa-lg"></i></div>
                                            {{ form_company.phone }}
                                        </div>
                                    </div>
                                </div>
                                <!-- Company Email -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_company_email">{% trans 'Email' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-phone fa-lg"></i></div>
                                            {{ form_company.company_email }}
                                        </div>
                                    </div>
                                </div>
                            </div><!-- Email and Phone -->

                            <div class="row">
                                <!-- Industry -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_industry">{% trans 'Industry' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-gears fa-lg"></i></div>
                                            {{ form_company.industry }}
                                        </div>
                                    </div>
                                </div>
                                <!-- Country -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_nationality">{% trans 'Country' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-gears fa-lg"></i></div>
                                            {{ form_company.nationality }}
                                        </div>
                                    </div>
                                </div>
                            </div><!-- Country and Area -->

                            <div class="row">
                                <!-- State -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_state">{% trans 'State' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-location-arrow fa-lg"></i></div>
                                            {{ form_company.state }}
                                        </div>
                                    </div>
                                </div>
                                <!-- City -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_city">{% trans 'City' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-crosshairs fa-lg"></i></div>
                                            {{ form_company.city }}
                                    </div>
                                </div>
                            </div><!-- State and City -->

                            <div class="row no-margin">
                                <!-- Description -->
                                <div class="col-xs-12">
                                    <div class="form-group">
                                        <label for="id_description">{% trans "Description" %}<span class="required">*</span></label>
                                        <div>
                                                {#                        <div class="input-group-addon"><i class="fa fa-map-marker fa-lg"></i></div>#}
                                                {{ form_company.media }}
                                            {{ form_company.description }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row no-margin">
                                <!-- Facebook -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_facebook">{% trans 'Facebook' %}</label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-facebook fa-lg"></i></div>
                                            {{ form_company.facebook }}
                                        </div>
                                    </div>
                                </div>
                                <!-- Twitter -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_twitter">{% trans 'Twitter' %}</label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-twitter fa-lg"></i></div>
                                            {{ form_company.twitter }}
                                        </div>
                                    </div>
                                </div>
                            </div><!-- Facebook and Twitter -->

                            <div class="row no-margin">
                                <!-- Web -->
                                <div class="col-md-6 col-xs-12">
                                    <div class="form-group">
                                        <label for="id_url">{% trans 'Website' %}</label>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-addon"><i class="fa fa-globe fa-lg"></i></div>
                                            {{ form_company.url }}
                                        </div>
                                    </div>
                                </div>
                            </div><!-- Web -->
                            
                            <div class="row no-margin mt20">
                                <div class="col-md-12">
                                    <button class="btn btn-sm btn-block btn-info"><i class="fa fa-check-circle fa-lg"></i> Save and Update</button>
                                    <a class="btn btn-sm btn-block btn-default" data-toggle="collapse" data-target=".company-profile"><i class="fa fa-chevron-circle-left fa-lg"></i> Cancel</a>
                                </div>
                            </div>
                        </div>
                    </form>
                </section>
            {% endif %}
        {% elif isTeam %}
            <div class="container-fluid">
                <div class="row">
                    <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-2 col-md-offset-0 col-md-push-10 mt40 mb40">
                        {% if user.recruiter.is_admin and company|args:'CH_ADD_TEAM'|call:'check_service' %}
                            <button class="btn btn-sm btn-block btn-info" data-toggle="modal" data-target="#add-member-modal"><i class="fa fa-plus"></i> Invite Member</button>
                        {% endif %}
                    </div>
                    <div class="col-sm-3 col-md-2 col-md-pull-2  mt40 mb40">
                        {% if company|args:'CH_ROLES'|call:'check_service' %}
                            <div class="bg-white br-2 border-bottom border-light row no-margin">
                                <h3 class="mt20 mb20 pl40 pr20 pb10  border-bottom border-light">Filter</h3>
                                <ul class="list-unstyled pl20 pr20">
                                    <li class="mb10"><input type="checkbox" id="id_member" class="filter-item filter-item-1 js-switch"> <label class="inline label-sm" for="id_member">Members</label></li>
                                    <li class="mb10"><input type="checkbox" id="id_manager" class="filter-item filter-item-2 js-switch"> <label class="inline label-sm" for="id_manager">Managers</label></li>
                                    <li class="mb10"><input type="checkbox" id="id_admin" class="filter-item filter-item-3 js-switch"> <label class="inline label-sm" for="id_admin">Admins</label></li>
                                </ul>
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-sm-9 col-md-8 col-md-pull-2 mb40 mt40">
                        {% for member in members %}
                            <blockquote class="bg-white br-2 pt20 no-padding-bottom collapse fade in" data-id="{{member.id}}" data-membership="{{member.membership}}">
                                <div class="border-bottom border-light pb20">
                                    <h4 class="text-light no-margin"><i class="fa fa-user"></i> <span class="name">{% if member.user == user %}You{% else %}{{member.user.first_name}} {{member.user.last_name}}{% endif %}</span> <span class="pull-right"><i class="fa fa-gears"></i> <span class="roles">{% if member.is_admin %}Admin{% if member.user == company.user %}<small class="text-light"><i class="fa fa-cog"></i> Owner</small>{% endif %}{% else %}{{member.roles}}{%endif%}</span></span></h4>
                                    <h6 class="text-muted no-margin inline-block"><i class="fa fa-envelope"></i> {{member.user.email}}</h6>
                                    {% if user.recruiter.is_admin and not member.user == company.user %}
                                        {% if company|args:'CH_ADD_TEAM'|call:'check_service' %}
                                            <button class='btn btn-default btn-xs mt10 ml10 pull-right removecard'><i class="fa fa-times"></i> Remove</button>
                                        {% endif %}
                                        {% if company|args:'CH_ROLES'|call:'check_service' %}
                                            <button class="btn btn-default btn-xs mt10 ml10 pull-right block-toggle collapse fade in"><i class="fa fa-pencil"></i> Change Permissions</button>
                                            <button class="btn btn-info btn-xs mt10 ml10 pull-right block-toggle collapse fade"><i class="fa fa-pencil"></i> Hide Permissions</button>
                                        {% endif %}
                                    {% endif %}
                                    {% if user == company.user and not member.user == company.user %}
                                        <button class="btn btn-default btn-xs mt10 ml10 pull-right changeowner"><i class="fa fa-user"></i> Transfer Ownership</button>
                                    {% endif %}
                                </div>
                                {% if company|args:'CH_ROLES'|call:'check_service' %}
                                    <div class="row block-toggle-section pt20 pb20 collapse fade block-toggle ">
                                        <div class="col-xs-10 col-xs-push-1">
                                            <label class="label-sm block relative perm-change ml20 mr40" for="member_radio">
                                                <span class="text"> Member <small class="text-muted inline-block">Access as assigned</small></span> 
                                                <input type="radio" id="member_radio" name="membershipoptions-{{member.id}}" value="1" class="radio-right" {% if member.membership == 1 or member.membership == '1' %}checked{%endif%}>
                                            </label>
                                            <label class="label-sm block relative perm-change ml20 mr40" for="manager_radio">
                                                <span class="text">Manager <small class="text-muted inline-block">Access to Job Settings and Hiring Process</small></span> 
                                                 <input type="radio" id="manager_radio" name="membershipoptions-{{member.id}}" value="2" class="radio-right" {% if member.membership == 2 or member.membership == '2' %}checked{%endif%}>
                                            </label>
                                            <label class="label-sm block relative perm-change ml20 mr40" for="admin_radio">
                                                <span class="text"> Admin <small class="text-muted inline-block">Full Manager rights and access to manage career site, company profile and team </small></span> 
                                                <input type="radio" id="admin_radio" name="membershipoptions-{{member.id}}" value="3" class="radio-right" {% if member.membership == 3 or member.membership == '3' %}checked{%endif%}>
                                            </label>
                                        </div>
                                    </div>
                                {% endif %}
                            </blockquote>
                        {% endfor %}
                        {% if not members %}
                        <div class="row bg-white br-2 mt20 mb20 pt20 pb20"><h6 class="text-light">No members to Show</h6></div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% if user.recruiter.is_admin %}
                {% if company|args:'CH_ADD_TEAM'|call:'check_service' %}
                    <div class="modal fade" id="add-member-modal" role="dialog" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h5 class="modal-title">Invite Member to Team</h5>
                                </div>
                                <div class="modal-body text-left" id="postulate-modal-text">
                                    <form id="inviteForm" action="." method="post" role="form">
                                        {% csrf_token %}
                                        <div class="row no-margin">
                                            <div class="form-group {% if form_invite.email.errors %}has-error{% endif %} col-xs-10 col-xs-offset-1">
                                                {{form_invite.email}}
                                                <ul class="text-danger error-list">
                                                {% for error in form_invite.email.errors %}
                                                    <li>{{error}}</li>
                                                {% endfor %}
                                                </ul>
                                            </div>
                                            <div class="col-xs-10 col-xs-push-1">
                                                <label class="label-sm relative block ml20 mr40" for="member_radio">
                                                    <span class="text"> Member - <small class="text-muted">Access as assigned</small></span> <input type="radio" id="member_radio" name="membershipoptions" value="1" class="radio-right" checked>
                                                </label>
                                                {% if company|args:'CH_ROLES'|call:'check_service' %}
                                                    <label class="label-sm relative block ml20 mr40" for="manager_radio">
                                                        <span class="text">Manager - <small class="text-muted">Access to Job Settings and Hiring Process</small></span> 
                                                         <input type="radio" id="manager_radio" name="membershipoptions" value="2" class="radio-right">
                                                    </label>
                                                    <label class="label-sm relative block ml20 mr40" for="admin_radio">
                                                        <span class="text"> Admin - <small class="text-muted">Full Manager rights and access to manage career site, company profile and team </small></span> <input type="radio" id="admin_radio" name="membershipoptions" value="3" class="radio-right">
                                                    </label>
                                                {% endif %}
                                            </div>
                                            <div class="col-xs-10 col-xs-offset-1 mt20 mb20">
                                                <button class="btn btn-info btn-sm btn-block "><i class="fa fa-envelope"></i> Invite</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div><!-- Upload CV File Vacancy Modal -->
                    <div class="modal fade" id="remove-member-modal" role="dialog" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h5 class="modal-title">Remove Member from Team</h5>
                                </div>
                                <div class="modal-body text-justify">
                                    <p>Remove <b><span id="member-name"></span></b>?</p>
                                    <input type="hidden" id="member-id">
                                    <button class="mt20 btn btn-sm remove btn-block btn-default"><i class="fa fa-times"></i> Remove</button>
                                </div>
                            </div>
                        </div>
                    </div><!-- Invite Member Modal -->
                {% endif %}
                <div class="modal fade" id="change-owner-modal" role="dialog" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h5 class="modal-title">Change Owner of Company Profile</h5>
                            </div>
                            <div class="modal-body text-justify">
                                <p>Grant ownership to <b><span id="member-name"></span></b>?</p>
                                <input type="hidden" id="member-id">
                                <button class="mt20 btn btn-sm change btn-block btn-default"><i class="fa fa-user"></i> Change</button>
                            </div>
                        </div>
                    </div>
                </div><!-- Change Owner Modal -->
            {% endif %}
        {% elif isBilling %}
            <div class="container-fluid pt20 pb20">
                <div class="row">
                    <div class="col-sm-3">
                        <div class="border-bottom border-light label-info pl10 pr10 pt10 pb10 mt10">
                            <h3 class="text-inverse no-margin">Current Plan<button class="btn-info-trans btn btn-sm br-2 mt2 pull-right" data-toggle="modal" data-target="#billing-modal">Update Plan</button></h3>
                        </div>
                        <div class="border-bottom border-light bg-white pl10 pr10 pt10 pb10">
                            <h5 class="text-light lead no-margin">{{company.subscription.price_slab.package}} <small>{% if company.subscription.price_slab.get_slab_period_display %}{{company.subscription.price_slab.get_slab_period_display}}{% endif %}</small></h5>
                            <p class="text-light no-margin mt5 mb5">Users
                                <span class="pull-right">{% if company.subscription.price_slab.allows_additional_users %} {{company.active_recruiter_count}} / ({{company.subscription.price_slab.package.free_users}} + {{company.subscription.added_users}}) {% else %} {{company.active_recruiter_count}} / {{company.subscription.price_slab.package.free_users}} {% endif %}</span>
                            </p>
                            <p class="text-light no-margin mt5 mb5">Expiry
                                <span class="pull-right">{% if company.subscription.expiry %}{{company.subscription.expiry|naturaltime}}{%else%}Never{%endif%}</span>
                            </p>
                            {% if company.subscription.expiry %}
                                <p class="mt10 mb10 text-right"><input type="checkbox" class="js-switch renew_switch" {% if company.subscription.auto_renew %} checked {% endif %} id="auto_renew"><label for="auto_renew" class="pull-left"> Auto Renew</label></p>
                            {% endif %}
                            {% if company.subscription.price_slab.allows_additional_users %}
                                <form action="{% url 'companies_billing' %}" method ="post" class="mt10">
                                    {% csrf_token %}
                                    <input type="hidden" value="{{company.subscription.price_slab.id}}" name="plan">
                                    <button class="btn btn-info btn-sm btn-block"> Update Users</button>
                                </form>
                            {% else %}
                                <small class="text-center center-block"><small class="text-light">Upgrade your plan to add more users</small></small>
                            {% endif %}
                        </div>                        
                    </div>
                    <div class="col-sm-6">
                        <div class="row">
                            {% if company.subscription.expiry and company.subscription.expiry|timeleft < 7 %}
                                {% if not company.subscription.auto_renew or renewal > company.wallet.available %}
                                    <div class="bg-white border-bottom border-light pt10 pb10 pl10 pr10">
                                        <h6 class="pull-left"> Your plan is expiring on <b class="text-light">{{company.subscription.expiry.date}}</b>. </h6> {% if renewal > company.wallet.available %} <button class="btn-info btn btn-sm pull-right" data-open="collapse" data-target=".credit_section">Add Credits</button> {% else %} <button class="btn btn-sm btn-info pull-right" id="renew_now">Renew Now</button> {% endif %}
                                        <span class='clearfix'></span>
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                        {% if slab and amount_to_pay >= 0 %}
                            <form method = "post" action ="{% url 'companies_payment' %}" id="billing_form">
                                <div class="bg-white border-bottom border-light mt10 pl10 pr10 pt10 pb10 card-highlight" >
                                    <h4 class="no-margin">Plan Summary</h4>
                                </div>
                                <div class="bg-white border-bottom border-light pl10 pr10 pt10 pb10 card-highlight">
                                    {% csrf_token %}
                                    <input type="hidden" name="plan" value="{{slab.id}}">
                                    {% if company.subscription.price_slab != slab %}
                                        <p class="text-light"> <span class="">{{slab}}</span> <span class="pull-right strong text-muted original_amount">{{slab.currency.symbol|default:'$'}}<span>{{slab.amount|floatformat:2}}</span></span></p>
                                    {% else %}
                                        <p class="text-light no-margin-bottom"> <span class="">{{slab}}</span> <span class="pull-right strong text-muted original_amount"><span>Nill</span></span></p>
                                    {% endif %}
                                    {% if slab.allows_additional_users %}
                                        <p class="text-light no-margin-bottom">
                                            <span class="inline-block mt5 pull-left ">Additional Users :</span> 
                                            <span class=" inline-block ml10">
                                                <span class="input-group input-group-sm numeric-step-input text-center" style="width:150px">
                                                    <span class="input-group-btn"><a class="btn btn-default step-sub"><i class="fa fa-minus"></i></a></span>
                                                    <input type="tel" class="text-center form-control step-value bg-white" min ='0' step ='1' value='{{company.subscription.added_users|default:0}}' name="added_users" id="added_users">
                                                    <span class="input-group-btn"><a class="btn btn-default step-add"><i class="fa fa-plus"></i></a></span>
                                                </span>
                                            </span>

                                            {% if slab.allows_additional_users %}
                                               <span class="pull-right strong additional_user_charge text-muted mt10">{{slab.currency.symbol|default:'$'}}<span class="amount">{{additional_user_charge|floatformat:2|default:0.00}}</span></span>
                                            {% endif %}
                                        </p>
                                        <span class="clearfix"></span>
                                    {% endif %}
                                    <small class="text-light mb5">Expiring on {% if company.subscription.price_slab != slab %} {{slab.expiry_period|days_from_now }} {% else %} {{company.subscription.expiry|daysadd:0}} {% endif %}</small><br>
                                </div>
                                {% if company.subscription.price_slab != slab%}
                                    <div class="bg-white border-bottom border-light pl10 pr10 pt10 pb10 mt5 card-highlight">
                                        <h4 class="no-margin">Discount</h4>
                                    </div>
                                    <div class="bg-white border-bottom border-light pl10 pr10 pt10 pb10 card-highlight">
                                    
                                        <p class="text-light">
                                            <span class="">
                                                <input type="text" class="form-control input-sm inline-block" style="max-width:150px;" name="code" id="coupon_code">
                                                <a class="btn btn-sm btn-trans-info no-padding-right" id="apply_code">Verify Code</a>
                                            </span>
                                            <span class="center-block discount-amount hidden text-success text-right mt10 pull-right strong">-{{slab.currency.symbol|default:'$'}}<span class="amount">0.00</span></span>
                                            <span class="clearfix"></span>
                                            <span class="center-block discount-msg small pull-left mt10"></span>
                                        </p>
                                        <span class="clearfix"></span>
                                    </div>
                                {% endif %}
                                <div class="bg-white border-bottom border-light pl10 pr10 pt10 pb10 mt5 card-highlight">
                                    <h4 class="no-margin">Payments</h4>
                                </div>
                                <div class="bg-white border-bottom border-light pl10 pr10 pt10 pb10 card-highlight">
                                    {% if company.subscription.expiry %}
                                            <p class="text-light">{% if carried_forward_balance%}Adjusted Cashback from previous Plan :{% else %} Adjusted Cashback from additional Users : {% endif %} <span class="pull-right strong text-success consolidated_amount"> -{{slab.currency.symbol|default:'$'}}<span class="amount">{{carried_forward_balance|floatformat:2|default:0.00}}</span></span>
                                            {% if carried_forward_balance%}<br><small>{{carried_forward_message|safe}}</small>{% endif %}</p>
                                    {% endif %}
                                    <p class="text-light consolidated_amount_to_pay">Amount to Pay: <span class="pull-right strong text-muted">{{slab.currency.symbol|default:'$'}}<span class="amount">{{amount_to_pay|default:0|floatformat:2}}</span></span></p>
                                    
                                    <p class="text-light">Available Credits: <span class="pull-right strong text-muted available_credits">{{comany.wallet.currency.symbol|default:'$'}}<span class="amount">{{company.wallet.available|default:0|floatformat:2}}</span></span></p>

                                    <p class="text-light additional_credits_required">Additional Credits Required: <span class="pull-right strong text-danger">{{slab.currency.symbol|default:'$'}}<span class="amount">{{acr|floatformat:2|default:0.00}}</span></span></p>
                                    <button type="button" class="bill btn btn-sm btn-info pull-right strong mt10 mb10" data-open="collapse" data-target=".credit_section" href="#credits"> Confirm </button>
                                    <span class="clearfix"></span>
                                </div>    
                            </form>

                            <div class="bg-white border-bottom border-light mb20 pl10 pr10 pt10 pb10 text-light card-highlight">
                                {% if slab.expiry_period %}
                                    <p><small>Your next renewal will be charged {{slab.currency.symbol|default:'$'}}{{renewal}} for {{slab}} plan {% if company.subscription.added_users and not remove_users %} with {{company.subscription.added_users}} additional users {% elif company.subscription.added_users and remove_users %} with {{slab.package.max_users|sub:slab.package.free_users}} additional users {% endif %}</small></p>
                                {% endif %}
                                {% if remove_users %}
                                    <p><small>You will be required to remove users to adjust to the new plan's user limit.</small></p>
                                {% endif %}
                            </div>
                        {% endif %}
                        <div class="row mb20">
                            <div class="col-xs-12 table-responsive">
                                <h4>Transactions</h4>
                                <table class="table table-hover bg-white">
                                    <thead>     
                                        <tr>
                                            <th>Timestamp</th>
                                            <th>Transacted by</th>
                                            <th>Reason</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for transaction in company.transactions_set.all %}
                                            <tr>
                                                <td>{{transaction.timestamp}}</td>
                                                <td>{{transaction.user}}</td>
                                                <td>{{transaction.reason}}</td>
                                                <td>{{transaction.get_type_display}}</td>
                                                <td>{{company.wallet.currency.symbol|default:'$'}}{{transaction.amount}}</td>
                                                <td>{{company.wallet.currency.symbol|default:'$'}}{{transaction.balance}}</td>
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan='6' class="text-center">No Transactions yet</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3" id="credits">
                        <div class="border-bottom border-light bg-white pl10 pr10 pt10 pb10 mt10">
                            <h3 class="text-light text-center">Credits</h3>
                            <h5 class="text-info text-center">{{company.wallet.currency.symbol|default:'$'}} {{company.wallet.available|default:0|floatformat:2}}</h5>
                        </div>
                        <div class="border-bottom border-light bg-white pl10 pr10 pt10 pb10 collapse fade in credit_section">
                            <button class="btn-info btn btn-sm btn-block" data-toggle="collapse" data-target=".credit_section">Add Credits</button>
                        </div>

                        <section class="collapse fade credit_section bg-white">
                            <form class="bg-white border-bottom border-light mb20 pl20 pr20 pt10 pb20 text-center" action ="//{{request.get_host}}/checkout/" method = "post" id="add_credits">
                                {% csrf_token %}
                                <input type="hidden" name="slab" value ="{{slab.id}}">
                                    <label class="mt5">Add Credit</label>
                                    <div class="input-group numeric-step-input" style="width:150px; margin:auto">
                                        <span class="input-group-btn"><a class="btn btn-default step-sub"><i class="fa fa-minus"></i></a></span>
                                        <span class="input-prefix-text">$</span>
                                        <input type="tel" class="form-control step-value bg-white" min ='5' step =5 value='{{amount_to_pay|default:5}}' name="amount_to_pay" id="amount_to_pay">
                                        <span class="input-group-btn"><a class="btn btn-default step-add"><i class="fa fa-plus"></i></a></span>
                                    </div>
                                    <button data-paypal-button="true" class="mt10 btn btn-trans no-padding">
                                      <img src="https://www.paypalobjects.com/webstatic/en_US/i/btn/png/blue-rect-paypalcheckout-34px.png" alt="PayPal Checkout">
                                    </button>
                                    <span class="clearfix"></span>
                            </form>
                        </section>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
<!-- End Content -->
{% endblock %}

{% block java_script_srcs %}
    <script src="{{ STATIC_URL }}ckeditor/ckeditor/ckeditor.js"></script>
    <script src="{{ STATIC_URL }}ckeditor/ckeditor-init.js"></script>
{% endblock %}

{%block java_script_code%}
    {% if isProfile %}
        <script>
            {% if logo_form.logo.errors %}
                $('#updateimage-modal').modal('show');
            {% endif %}
            function toreadabledate(d){
                var monthNames = ["Jan.", "Feb.", "Mar.", "Apr.", "May", "Jun.", "Jul.", "Aug.", "Sep.", "Oct.", "Nov.", "Dec."];
                date = new Date(d);
                month = monthNames[date.getMonth()]

                return month + ' ' + date.getDate() + ', ' + date.getYear();
            }
            $(document).ready(function(){
                {% if recruiter and recruiter.is_admin %}
                    $('#company_form').submit(function(e){
                        // update_company(this,e);
                    });
                    function update_company(_this,e){
                        $this = $(_this);
                        // alert('submitting');
                        e.preventDefault();
                        var formdata = $this.serializeArray();
                        console.log(formdata);
                        // var url = $this.attr('action');
                        // console.log(url);
                        // var id = $this.attr('data-id');
                        // console.log(id)
                        // if(!id){
                            //     id=0;
                        // }
                        $this.find('.error-list').remove();
                        $this.find('.has-error').removeClass('has-error');
                        $this.find('.btn').addClass('disabled');
                        $this.find('.btn').prop('disabled',true);
                        $this.find('.btn').html('<i class="fa fa-lg ga-pulse fa-spinner"></i> Please Wait');
                        $.ajax({
                                type:'post',
                            data:formdata,
                            complete: function(data){
                                    $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                                $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                                $this.find('.btn').prop('disabled',false);
                                $this.find('.btn').removeClass('disabled');
                            },
                            success: function(data){
                                    console.log(data);
                                if (data.success == true){
                                        $view = $(".company-profile:not('.form-section')");
                                    $view.find('#company-name').html($this.find('#id_name').val());
                                    $view.find('#company-legal-name').html($this.find('#id_social_name').val());
                                    $view.find('#company-industry').html($this.find('#id_industry option:selected').text());
                                    $view.find('#company-address').html($this.find('#id_city').val() + ', ' + $this.find('#id_state').val() + ', ' + $this.find('#id_nationality option:selected').text());
                                    $view.find('#company-phone').html($this.find('#id_phone').val());
                                    if ($this.find('#id_phone').val()) {
                                            $view.find('#company-phone').parent().removeClass('hidden');
                                    }
                                    else {
                                            $view.find('#company-phone').parent().addClass('hidden');
                                    }
                                    $view.find('#company-email').html($this.find('#id_company_email').val());
                                    if ($this.find('#id_company_email').val()) {
                                            $view.find('#company-email').parent().removeClass('hidden');
                                    }
                                    else {
                                            $view.find('#company-email').parent().addClass('hidden');
                                    }
                                    $view.find('#company-url').html($this.find('#id_url').val());
                                    $view.find('#company-url').attr('href',$this.find('#id_url').val());
                                    if ($this.find('#id_url').val()) {
                                            $view.find('#company-url').parent().removeClass('hidden');
                                    }
                                    else {
                                            $view.find('#company-url').parent().addClass('hidden');
                                    }
                                    $view.find('#company-facebook').attr('href',$this.find('#id_facebook').val());
                                    if ($this.find('#id_facebook').val()) {
                                            $view.find('#company-facebook').parent().removeClass('hidden');
                                    }
                                    else {
                                            $view.find('#company-facebook').parent().addClass('hidden');
                                    }
                                    tweet = $this.find('#id_twitter').val().trim('@')
                                    if (tweet[0] == '@')
                                        tweet = tweet.substring(1);
                                    $view.find('#company-twitter').attr('href',"http://twitter.com/"+tweet);
                                    if (tweet) {
                                            $view.find('#company-twitter').parent().removeClass('hidden');
                                    }
                                    else {
                                            $view.find('#company-twitter').parent().addClass('hidden');
                                    }
                                    $view.find('#company-description').html($this.find('#id_description').val());
                                    // $view.find('#account-name').html($this.find('#id_first_name').val() + ' ' + $this.find('#id_last_name').val());
                                    $('.company-profile').collapse('toggle')
                                    if(data.redirect){
                                            location.href = data.redirect
                                    }
                                }
                                else {
                        // 
                                    if ('name' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_name]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_name').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.name).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('social_name' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_social_name]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_social_name').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.social_name).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('phone' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_phone]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_phone').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.phone).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('company_email' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_company_email]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_company_email').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.company_email).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('industry' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_industry]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_industry').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.industry).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('nationality' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_nationality]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_nationality').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.nationality).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('state' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_state]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_state').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.state).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('city' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_city]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_city').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.city).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('description' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_description]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_description').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.description).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('facebook' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_facebook]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_facebook').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.facebook).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('twitter' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_twitter]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_twitter').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.twitter).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                    if ('url' in data.errors)
                                    {
                                            html = "<ul class = 'error-list text-danger'></ul>"
                                        label = $this.find('[for=id_url]');
                                        $elist = $(html).insertAfter($(label).next());
                                        $this.find('#id_url').parents('.input-group').addClass('has-error')
                                        console.log($elist)
                                        $(data.errors.url).each(function(k,v){
                                                $elist.append('<li>'+v+'</li>');
                                            // $this.find(
                                        });
                                    }
                                }  
                            },
                            error: function(e){
                                    console.log(e);
                            }
                        })
                        return false;
                    }
                    $('#id_logo').change(function(){
                        readURL(this);
                    })
                    function readURL(input) {

                        if (input.files && input.files[0]) {
                            if (input.files[0].size > 5*1024*1024){
                                alert('File exceeds 5MB file size')
                                input.value="";
                            }
                            else {
                                var reader = new FileReader();

                                reader.onload = function (e) {
                                    $('#uploadimage-form .company-logo').attr('src', e.target.result);
                                }

                                reader.readAsDataURL(input.files[0]);
                            }
                        }
                    }
                
                {% endif %}
            });
        </script>
    {% elif isTeam %}
        <script>

            var update_filter = function(){
                $this = $(this);
                c1 = $('.filter-item-1')[0].checked;
                c2 = $('.filter-item-2')[0].checked;
                c3 = $('.filter-item-3')[0].checked;
                if(!c1 && !c2 && !c3){
                    $('blockquote').collapse('show');
                }
                else {
                    if(c1){
                        $('blockquote[data-membership=1]').collapse('show');
                    }
                    else {
                        $('blockquote[data-membership=1]').collapse('hide');
                    }
                    if(c2){
                        $('blockquote[data-membership=2]').collapse('show');
                    }
                    else {
                        $('blockquote[data-membership=2]').collapse('hide');
                    }
                    if(c3){
                        $('blockquote[data-membership=3]').collapse('show');
                    }
                    else {
                        $('blockquote[data-membership=3]').collapse('hide');
                    }
                }
            }
            {% if company|args:'CH_ROLES'|call:'check_service' %}
                $(document).ready(function(){

                    $('.filter-item').change(update_filter);
                    {% if user.recruiter.is_admin and form_invite.errors %}
                        $('#add-member-modal').modal('show');
                    {% endif %}
                    var elems = Array.prototype.slice.call(document.querySelectorAll('.js-switch'));
                    
                    elems.forEach(function(html) {
                      var switchery = new Switchery(html,{color:'#5bc0de', size:'small'});
                    });
                });
            {% endif %}
            {% if user.recruiter.is_admin %}
                $('#change-owner-modal').on('hidden.bs.modal', function(){
                    $(this).find('#member-id').val('');
                    $(this).find('#member-name').html('');
                    $(this).find('.btn.change').html('<i class="fa fa-user"></i> Change').removeClass('disabled').prop('disabled',false);
                });
                $('#change-owner-modal .btn.change').click(function(){
                    $this = $(this);
                    $modal = $this.parents('.modal');
                    $this.html('<i class="fa fa-pulse fa-spinner"></i> Please Wait').addClass('disabled').prop('disabled',false);
                    mid = $modal.find('#member-id').val()
                    data = {'id': mid}
                    $.ajax ({
                        url: '/ajax/changeownership/',
                        type: 'POST',
                        data: data,
                        complete: function(){
                            $this.find('.remove.btn').html('<i class="fa fa-times"></i> Change').removeClass('disabled').prop('disabled',false);
                        },
                        success: function(data){
                            if (data.success){
                                location.href=location.href
                                $modal.modal('hide');
                            }
                            alert(data.msg);
                        },
                        error: function(er){
                            console.log(er);
                        }
                    })
                })
                $('.changeowner').click(function(){
                    $('#change-owner-modal').find('#member-id').val($(this).parents('blockquote').data('id'))
                    $('#change-owner-modal').find('#member-name').html($(this).parents('blockquote').find('.name').html())
                    $('#change-owner-modal').modal('show');
                })
                {% if company|args:'CH_ADD_TEAM'|call:'check_service' %}
                    $('#remove-member-modal').on('hidden.bs.modal',function(){
                        $(this).find('#member-id').val('');
                        $(this).find('#member-name').html('');
                        $(this).find('.remove.btn').html('<i class="fa fa-times"></i> Remove').removeClass('disabled').prop('disabled',false);
                    });
                    $('#remove-member-modal .btn.remove').click(function(){
                        $this = $(this);
                        $modal = $('#remove-member-modal');
                        $this.html('<i class="fa fa-pulse fa-spinner"></i> Please Wait').addClass('disabled').prop('disabled',false);
                        mid = $modal.find('#member-id').val()
                        data={'id': mid}
                        $.ajax({
                            url: '/ajax/removemember/',
                            type: 'POST',
                            data: data,
                            complete: function(){
                                $this.find('.remove.btn').html('<i class="fa fa-times"></i> Remove').removeClass('disabled').prop('disabled',false);        
                            },
                            success: function(data){
                                if(data.success){
                                    $block = $('blockquote[data-id='+mid+']');
                                    $block.collapse('hide');
                                    setTimeout(function(){
                                        $block.remove();
                                    },5000);
                                    $modal.modal('hide');
                                }
                                alert(data.msg);
                            },
                            error: function(er){
                                console.log(er);
                            }
                        })
                    });
                    $('.removecard').click(function(){
                        $('#remove-member-modal').find('#member-id').val($(this).parents('blockquote').data('id'))
                        $('#remove-member-modal').find('#member-name').html($(this).parents('blockquote').find('.name').html())
                        $('#remove-member-modal').modal('show');
                    });
                {% endif %}
                {% if company|args:'CH_ROLES'|call:'check_service' %}
                    $('.block-toggle').click(function(){
                        $this = $(this);
                        // $this.find('.block-toggle-section').collapse('show')
                            $this.parents('blockquote').find('.block-toggle').collapse('toggle');
                    });
                    $('.perm-change').click(function(){
                        $this = $(this);
                        $label = $this;
                        // console.log($this)
                        $block = $this.parents('blockquote');
                        data = {
                            'id': $block.data('id'),
                            'perm': $this.find('input').val()
                        }
                        $html = $this.html();
                        $this.addClass('disabled').prop('disabled',true);
                        $this.siblings().prop('disabled',true).addClass('disabled');
                        $text = $this.find('.text').html();
                        $this.find('.text').html('<i class="fa fa-pulse fa-spinner"></i> Please Wait')
                        $.ajax({
                            url:'/ajax/updatepermissions/',
                            data: data,
                            type:'post',
                            complete: function(){
                                $label.removeClass('disabled').prop('disabled',false).find('.text').html($text);
                                $label.siblings().prop('disabled',false).removeClass('disabled');
                            },
                            success: function(data){
                                console.log(data);
                                console.log($block.data('id'))
                                console.log('{{user.recruiter.id}}')
                                if (data.success){
                                    $block.find('.roles').html(data.roles);
                                    $block.find('.block-toggle').collapse('toggle');
                                    if($block.data('id') === {{user.recruiter.id}}){
                                        location.href=location.href
                                    }
                                }
                                alert(data.msg);
                            },
                            error: function(er){
                                console.log(er);
                                alert(er)
                            }
                        })
                    })
                {% endif %}
            {% endif %}
        </script>
    {% elif isBilling %}
        <script>
            // $('button[href]').click(function(){
            //     location.href = $(this).attr('href');
            // })
            {% if renewal < company.wallet.available %}
                $('#renew_now').click(function(){
                    $this = $(this);
                    $this.html('<i class="fa fa-spinner fa-pulse"></i> Please Wait').addClass('disabled').attr('disabled', true);
                    $.ajax({
                        url: '/ajax/renew_now/',
                        type: 'post',
                        data: {},
                        complete: function(){
                            $this.html('<i class="fa fa-spinner fa-pulse"></i> Please Wait').addClass('disabled').attr('disabled', true);
                        },
                        success: function(data){
                            console.log(data);
                            if(data.msg){
                                alert(data.msg);
                            }
                            if(data.success){
                                location.href=location.href
                            }
                        },
                        eroor: function(er){
                            console.log(er);
                        }
                    })
                })
            {% endif %}
            var update_confirm = function(){
                $form = $('#billing_form');
                $additional_credits_required = parseFloat($('.additional_credits_required .amount').html())
                console.log($additional_credits_required)
                if ( $additional_credits_required > 0){
                    if(!$('#update_immediately')[0] || ($('#update_immediately')[0] && $('#update_immediately')[0].checked)){
                        $form.find('button.btn.bill').attr('type','button').attr('data-open','collapse').attr('href','#credits');
                    }
                    else {
                        $form.find('button.btn.bill').attr('type','submit').attr('data-open','').removeAttr('href');
                    }

                }
                else {
                    $form.find('button.btn.bill').attr('type','submit').attr('data-open','').removeAttr('href');
                }
            }
            $('[data-open=collapse]').click(function(e){
                $('div'+$(this).data('target')).collapse('hide')
                $('section'+$(this).data('target')).collapse('show')
            })
            var consolidate_amount = function(){
                {% if slab == current_slab %}
                    $amount = 0.00;
                    user_update = true;
                {% else %}
                    $amount = parseFloat({{slab.amount|default:0.00}});
                    user_update = false;
                {% endif %}
                // alert('{{company.wallet.available}}')
                $credits_available = parseFloat({{company.wallet.available|default:0.00}})
                $carried_forward_balance = parseFloat({{carried_forward_balance|default:0}});

                $user_charge = parseFloat($('.additional_user_charge .amount').html())
                if(!$user_charge){
                    $user_charge = parseFloat(0);
                }
                $discount = 0;
                if ($('.discount-amount .amount')[0]){
                    $discount = parseFloat($('.discount-amount .amount').html())
                }
                $credits_available = $credits_available + $carried_forward_balance
                $additional_credits_required = $amount + $user_charge - $credits_available - $discount;
                // alert($credits_available + ' ' + $carried_forward_balance + ' ' + $user_charge + ' ' + $discount + ' ' + $credits_available + ' ' + $additional_credits_required)
                // $consolidated_amount = $amount - $discount + $user_charge;
                // if ($update_immediately){
                    // $additional_credits_required -= $carried_forward_balance;
                    // $consolidated_amount -= $carried_forward_balance;
                // }
                if($additional_credits_required<0) {
                    $additional_credits_required = 0;
                }
                // if($consolidated_amount < 0) {
                //     $consolidated_amount = 0;
                // }
                if (user_update){
                    $credits_available = $credits_available + parseFloat($('.consolidated_amount .amount').html());
                }
                $('.available_credits .amount').html(parseFloat($credits_available + $discount).toFixed(2));
                $('.consolidated_amount_to_pay .amount').html(parseFloat($amount + $user_charge).toFixed(2));
                $('.additional_credits_required .amount').html(parseFloat($additional_credits_required).toFixed(2));
                $('#amount_to_pay').val(parseFloat(Math.ceil($additional_credits_required).toFixed(2)))
                $('#amount_to_pay').blur();
                update_confirm();
            }
            var additional_users_charge = function(){
                $current_rate = parseFloat({{slab.price_per_user|default:0.00}}).toFixed(2);
                $future_rate = parseFloat({{future_slab.price_per_user|default:0.00}}).toFixed(2);
                $carried_forward_balance = {{carried_forward_balance|floatformat:2|default:0.00}}
                console.log($current_rate)
                console.log($future_rate)
                $amount = 0.00;
                $expiry_period = {{current_slab.expiry_period}};
                if(!$expiry_period)
                    $consolidation_ratio = 1;
                else
                    $consolidation_ratio = parseFloat({{company.subscription.expiry|timeleft}}).toFixed(2)/parseFloat({{current_slab.expiry_period}}).toFixed(2);
                if($consolidation_ratio <= 0){
                    $consolidation_ratio = 1;
                }
                console.log($consolidation_ratio)
                $user_count = 0.00
                console.log('_______________')
                console.log($user_count)
                {% if company.subscription.price_slab == slab %}
                    $user_count = {{company.subscription.added_users|default:0.00}}
                {% endif %}
                console.log($user_count)
                $user_count = parseFloat($('#added_users').val()|0).toFixed(2) - $user_count
                console.log($user_count)
                $user_count = parseFloat($user_count).toFixed(2);
                console.log($user_count)
                // if(!$('#update_immediately')[0] || ($('#update_immediately')[0] && $('#update_immediately')[0].checked)){
                    {% if company.subscription.price_slab == slab %}
                        $amount = $user_count * $current_rate * $consolidation_ratio;
                    {% else %}
                        $amount = $user_count * $future_rate
                    {% endif %}
                    
                // }
                // else {
                //     $amount = $user_count * $future_rate;
                // }
                $amount = parseFloat($amount).toFixed(2)
                // alert($current_rate)
                if ($user_count < 0){
                    $('.additional_user_charge .amount').html('0.00')
                    {% if slab == current_slab %}
                        $('.consolidated_amount .amount').html($amount*-1)
                    {% endif %}
                }
                else {
                    $('.additional_user_charge .amount').html($amount)    
                    {% if slab == current_slab %}
                        $('.consolidated_amount .amount').html('0.00')
                    {% endif %}
                }
            }
            var update_user_cookie = function(){
                $user_count = parseFloat($('#added_users').val()).toFixed(2);
                setCookie('user_count',$user_count,1);
            }
            $(document).ready(function(){
                {% if slab and post_payment %}
                    $u_count = getCookie('user_count');
                    $('#added_users').val($u_count);
                {% else %}
                    setCookie('user_count',0,0);    
                {% endif %}
                {% if slab %}
                    $('html, body').animate({
                        scrollTop: $("#billing_form").offset().top -50
                    }, 500);
                {% endif %}
                // var on_renew = new Switchery($('#update_immediately')[0],{color:'#5bc0de', size:'small'});
                {% if company.subscription.expiry %}
                    var renew_switch = new Switchery($('#auto_renew')[0],{color:'#5bc0de', size:'small'});
                    // $('#auto_renew')
                    var update_renewal = function(){
                        renew_switch.options.disabled = true;
                        if (renew_switch.isChecked()){
                            recur = true;
                        }
                        else {
                            recur = false;
                        }
                        $.ajax({
                            url:'/ajax/update_recurring/',
                            type:'post',
                            data : {'recur':recur},
                            complete: function(){
                                renew_switch.options.disabled = false;
                            },
                            success: function(data){
                                if (data.msg){
                                    alert(data.msg)
                                }
                                if(!data.success){
                                    $(this)[0].checked = !$(this)[0].checked
                                }
                            },
                            error: function(er){
                                console.log(er);
                                $(this)[0].checked = !$(this)[0].checked
                            }
                        })
                    }

                    $('#auto_renew').click(update_renewal);
                    $('#auto_renew + .switchery').click(update_renewal);
                {% endif %}
                additional_users_charge();
                consolidate_amount();
                // $('#update_immediately').click(function(){
                //     additional_users_charge();
                //     consolidate_amount();
                // })
                $('.numeric-step-input .step-sub').click(function(){
                    $value=0;
                    $input = $(this).parents('.numeric-step-input').find('.step-value');
                    $step = parseInt($input.attr('step'));
                    $min = parseInt($input.attr('min'));
                    if(!$min){
                        $min = 0;
                    }
                    try{
                        $value = parseInt($input.val());
                    }
                    catch(er){
                        $value = 0;
                    }
                    $value = $value -$step;
                    if(!($value>=$min)){
                        $value = $min;
                    }

                    while($value%$step!=0){
                        $value = $value +1;
                    }
                    $input.val($value)
                    $input.change();
                })
                $('.numeric-step-input .step-add').click(function(){
                    $value=0;
                    $input = $(this).parents('.numeric-step-input').find('.step-value');
                    $step = parseInt($input.attr('step'));
                    $min = parseInt($input.attr('min'));
                    try{
                        $value = parseInt($input.val());
                    }
                    catch(er){
                        $value = 0;
                    }
                    $value =$value +$step;
                    if(!($value>=$min)){
                        $value = $min;
                    }
                    while($value%$step!=0){
                        $value = $value +1;
                    }
                    $input.val($value);
                    $input.change();
                });
                $('.numeric-step-input .step-value').blur(function(){
                    $input = $(this);
                    $value=0;
                    $step = parseInt($(this).attr('step'));
                    $min = parseInt($(this).attr('min'));
                    if(!$min){
                        $min = 0;
                    }
                    try {
                        $value = parseInt($input.val());
                    }
                    catch(er){
                        $value = 0;
                        console.log(er);
                    }
                    if(!$value){
                        $value = 0;
                    }
                    if($value < $min){
                        $value = $min;
                    }
                    while($value%$step!=0){
                        $value = $value +1;
                    }
                    $input.val($value);
                    console.log($value);
                    console.log($input);
                    console.log($input.val())
                });
                $('.numeric-step-input .step-value').blur();
                $('#apply_code').click(function(){
                    $this = $(this);
                    $this.html('<i class="fa fa-spinner fa-pulse"></i> Please Wait').addClass('disabled').attr('disabled',true);
                    $.ajax({
                        data:{
                            'code': $('#coupon_code').val(),
                            'plan': '{{slab.id}}',
                            'amount_to_pay': '{{renewal}}'
                        },
                        url: '/ajax/verify_code/',
                        type: 'post',
                        complete: function(){
                            $this.html('Verify Code').removeClass('disabled').attr('disabled', false);
                        },
                        success: function(data){
                            if(data.msg){
                                $('.discount-msg').html(data.msg)
                            }
                            else {
                                $('.discount-msg').html('');    
                            }
                            $form = $this.parents('form');
                            if(!data.success){
                                $('.discount-msg').addClass('text-danger');
                                $('.discount-amount').addClass('hidden').find('.amount').html('0.00');
                            }
                            else{
                                data.amount = parseFloat(data.amount).toFixed(2);
                                $('.discount-amount').removeClass('hidden').find('.amount').html(data.amount);
                                $('.discount-msg').removeClass('text-danger');
                                // if (!data.old){
                                //     $form.find('[name=amount_to_pay][type="hidden"]').val(data.amount)
                                //     $form.find('.consolidated_amount_to_pay .amount').html(data.amount);
                                // }
                                // else {
                                //     $form.find('[name=amount_to_pay][type="hidden"]').val($form.find('.original_amount .amount').html())
                                //     $form.find('.consolidated_amount_to_pay .amount').html($form.find('.original_amount .amount').html());
                                // }
                                // if (data.amount <= {{company.wallet.available|default:0}}){
                                //     $form.find('.credit_warning').html('');
                                //     $form.find('button.btn.btn-info').attr('type','submit').attr('data-toggle','');
                                // }
                                // else {
                                //     $form.find('button.btn.btn-info').attr('type','button').attr('data-toggle','collapse');
                                // }
                            }
                            consolidate_amount();
                        },
                        error: function(er){
                            console.log(er);
                        }
                    })
                })
                $('#added_users').change(function(){
                    update_user_cookie();
                    additional_users_charge();
                    consolidate_amount();                    
                });
            });
            $('button.btn.bill[href]').click(function(){
                $('html, body').animate({
                    scrollTop: $("#credits").offset().top -50
                }, 500);
                if($('#credits div.bg-white,#credits section.bg-white').hasClass('card-highlight')){
                    $('#credits div.bg-white,#credits section.bg-white').removeClass('card-highlight');
                    setTimeout(function(){
                        $('#credits div.bg-white,#credits section.bg-white').addClass('card-highlight');
                    }, 500);
                }
                else {
                    $('#credits div.bg-white,#credits section.bg-white').addClass('card-highlight');
                    $('#billing_form div.bg-white, #billing_form+div.bg-white').removeClass('card-highlight')
                }
            });
        </script>
    {% endif %}
{% endblock %}