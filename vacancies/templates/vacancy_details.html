{% extends "base/base.html" %}
{% load i18n %}
{#{% load pagination_tags %}#}
{% load TRM_tags %}

{% block meta %}
    <!-- Meta FB -->
    <meta property="og:title" content="{{ vacancy.employment }} - {{vacancy.function }}"/>
    <meta property="og:url" content="{{ vacancy.get_absolute_url }}"/>
    <meta property="og:description" content="{{ vacancy.description|striptags|rem_nbsp|safe }}" />
    {% if not vacancy.confidential %}
        <meta property="og:image" content="{{vacancy.company.logo.url}}" />
    {% endif %}
    <!-- Meta FB -->
    <!-- Meta TW -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@spotaxis" />
    <meta name="twitter:title" content="{{vacancy.company.name}} | {{ vacancy.employment }}" />
    <meta name="twitter:description" content="{{ vacancy.description|striptags|rem_nbsp|safe }}" />
    <meta name="twitter:image" content="{{vacancy.company.logo.url}}" />
    <!-- Meta TW -->
    <meta name="keyword" content="{% for skill in vacancy.skills %}{{skill}}, {% endfor %}{{vacancy.employment}}, {{vacancy.function}}, {{vacancy.company}} Job Openings"/>
    <meta name="description" content="{{ vacancy.description|striptags|rem_nbsp|safe }}"/>
{% endblock %}

{% block title %}{{vacancy.company.name}} | {{ vacancy.employment }}{% endblock %}
{% block css %}
    <link href="{{STATIC_URL}}datepicker/css/datepicker3.css" rel="stylesheet" type="text/css"/>
    <link href="{{STATIC_URL}}daterange/daterangepicker.css" rel="stylesheet">
{% endblock %}
{% block subnav %} 
    {% if vacancy.status.codename == 'open' %}       
        <nav class="navbar navbar-short navbar-default" id="navbar-short">
            <div class="container-fluid" id="navbar_short">
                <ul class="nav navbar-nav">
                    {% if recruiter %}
                        <li class="active">
                            <a class="" href="{{vacancy.get_absolute_url}}">Job Details</a>
                        </li>
                        <li class="{% if isTeam %} active {% endif %}">
                            <a class="" href="{% url 'vacancies_get_vacancy_stage_details' vacancy.id 0%}">Hiring Process{% if vacancy.hasUnseen %}
                                <span class="badge badge-sm badge-danger va-mid inline-block relative mt-8">{{vacancy.hasUnseen}}</span>
                                {% endif %}</a>
                        </li>
                        <li>
                            <a class="" href="{% url 'vacancies_talent_sourcing' vacancy.id %}">Talent Sourcing</a>
                        </li>
                    {% else %}
                        <li class="">
                            <a class="" href="{% url 'TRM-Subindex' %}"><i class="fa fa-arrow-left fa-sm"></i> Back to {{vacancy.status|title}} Jobs</a>
                        </li>
                    {% endif %}
                    {%for status in statuses %}
                        <li class="{% if status.codename == vacancy_status.codename %}active{%endif%}"><a href="{% url 'companies_vacancies_by_status' status.codename %}">{{status}}</a></li>
                    {%endfor%}
                </ul>
            </div>
        </nav>
        {% include 'vacancies/referer_sub_nav.html' %}        
    {% endif %}
{% endblock %}
{% block content %}
    <!-- Content starts -->
    {# Modals Company #}
    {% if user_profile == 'recruiter' and user.recruiter.is_manager %}
        {# Modals - Action Buttons | Back, End or Post Vacancies #}

        <!-- Publish Vacancy Modal -->
        {% if vacancy.status.codename == 'open' %}
            {% if vacancy.scheduled or vacancy.expired %}
                <div class="modal fade" id="publish-vac-modal" role="dialog" tabindex="-1">
                    <div class="modal-dialog">
                        <form class="modal-content" action="" method="post" id="pub-vac-form">
                            {% csrf_token %}
                            <div class="modal-header no-border">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title text-center"><span class="text-light">{% if vacancy.expired %}Republish{%else%}Publish{%endif%}</span> <span  id="pub-vac-modal-text"></span> <span class="text-light"></span></h4>
                            </div>
                            {% if vacancy.company|args:'JM_DURATION'|call:'check_service' %}
                                <div class="modal-body border-top border-bottom border-light">
                                    <div class="input-group input-group-sm">
                                        <div class="input-group-addon">
                                            <i class="fa fa-clock-o fa-lg"></i>
                                        </div>
                                        <input type="text" id="id_pub_date" name="publish_period" class="form-control">
                                    </div>
                                </div>
                            {% endif %}
                            <div class="modal-footer text-center no-border">
                                <button id="btn-publish-vacancy" class="btn btn-info">{% trans 'Publish' %}</button>
                                <button type="button" class="btn btn-danger"
                                        data-dismiss="modal">{% trans 'Cancel' %}</button>
                            </div>
                        </form>
                    </div>
                </div>
            {% else %}
                <div class="modal fade" id="unpublish-vac-modal" role="dialog" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header no-border">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title text-center"><span class="text-light">UnPublish</span> <span  id="unpub-vac-modal-text"></span> <span class="text-light">now</span></h4>
                            </div>
                            <div class="modal-footer text-center no-border">
                                <a id="btn-unpublish-vacancy" href="" class="btn btn-info">Unpublish</a>
                                <button type="button" class="btn btn-danger"
                                        data-dismiss="modal">{% trans 'Cancel' %}</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endif %}
        {# Modals Company #}

    {% elif user_profile == 'candidate' %}

        <!-- Postulate Job Modal -->
        <div class="modal fade" id="post-vac-modal" role="dialog" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">{% trans 'Apply' %}...</h4>
                    </div>
                    <div class="modal-body" id="postulate-modal-text">
                        <p>{% trans 'Do you want to send your resume and apply to this job?' %}</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-info" data-dismiss="modal">{% trans 'Close' %}</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Postulate Job Modal -->

    {% endif %}
    {% if socialApplication %}
        <div class="modal fade" id="social-application-modal" role="dialog" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body" id="postulate-modal-text">
                        <div class="mt30 text-success mb30">
                            <h1 class="text-center no-margin"><i class="ionicons ion-android-checkmark-circle"></i></h1>
                            <h2 class="text-center no-margin">Applied!</h2>
                        </div>
                        <button class="center-block btn btn-info pl30 pr30 mb30" data-dismiss="modal">Done</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    {% if recruiter %}
        <div class="modal fade" id="share-to-social-modal" role="dialog" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">

                    <div class="modal-header">

                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h3 class="text-center no-margin">One Click Social Referal</h3>
                    </div>
                    <div class="modal-body row pt20 pb50" id="smart-share">
                        <form method="post" action="." id="smart-share-form">
                            {% csrf_token %}
                            <input type="hidden" name="socialshare" value="1">
                            <div class="col-xs-12 col-md-8 col-md-push-2">
                                <textarea class="form-control autosize no-shadow" rows="3" placeholder="Message" name="message"></textarea>
                                <div class="textarea-foot">
                                    <span class="inline-block" id="link_to_share">{{request.build_absolute_uri}}</span>
                                    <span class="pull-right no-margin checkbox checkbox-info checkbox-circle">
                                        <input type="checkbox" name="add_referal_link" id="add_referal_link" checked>
                                        <label for="add_referal_link" class="lh1"> Referal Link</label>
                                    </span>
                                </div>
                            </div>
                            <div class="mt20 bordered border-light col-xs-12 col-md-8 col-md-push-2 no-padding">
                                <img src="{{og.image}}" class="user-photo-lg card-left img-responsive va-mid">
                                <div class="inline-block  ml150 pl10 pr10 pt10 pb10 border-left h150 border-light" style="overflow:hidden">
                                    <h4 class="no-margin mb10">{{og.title|title}}</h4>
                                    <p><small>{{og.description}}</small></p>
                                    <div class="fader border-right border-light">
                                    </div>
                                    <div class="og-footer">
                                        <small><b class="pull-right text-light pl10 pr10 pt5 pb5">{{og.url|upper}}</b></small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12"><hr></div>
                            <div class="col-xs-12" id="smart-share-content">

                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    {% if vacancy.public_cvs %}
        <!-- Modal - Privacy Policy -->
        <div class="modal fade" id="privacy-policy-modal" role="dialog" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-body" id="privacy-policy-modal-body">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        {% include 'privacy_policy_include.html' %}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-info" data-dismiss="modal">{% trans 'Close' %}</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal - Terms and Conditions-->
        <div class="modal fade" id="terms-and-conditions-modal" role="dialog" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-body" id="terms-and-conditions-modal-body">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        {% include 'terms_and_conditions_include.html' %}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-info" data-dismiss="modal">{% trans 'Close' %}</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    <div class="jumbotron no-padding bg-white pt20">
        <div class="container">
            <div class="row no-margin">
                <div class="col-xs-12 col-md-9 mt40 mb40">

                    <div class="card-left card-large va-top mb20">
                        <img class="img-responsive inline-block company-logo user-photo bordered br-2" src = "{{MEDIA_URL}}{{vacancy.company.logo}}" alt="{{vacancy.company.name}} Logo">
                    </div>
                    <div class="inline-block card-block">
                        <h2 class=" inline-block text-light no-margin-y">{% if vacancy.employment|length < 30 %} {{vacancy.employment}} {% else %} <span class="vname collapse fade in"> {{vacancy.employment|uptill:30}} <span data-toggle="collapse" data-target=".vname" class="text-info clickable"> ... </span> </span> <span class="vname collapse fade"> {{vacancy.employment}} </span> {% endif %}
                        </h2>
                            {% if vacancy.status.codename == 'open' %}
                                {% if vacancy.expired %}<label class="label label-danger-trans label-xs va-mid inline-block mb15 ml10">Unpublished</label>{% endif %}
                                {% if vacancy.scheduled %}<label class="label label-info-trans label-xs va-mid inline-block mb15 ml10">Scheduled</label>{% endif %}
                            {% endif %}
                         <br>
                        <a href="{% with vacancy.company.web|default:active_host as uri %}{%if 'http://' in uri or 'https://' in uri %}{{uri}}{%else%}//{{uri}}{%endif%}{%endwith%}">{{vacancy.company|title}}</a><br>
                        <div class="inline-block">
                            <span><i class="fa fa-map-marker"></i> {{vacancy.city}}, {{vacancy.state}}, {{vacancy.nationality}}</span><br>
                            <span><i class="fa fa-gears"></i> {{vacancy.industry}}</span>
                            <small class="pl20 inline-block"><i class=" fa fa-cog"></i> {{vacancy.function}}</small>
                        </div><br>
                        <div class="hidden-md hidden-lg">
                            
                            <span class="mr20"><i class="fa fa-calendar"></i> <span class="text-light">{%if vacancy.status.codename == 'open' and vacancy.scheduled %}Publishing{%else%}Published{%endif%} on</span> {{ vacancy.pub_date }}</span><br>
                            {% if not vacancy.scheduled %}
                            <span class="mr20"><i class="fa fa-calendar"></i> {% if vacancy.status.codename == 'closed' or vacancy.expired%}<span class="text-light">Ended on</span> {{vacancy.unpub_date}}{%elif not vacancy.scheduled %} <span class="text-light">Open for</span> {% with vacancy.unpub_date|timeuntil as remaining %}{% if remaining|ascii:'ignore' == '0 minutes' %}Today{%else %}{{remaining}}{% endif %}{% endwith%}{%endif%}</span>
                            {% endif %}
                        </div>
                        <span class="tags"><span class="label label-trans"><i class="fa fa-black-tie"></i> {{vacancy.employmentType}}</span></span> <small class="inline-block">{% if vacancy.status.codename == 'closed' %} - Closed {% else %} - No of Openings: <span class="text-light">{{ vacancy.vacancies_number }}</span>{%endif%}</small>
                    </div>
                    {% if request.user.is_anonymous %}
                        <a class="btn  btn-info btn-default pull-right visible-xs visible-sm" href="{% url 'auth_login' %}?next={{request.path}}">Employer Login</a>
                    {% endif %}
                </div>
                <div class="col-md-3 mt40 no-padding hidden-sm hidden-xs">
                    {% if request.user.is_anonymous %}
                        <a class="btn  btn-info btn-default pull-right" href="{% url 'auth_login' %}?next={{request.path}}">Employer Login</a>
                    {% endif %}
                    <div class="mt40 pt20 pl20 ml5">
                            
                        <span class="mr20"><i class="fa fa-calendar"></i> <span class="text-light">{%if vacancy.status.codename == 'open' and vacancy.scheduled %}Publishing{%else%}Published{%endif%} on</span> {{ vacancy.pub_date }}</span><br>
                        {% if not vacancy.scheduled %}
                        <span class="mr20"><i class="fa fa-calendar"></i> {% if vacancy.status.codename == 'closed' or vacancy.expired%}<span class="text-light">Ended on</span> {{vacancy.unpub_date}}{%elif not vacancy.scheduled %} <span class="text-light">Open for</span> {% with vacancy.unpub_date|timeuntil as remaining %}{% if remaining|ascii:'ignore' == '0minutes' %}Today{%else %}{{remaining|safe}}{% endif %}{% endwith%}{%endif%}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% comment %} {% if recruiter %}
        <nav class="navbar navbar-affix navbar-default" id="navbar-affix">
            <div class="container-fluid" id="navbar_short">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a class="" href="{{vacancy.get_absolute_url}}">Job Details</a>
                    </li>
                    <li class="{% if isTeam %} active {% endif %}">
                        <a class="" href="{% url 'vacancies_get_vacancy_stage_details' vacancy.id 0%}">Hiring Process{% if vacancy.hasUnseen %}
                            <span class="badge badge-sm badge-danger va-top inline-block relative mt-8">{{vacancy.hasUnseen}}</span>
                        {% endif %}</a>
                    </li>
                    <li>
                        <a class="" href="{% url 'companies_add_update_vacancy_talent_sourcing' vacancy.id %}">Talent Sourcing</a>
                    </li>
                </ul>
            </div>
        </nav>
    {% endif %} {% endcomment %}
    {% if not socialUser %}
        <section class="container no-padding mt10">
            <div class="row">
                <div class="col-md-9 page-content">
                    {% if recruiter %}
                    <div class="pt5 pl10 pr10 pb10 br-2 bg-white">
                        <div class="row text-center">
                            <div class="col-xs-12">
                                <small class="text-light">This is only visible to you.</small>
                            </div>
                        </div>
                        <div class="row text-center">
                            <div class="col-xs-6 col-sm-6 col-md-2 pt20 pb20">
                                <h4 class="text-light">Views</h4>
                                <h6 class="text-muted pt10">{{ vacancy.seen }}</h6>
                            </div>
                            <div class="col-xs-4 col-sm-6 col-md-4 col-lg-3 pt20 pb20">
                                <h4 class="text-light">Applications Received</h4>
                                <h6 class="text-muted pt10">{{vacancy.application_count}}</h6>
                            </div>
                            <div class="col-xs-10 col-sm-6 col-xs-push-2 col-md-6 col-lg-7 col-md-push-0 text-left pl20 md-pt40">
                                <i class="fa fa-check"></i> <span class="text-light">Status:</span> {{vacancy.status}}<br>
                                {% comment %}
                                {% if vacancy.postulate %}
                                    <i class="fa fa-check"></i> <span class="text-light">Send Applications To:</span> {{vacancy.email}}<br>
                                {%endif%}
                                {% endcomment %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    <!--img src="{{ MEDIA_URL }}{{ vacancy.company.logo }}" alt="logo" class="img-thumbnail img-responsive center-block logo-detail"-->
                    <div class="pt10 pl10 pr10 pb10 br-2 bg-white mt10">
                        <p class="tags tags-xs">{% for skill in vacancy.skills_as_list%}<span class="bg-default">{{skill}}</span>
                        {%endfor%}</p>
                        <p class="lead">{{vacancy.description|safe}}</p>
                    </div>
                    <h4 class="text-light mt20 ml20">Preferences</h4>
                    <div class="pt10 pl10 pr10 pb10 br-2 bg-white">
                        {# <hr class="header-seperator"> #}
                        <div class="row mt10 mb10">
                            {% if vacancy.salaryType %}
                                <div class="col-sm-6 mb10 mt10">
                                    <span><i class="fa fa-money fa-lg"></i><span class="text-light"> Salary:</span> {% if vacancy.salaryType.codename == 'fixed' %}
                                        {{vacancy.currency.symbol|safe|default:'&#8377;'}} {{ vacancy.min_salary }}{% if vacancy.min_salary != vacancy.max_salary %} - {{vacancy.currency.symbol|safe|default:'&#8377;'}} {{ vacancy.max_salary }}{% endif %}
                                    {% else %}
                                        {{ vacancy.salaryType }}
                                    {% endif %}</span>
                                </div>
                            {% endif %}
                            <div class="col-sm-6 mb10 mt10">
                                <i class="fa fa-sort-numeric-asc fa-lg"></i> <span class='text-light'>Age:</span> {{vacancy.age_preference}}
                            </div>
                            <div class="col-sm-6 mb10 mt10">
                                <i class="fa fa-venus-mars fa-lg"></i> <span class="text-light">Gender:</span> {{ vacancy.gender|default:'Any' }}
                            </div>
                            {% if vacancy.hiring_date %}
                                <div class="col-sm-6 mb10 mt10">
                                    <i class="fa fa-calendar fa-lg"></i> <span class="text-light">Expected Join Date:</span> {{ vacancy.hiring_date }}
                                </div>
                            {% endif %}
                            <div class="col-sm-6 mb10 mt10">
                                <i class="fa fa-briefcase fa-lg"></i> <span class="text-light">Experience:</span> {{vacancy.employment_experience}}
                            </div>
                            {% if vacancy.notice_period %}
                                <div class="col-sm-6 mb10 mt10">
                                    <i class="fa fa-clock-o fa-lg"></i> <span class="text-light">Max Notice Period:</span> {{ vacancy.notice_period.1 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    {% if objFiles %}   
                        <h4 class="text-light mt20 ml20">Attachments</h4>             
                        <div class="pt10 pb10 pl10 pr10 br-2 bg-white" >
                            <!-- List of attachments -->
                            <div class="row mb10">
                                <div class="col-md-12">
                                    <div>
                                        {% for file in objFiles %}
                                            <!-- List of Files -->
                                            <p>
                                                {% if file.ext == '.pdf' %}
                                                    <i class="fa fa-file-pdf-o"></i>
                                                {% elif file.ext == '.doc' or file.ext == '.docx' %}
                                                    <i class="fa fa-file-word-o"></i>
                                                {% elif file.ext == '.xls' or file.ext == '.xlsx' %}
                                                    <i class="fa fa-file-excel-o"></i>
                                                {% elif file.ext == '.ppt' or file.ext == '.pptx' %}
                                                    <i class="fa fa-file-powerpoint-o"></i>
                                                {% elif file.ext == '.jpg' or file.ext == '.jpeg' or file.ext == '.png' %}
                                                    <i class="fa fa-picture-o"></i>
                                                {% endif %}
                                                <a href="{{ file.file.url }}" target="_blank" class="ml5">
                                                    {{ file.filename }}
                                                </a>
                                                - <span class="size">{{ file.file.size|filesizeformat }}</span>
                                            </p>
                                        {% endfor %}{# for file in objFiles #}
                                    </div>
                                    <hr>
                                </div>
                            </div>
                            <!-- List of attachments -->
                        </div><!-- Job Description -->
                    {% endif %}{# if objFiles  #}

                    {% if vacancy.questions %}
                        <!-- Comments Section -->
                        <section id="questions" class="hidden">

                            {% if question_published %}
                                <div class="alert alert-success mb20">
                                    <h6><i class="fa fa-check-circle fa-lg" style="margin-right: 12px;"></i>
                                        {% trans 'We have succcessfully posted your question. You will be notified via email when answered.' %}
                                    </h6>
                                    <a href="#" class="close fa fa-times"></a>
                                </div>
                            {% endif %}

                            <div class="white-container-blue-bottom">
                                <h4 class="text-light ">{% trans 'Questions / Comments' %}</h4>

                                {% if questions %}
                                    {# Show existing questions / comments #}
                                    {% for question in questions %}

                                        <div class="questions-item">
                                            <span class="questions-question">
                                                <i class="fa fa-comments color-blue" ></i> {{ question.question }}
                                                {% if user_profile == 'recruiter' %}
                                                     -
                                                    <a
                                                        href="{% url 'candidates_edit_curriculum' candidate_id=question.user.candidate.pk %}"
                                                        target="_blank"
                                                        style="color: #E06113">
                                                     <i class="fa fa-male ml7 mr7" data-toggle="tooltip" data-placement="top" title="Enviado por {{ question.user.get_full_name }}"></i></a>
                                                {% endif %}
                                                <small><span class="questions-sincetime"> - {{ question.question_date|timesince}} ago</span></small>
                                            </span>
                                            {% if question.answer %}
                                                <br>
                                                <span class="questions-answer">
                                                    <i class="fa fa-comments color-green"></i>
                                                     {{ question.answer }}
                                                    <small><span class="questions-sincetime"> - {{ question.answer_date|timesince}} ago</span></small>
                                                </span>

                                            {% elif not question.answer and my_vacancy and vacancy.status.codename == 'active' %}
                                                <br>
                                                <span class="questions-answer"><i class="fa fa-comments color-green"></i>
                                                    <button class="btn btn-link btn-link-answer" id="btn_toggle_{{question.pk}}" onclick='show_form_answer({{ question.pk }});'>{% trans 'Answer' %}</button>
                                                </span>

                                                <!-- Response Submission Form -->
                                                <div style="display: none" id="div_form_answer_{{ question.pk }}">

                                                    <form id="id_form_answer_{{ question.pk }}" action="." method="post" >
                                                        {% csrf_token %}
                                                        <div class="form-group">
                                                                <label id="id_label_answer_{{ question.pk }}" for="id_text_answer_{{ question.pk }}">{% trans 'Enter a reply' %}</label>
                                                            <div id="div_answer_{{ question.pk }}" class="{% if form_question.question.errors %}has-error{% endif %} mb20">
                                                                <textarea
                                                                    id="id_text_answer_{{ question.pk }}"
                                                                    class="form-control"
                                                                    placeholder="Responda a esta pregunta"
                                                                    rows="3"></textarea>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-4 col-md-offset-4 col-xs-12">
                                                                <button
                                                                        type="submit"
                                                                        id="id_answer_button_{{ question.pk }}"
                                                                        name="create-btn"
                                                                        class="btn btn-info btn-block"
                                                                        >
                                                                    <i class="fa fa-comments"></i> {% trans 'Answer' %}
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <input id="{{ question.pk }}" name="id_question" type="hidden" value="{{ question.pk }}">
                                                    </form>

                                                <!-- End response submission form -->
                                                </div>

                                            {% endif %}{# elif not question.answer and user_profile == 'recruiter' #}
                                        </div>
                                    {% endfor %}{# for questions #}
                                {% else %}
                                    <div class="mt15">
                                        <strong>
                                            {% trans 'This application does not have any questions.' %}
                                            {% if not user.is_authenticated %}
                                                <a href="{% url 'auth_login' %}?next={% url 'vacancies_get_vacancy_details' vacancy.pk %}">Log In</a> to post a question to this job opening.
                                            {% endif %}
                                        </strong>
                                    </div>
                                {% endif %}{# if questions #}

                                {% if user_profile == 'candidate' %}
                                    {# Form for sending questions - Candidates #}
                                    <form id="form_question" enctype="multipart/form-data" action="." method="post" role="form" class="mt15" onsubmit="return do_question()">
                                        {% csrf_token %}
                                        <div class="form-group">
                                            {% if form_question.question.errors %}
                                                <ul class="list-unstyled error-list">
                                                    {% for error in form_question.question.errors %}
                                                        <li>{{ error|escape }}</li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <label id="label_question" for="id_question">{% trans 'Do you have any questions about this job opening?' %}</label>
                                            {% endif %}
                                            <div id="div_question" class="{% if form_question.question.errors %}has-error{% endif %} mb20">
                                                {{ form_question.question }}
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 col-md-offset-4">
                                                <button type="submit" id="submit_btn" class="btn btn-info btn-block"><i class="fa fa-comments"></i> {% trans 'Send questions' %}</button>
                                            </div>
                                        </div>
                                    </form>
                                {% endif %} {#  if 'candidate' #}

                            </div>
                            <hr>
                        </section><!--Questions section -->
                    {% endif %} {# End questions section #}             

                    {% if not vacancy.confidential %}
                        {% if vacancy.company.description %}
                            <div class="pt10 pb10 pl10 pr10 br-2 bg-white mt20 mb20">
                                <a href="#">
                                    <h6 class="color-green bottom-line mt5">{{ vacancy.company.social_name }}</h6>
                                </a>
                                {{ vacancy.company.description|safe }}
                            </div>
                        {% endif %}
                    {% endif %}

                </div> <!-- Vacancy Description -->
                
                <div class="col-md-3 pt20 bordered-left mb20">
                    {% if my_vacancy and user.recruiter.is_manager %}
                        {% if not vacancy.status.codename == 'closed' %}
                            {% if vacancy.scheduled or vacancy.expired %}
                                {% if today <= vacancy.editing_date %}
                                    {% comment %} The vacancy to be adjusted {% endcomment %}
                                    <a href="{% url 'companies_add_update_vacancy' vacancy.id %}" class="btn btn-block btn-default">
                                        <i class="fa fa-pencil"></i> {% trans 'Update' %}
                                    </a>
                                {% endif %}
                                <button type="button" class="btn btn-block btn-info" onclick='publish_vac("{{ vacancy.employment|title }}", "{% url 'companies_publish_vacancy' vacancy.id %}");' data-toggle="modal" data-target="#publish-vac-modal">
                                    <i class="fa fa-pointer fa-check-square-o"></i> {% if vacancy.hasbeenPublished %} Republish {% else %} Publish {% endif %}
                                </button>

                                <hr>
                            {% else %}
                                <button type="button" class="btn btn-block btn-info" onclick='unpublish_vac("{{ vacancy.employment|title }}", "{% url 'companies_unpublish_vacancy' vacancy.id %}");' data-toggle="modal" data-target="#unpublish-vac-modal">
                                    <i class="fa fa-pointer fa-check-square-o"></i> Unpublish
                                </button>

                                <hr>

                            {% endif %}
                        {# If has ended #}
                        {% endif %}
                        {% if vacancy.company.vacancy_set.all.count and vacancy.company|args:'JP_TEMPLATE'|call:'check_service' %}
                            <form action="{% url 'companies_add_update_vacancy'%}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="template" value="{{vacancy.id}}">
                                <button class="btn btn-block btn-info">
                                    <i class="fa fa-pointer fa-check-square-o"></i> Publish Similar Job</button>
                            </form>
                            <hr>
                        {% endif %}
                    {% endif %}{# If is company #}
                    {% if user.is_authenticated and not postulate and not user_profile == 'recruiter' and vacancy.status.codename == 'open' %}
                        <!-- To mark/unmark a job as favourite -->
                        <button id="btn_fav_{{ vacancy.pk }}" {%if not user.is_authenticated %} data-target="#trm_apply" data-toggle="modal" {%endif%} onclick="{% if request.user.is_authenticated%}mark_unmark_favorite({{ vacancy.pk }}){%else%}changeloginredirect('mark_for_later'){%endif%}" class="mt20 btn btn-sm btn-block btn-default">
                            <i class="fa fa-heart {%if is_favorite%}text-danger{%endif%}"></i> {% if is_favorite %}{% trans 'Forget' %}{% else %}{% trans 'Apply Later' %}{% endif %}
                        </button>
                        <hr>
                    {% endif %}
                    {% if vacancy.status.codename == 'open' %}
                        <h4 class="text-center text-muted">Share</h4>
                        <div class="copy-block">
                            <p><span class="text-light">Copy Link</span><span class="pull-right btn-copy-text hidden pr5 text-info">Copied</span></p>
                            <div class="input-group">
                                <input type="text" value="{{vacancy.get_absolute_url|lower|appendURL:myreferal}}" class="form-control" id="share_vacancy_url" data-toggle="tooltip" title="{{vacancy.get_absolute_url|lower|appendURL:myreferal}}">
                                <div class="input-group-btn"><button class="btn btn-info btn-copy" data-clipboard-action="copy" data-clipboard-text="{{vacancy.get_absolute_url|lower|appendURL:myreferal}}" data-clipboard-target="#share_vacancy_url"><i class="fa fa-copy"></i></button></div>
                            </div>
                        </div>
                        {% if recruiter %}
                            <button class="mt20 btn btn-block btn-default" data-toggle="modal" data-target="#share-to-social-modal">One Click Social Referal  - <span class="text-facebook"><i class="fa fa-facebook"></i></span> <span class="text-linkedin"><i class="fa fa-linkedin"></i></span> <span class="text-twitter"><i class="fa fa-twitter"></i></span></button>
                        {% else %}
                            <div class="mt20">
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{vacancy.get_absolute_url|lower|appendURL:myreferal}}&redirect_uri={{vacancy.get_absolute_url|lower|appendURL:myreferal}}" class="ml10 btn pt10 btn-facebook btn-round"><i class="fa fa-facebook fa-lg"></i></a>
                            <a href="https://twitter.com/home?status={{vacancy.get_absolute_url|lower|appendURL:myreferal}}" class="ml10 btn pt10 btn-round btn-twitter text-inverse"><i class="fa fa-twitter fa-lg"></i></a>
                            <a href="https://plus.google.com/share?url={{vacancy.get_absolute_url|lower|appendURL:myreferal}}" class="ml10 btn pt10 btn-round btn-google-plus"><i class="fa fa-google-plus fa-lg"></i></a>
                            <a href="https://www.linkedin.com/shareArticle?mini=true&url={{vacancy.get_absolute_url|lower|appendURL:myreferal}}" class="ml10 btn pt10 btn-round btn-linkedin text-inverse"><i class="fa fa-linkedin fa-lg"></i></a>
                            </div>
                        {% endif %}
                        <hr>
                        {% if not socialApplication %}
                            {%if not user.is_authenticated and vacancy.public_cvs and not vacancy.expired and vacancy.hasbeenPublished %}
                                {% if request.session.fill_template == vacancy.id or fill_template == vacancy.id %}
                                    <button class="btn btn-block btn-default" data-toggle="modal" data-target="#custom-form">Complete Application</button>
                                {% else %}
                                    <button class="btn btn-block btn-default" data-toggle="modal" data-target="#public_apply">Apply</button>
                                {% endif %}
                            {% endif %}
                            {%if request.user.is_anonymous or request.user.profile.codename == 'candidate' %}
                                {% if not postulate %}
                                    <!-- <button id="trm_apply_button" class="btn btn-block btn-spotaxis" onclick="{% if user.is_authenticated%}postulate({{ vacancy.pk }},this){%else%}changeloginredirect('apply'){%endif%}" {%if not user.is_authenticated %} data-target="#trm_apply" data-toggle="modal" {%endif%}> Apply {%if not user.is_authenticated%} via <small class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-spotaxis fa-stack-1x text-primary"></i></small> {%endif%}</button> -->
                                {%else%}
                                    {% if not postulate.withdraw %}
                                        {% if not postulate.finalize %}
                                            <button class="btn btn-block btn-default withdraw" ><i class='fa fa-pointer fa-check-square-o'></i> Withdraw Application</button>
                                        {% endif %}
                                    {% else %}
                                        <button class="btn btn-block btn-default disabled"> Withdrawn by You</button>
                                    {% endif %}
                                {%endif%}
                            {% endif %}
                            {% if  vacancy.postulate %}
                                {# {% if not user.is_authenticated or not user_profile == 'recruiter' %} #}
                                {% if user.is_authenticated and not user_profile == 'recruiter' %}
                                    {% if not postulate %}
                                        <button id="trm_apply_button" class="btn btn-block btn-spotaxis" onclick="{% if user.is_authenticated%}postulate({{ vacancy.pk }},this){%else%}changeloginredirect('apply'){%endif%}" {%if not user.is_authenticated %} data-target="#trm_apply" data-toggle="modal" {%endif%}> Apply {%if not user.is_authenticated%} via <span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-spotaxis fa-stack-1x text-primary"></i></span> {%endif%}</button>
                                    {%else%}
                                        {% if not postulate.withdraw %}
                                            {% if not postulate.finalize %}
                                                <button class="btn btn-block btn-default withdraw" ><i class='fa fa-pointer fa-check-square-o'></i> Withdraw Application</button>
                                            {% endif %}
                                        {% else %}
                                            <button class="btn btn-block btn-default disabled"> Withdrawn by You</button>
                                        {% endif %}
                                    {% endif %}
                                {%endif%}
                            {% endif %}
                        {% endif %}
                        {%comment %}
                            {% if vacancy.postulate  and request.user.is_anonymous %}
                                <a href="{% url 'vacancies_apply_via_social' vacancy.pk 'fb' %}" class="btn btn-block btn-default btn-facebook">Apply via <span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-facebook fa-stack-1x text-primary"></i></span></a>
                                <a href="{% url 'vacancies_apply_via_social' vacancy.pk 'li' %}" class="btn btn-block btn-linkedin">Apply via <span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-linkedin fa-stack-1x text-primary"></i></span></a>
                                <a href="{% url 'vacancies_apply_via_social' vacancy.pk 'gp' %}" class="btn btn-block btn-google-plus">Apply via <span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-google-plus fa-stack-1x text-primary"></i></span></a>
                                <a href="{% url 'vacancies_apply_via_social' vacancy.pk 'gh' %}" class="btn btn-block btn-github">Apply via <span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-github fa-stack-1x text-primary"></i></span></a>
                                <a href="{% url 'vacancies_apply_via_social' vacancy.pk 'so' %}" class="btn btn-block btn-stack-overflow">Apply via <span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-overflow fa-stack-1x text-primary"></i></span></a>
                            {% endif %} 
                        {% endcomment %}
                        {% if recruiter %}
                            <button class="btn btn-sm center-block mb10 btn-info btn-block" data-toggle="modal" data-target="#public_apply">Add a Candidate</button>
                            <hr>
                        {% endif %}
                    {% endif %}
                    {% if recruiter %}
                        <h4 class="text-center text-muted">Hiring Process<br>
                            {% if not vacancy.status.codename == 'closed' and recruiter.is_manager and vacancy.company|args:'AT_CUSTOM_HIRING_PROCESS'|call:'check_service' %}
                                <small><small><a class="clickable" data-toggle="modal" data-target="#timeline_management"><i class="fa fa-pencil"></i> Manage</a></small></small>
                            {% endif %}
                        </h4>

                        <hr class="header-seperator">
                        <ul class="nav timeline">

                            <!-- Item 1 -->
                            <li class="hidden">
                                <div class="direction-r">
                                    <div class="flag-wrapper">
                                        <span class="flag"><a href="{% url 'vacancies_get_vacancy_stage_details' vacancy.id 0%}">Applications Received</a></span>
                                        <span class="time-wrapper"><span class="time">{{vacancy.postulated.count}}</span></span>
                                    </div>
                                </div>
                            </li>

                            {% for stage in stages %}
                                <li>
                                    <div class="direction-r">
                                        <div class="flag-wrapper">
                                            <span class="flag"><a href="{% url 'vacancies_get_vacancy_stage_details' vacancy.id stage.order%}">{{stage.stage}}</a> </span>
                                            <span class="time-wrapper"><span class="time">{{stage.active_count}}</span></span>
                                        </div>
                                    </div>
                                </li>
                            {% endfor %}
                          

                            <!-- Item 3 -->
                            <li class="hidden">
                                <div class="direction-r">
                                    <div class="flag-wrapper">
                                        <span class="flag"><a href="{% url 'vacancies_get_vacancy_stage_details' vacancy.id 100%}">Onboarding</a></span>
                                        <span class="time-wrapper"><span class="time">{{vacancy.finalized_count}}</span></span>
                                    </div>
                                </div>
                            </li>
                          
                        </ul>
                    {% endif %}
                    {% if my_vacancy%}
                        {% if vacancy.status.codename == 'open' %}
                            <hr>
                            {% if today <= vacancy.editing_date and user.recruiter.is_manager %}
                                {% comment %} The job to be adjusted {% endcomment %}
                                <a href="{% url 'companies_add_update_vacancy' vacancy.id %}" class="btn btn-block btn-default">
                                    <i class="fa fa-pencil"></i> {% trans 'Update' %} <small class="text-light">(Editable till - {{ vacancy.editing_date }})</small>
                                </a>
                            {% endif %}
                            {% if user.recruiter.is_manager %}
                                <a class="btn btn-block btn-default" href="{% url 'vacancies_get_vacancy_stage_details' vacancy.id 100 %}">
                                    <i class="fa fa-pointer fa-trash"></i> {% trans 'Close this Job' %}
                                </a>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </section>
    {% else %}
        {% include 'breadcrumb.html' %}
    {% endif %}
    <!-- Content ends -->
    {% if vacancy.public_cvs or recruiter and vacancy.status.codename == 'open' %}
        {% if fill_template == vacancy.id or request.session.fill_template == vacancy.id %}
        {% else %}
        <div class="modal fade" tabindex="-1" role="dialog" id="public_apply">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title text-center">Apply for {{vacancy.employment}}</h4>
              </div>
              <div class="modal-body">
                <section id="public-form">
                                {% if my_vacancy or not user_profile %}
                                    {% include "form_public_file.html" %}
                                {% endif %}
                            </section>
                            </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        {% endif %}
    {% endif %}
    {% if not user.is_authenticated and vacancy.status.codename == 'open' %}

        <div class="modal fade" tabindex="-1" role="dialog" id="trm_apply">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Apply for {{vacancy.employment}}</h4>
                </div>
                <div class="modal-body">
                    <section id="public-form">
                        {% if my_vacancy or not user_profile %}
                            {% include "login_form.html" %}
                        {% endif %}
                    </section>
                </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    {% endif %}
    {% if recruiter and recruiter.is_manager and not vacancy.status.codename == 'closed' and vacancy.company|args:'AT_CUSTOM_HIRING_PROCESS'|call:'check_service' %}
        {% include 'vacancies/manage_process_modal.html' %}
    {% endif %}
    {% if request.session.fill_template == vacancy.id or fill_template == vacancy.id %}
        <!-- Content starts -->
        {% with templated_form as form %}
        <div class="modal fade" tabindex="-1" role="dialog" id="custom-form">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title text-center">Few more questions...</h4>
                    </div>
                    <div class="modal-body">
                        {% include 'templated_form.html' %}
                    </div>
                </div>
            </div>
        </div>
        {% endwith %}
    {% endif %}
{% endblock %}

{% block java_script_code %}
    <script src="{{STATIC_URL}}js/jquery-ui.min.js"></script>
    <script src="{{STATIC_URL}}datepicker/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}ckeditor/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}ckeditor/ckeditor-init.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}daterange/moment.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}daterange/daterangepicker.js"></script>
    <script type="text/javascript">
        new Clipboard('.btn-copy');
        {% if my_vacancy or not user_profile %}
            $('#id_file').change(function(){
                if(this.files && this.files[0] && this.files[0].size > 5*1024*1024) {
                    alert('File exceeds 5MB file size')
                    this.value="";
                }
            })
        {% endif %}
        $('.btn-copy').click(function(){
            $this = $(this);
                $this.parents('.copy-block').find('.btn-copy-text').removeClass('hidden')
                $this.parents('.copy-block').find('.btn-copy-text').addClass('animated fadeOutUp');
                setTimeout(function(){
                    console.log($this);
                    $this.parents('.copy-block').find('.btn-copy-text').addClass('hidden');
                    $this.parents('.copy-block').find('.btn-copy-text').removeClass('animated fadeOutUp')
                },500);
            });
        {% if my_vacancy %}
            // Only for job owners
            function finalize_vac(text, href) {
                // Change modal texts to end a job
                $('#fin-vac-modal-text').text(text);
                $('#btn-finalize-vacancy').attr("href", href)
            }

            function publish_vac(text, href) {
                // Change modal texts to publish a job
                $('#pub-vac-modal-text').text(text);
                $('#pub-vac-form').attr("action", href)
                // $('#publish-vac-modal').modal('show')
            }

            function unpublish_vac(text, href) {
                // Change modal texts to publish a job
                $('#unpub-vac-modal-text').text(text);
                $('#btn-unpublish-vacancy').attr("href", href)
                // $('#publish-vac-modal').modal('show')
            }
        {% endif %}

        {% if vacancy.public_cvs and public_form.errors %}
            {% if recruiter or request.user.is_anonymous %}
                console.log("has errors");
                window.location.hash = "public-form";
            {% endif %}
        {% endif %}

        {% if vacancy.postulate and user_profile == 'candidate' %}
            // Nominate a candidate for the vacancy if application is allowed
            function postulate(vacancy_id, _this, xhr) {
                console.log(_this)
                // console.log(this);
                $this = $(_this);
                var btn_postularse = $this;
                btn_postularse.html("<i class='fa fa-spinner fa-pulse'></i> Please wait...");
                btn_postularse.attr('disabled', 'disabled');
                var reset_btn_postularse = true;
                var btn_fav = $("#btn_fav_" + vacancy_id);
                $.ajax({
                    data: {
                        'vacancy_id': vacancy_id,
                        {% if referer %}
                            'referer':{{referer.id}},
                        {% endif %}
                        {% if external_referer %}
                            'external_referer':{{external_referer.id}},
                        {% endif %}
                    },
                    url: '/ajax/vacancies-postulate/',
                    type: 'GET',
                    complete: function(){
                        
                    },
                    success: function(data){
                        console.log(data);
                        var message = '';
                        if (data == 'not-postulate'){
                            message = 'This post does not allow applications';
                        }
                        if (data == 'incomplete'){
                            message = 'Your profile is not complete. Before applying please complete your Profile';
                        }
                        if (data == 'not-exist'){
                            message = 'You can not apply before creating your Profile';
                        }
                        if (data == 'postulated'){
                            message = 'You have already applied for this position';
                            btn_postularse.html("<i class='fa fa-pointer fa-check-square-o'></i> Applied");
                        }
                        if (data == 'error'){
                            message = 'An error has occured, please try again';
                        }
                        if (data == 'success'){
                            message = 'Success! You have successfully applied to this job opening';
                            btn_postularse.html("<i class='fa fa-pointer fa-check-square-o'></i> Applied");
                            // btn_postularse.addClass('btn-info');
                            reset_btn_postularse = false;
                            btn_fav.remove();

                        }
                        else {
                            btn_postularse.html('Apply').removeAttr('disabled')
                        }

                        if (reset_btn_postularse == true){
                            btn_postularse.html("<i class='fa fa-pointer fa-check-square-o'></i> Apply");
                            btn_postularse.removeAttr("disabled");
                        }
                        alert(message);
                        // $('#postulate-modal-text').html(message);
                        // $('#post-vac-modal').modal('show');
                        // setTimeout(function() {$('#post-vac-modal').modal('hide');}, 5000);
                    },
                    error: function(data) {
                        console.log(data)
                        alert ('An error has occured, please try again');
                    }
                });
            }
        {% endif %}

        var spinner = "<h4 class='text-center'><i class='fa fa-spinner text-info fa-pulse'></i></h4>"

        window.sharecount = {
                'fb': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                    'group': {
                        'success': 0,
                        'error': 0,
                    },
                    'page': {
                        'success': 0,
                        'error': 0,
                    }
                },
                'li': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                    'company': {
                        'success': 0,
                        'error': 0,
                    },
                },
                'tw': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                },
            }

        var sharer = function(social_code){
            console.log('sharing')
            var code = social_code.split('-')[0]
            if (code == 'add_referal_link'){
                return true
            }
            link = false;
            if($('#add_referal_link')[0].checked){
                link = true;
            }
            console.log(code)
            return $.ajax({
                data:{
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'social_code': social_code,
                    'message': $('#smart-share-form [name=message]').val(),
                    'vid': '{{vacancy.id}}',
                    'add_referal_link': link
                },
                url: '/ajax/socialshare/',
                type: 'POST',
                complete: function(){
                    console.log('completed')
                },
                success: function(data){
                    if(data.success == true){
                        
                        if (data.msg == true){
                            window.sharecount[code.substr(0,2)][code.substr(2)]['success'] += 1
                        }
                        else {
                            window.sharecount[code.substr(0,2)][code.substr(2)]['error'] += 1
                        }
                    }
                    else if (data.msg){
                        alert(data.msg)
                    }
                    console.log(window.sharecount[code.substr(0,2)][code.substr(2)]['success'])
                },
                error: function(error){
                    window.sharecount[code.substr(0,2)][code.substr(2)]['error'] += 1
                    console.log(error)
                }
            })
        }
        var share_success = function(e){
            // Share the success
            console.log('success')
            sharecount = window.sharecount
            success_message_prefix = "Posted to: "
            success_message = ""
            error_message_prefix = "Posting failed for: "
            error_message = ""
            if (sharecount['fb']['personal']['success'] > 0){
                success_message = "Facebook Wall, "
            }
            if (sharecount['fb']['group']['success'] > 0){
                success_message += sharecount['fb']['group']['success'] + " Facebook Groups, "
            }
            if (sharecount['fb']['page']['success'] > 0){
                success_message += sharecount['fb']['page']['success'] + " Facebook Pages, "
            }
            if (sharecount['li']['personal']['success'] > 0){
                success_message += "Linkedin Stream, "
            }
            if (sharecount['li']['company']['success'] > 0){
                success_message += sharecount['li']['company']['success'] + " Linkedin Company Pages, "
            }
            if (sharecount['tw']['personal']['success'] > 0){
                success_message += "Twitter, "
            }
            if (sharecount['fb']['personal']['error'] > 0){
                error_message = "Facebook Wall, "
            }
            if (sharecount['fb']['group']['error'] > 0){
                error_message += sharecount['fb']['group']['error'] + " Facebook Groups, "
            }
            if (sharecount['fb']['page']['error'] > 0){
                error_message += sharecount['fb']['page']['error'] + " Facebook Pages, "
            }
            if (sharecount['li']['personal']['error'] > 0){
                error_message += "Linkedin Stream, "
            }
            if (sharecount['li']['company']['error'] > 0){
                error_message += sharecount['li']['company']['error'] + " Linkedin Company Pages, "
            }
            if (sharecount['tw']['personal']['error'] > 0){
                error_message += "Twitter, "
            }
            console.log(success_message)
            if (success_message){
                alert(success_message_prefix + success_message.trim(', '))
            }
            if (error_message){
                alert(error_message_prefix + error_message.trim(', '))
            }
        }
        var share_reject = function(e){
            alert('We could not connect to one or more services. Please try again after some time.');
        }

        var smart_share = function(e){
            window.sharecount = {
                'fb': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                    'group': {
                        'success': 0,
                        'error': 0,
                    },
                    'page': {
                        'success': 0,
                        'error': 0,
                    }
                },
                'li': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                    'company': {
                        'success': 0,
                        'error': 0,
                    },
                },
                'tw': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                },
            }

            e.preventDefault();
            e.stopPropagation();
            $form = $(this);
            $('.modal-backdrop').css('z-index','2000');
            initialtext = $form.find('button[type=submit]')[0].innerHTML;
            $form.find('button[type=submit]')[0].innerHTML = '<i class="fa fa-spinner fa-pulse"></i> Please Wait';
            promises = []
            $boxes = $form.find('[type=checkbox]:checked');
            $media=[]
            $boxes.each(function(index,box){
                $media.push(box.name);
            })
            if (!$boxes.length){
                alert('Please select atleast 1 media to post.')
            }
            Promise.all($media.map(sharer)
                ).then(
                    share_success,
                    share_reject
                ).then(function(){
                    $('.modal-backdrop').css('z-index','1040');
                    $form.find('button[type=submit]')[0].innerHTML = initialtext;
                });
        }
        var refresh_smart_share = function(e) {
            e.preventDefault();
            get_smart_share();
        }

        var get_smart_share = function(){
            $('#smart-share-content').html(spinner)
            $.ajax({
                url: '/ajax/smart-share/{{vacancy.id}}/',
                type: 'POST',
                complete: function(){
                    $('.refresh-smart-share').click(refresh_smart_share);  
                },
                success: function(data){
                    $('#smart-share-content').html(data);
                },
                error: function(data){
                    console.log(data);
                    $('#smart-share-content').html('<h5 class="text-light text-center">Failed to retrieve social integrations</h5><a class="btn btn-sm center-block refresh-smart-share"><i class="fa fa-refresh"></i> Try again</a>');
                }
            });            
        }

        {% if recruiter %}
            var update_smart_share_link = function(){
                normal_url = '{{vacancy.get_absolute_url|lower}}'
                referal_url = '{{vacancy.get_absolute_url|lower|appendURL:myreferal}}'
                if($('#add_referal_link')[0].checked){
                    console.log('checked');
                    $('#link_to_share').html(referal_url)
                }
                else{
                    console.log('unchecked');
                    $('#link_to_share').html(normal_url)
                }
            }
            $(document).ready(function(){
                get_smart_share();
                update_smart_share_link();
                $('.refresh-smart-share').click(refresh_smart_share);
                $('#smart-share-form').submit(smart_share);
            });
            $('#add_referal_link').change(update_smart_share_link)
        {% endif %}

        {% if vacancy.questions %}
            {# Functions for sending questions and answers #}
            {% if user_profile == 'candidate' %}
                function do_question(){
                    // Question validation
                    var question =  $("#id_question").val();
                    var send = false;
                    var label_error = "";
                    if (question == "") {
                        label_error = "You must enter a question.";
                    }
                    else {
                        if (question.length <= 19 || question.length > 200) {
                            label_error = "Enter a question between 20 and 200 characters."
                        }
                        else {send = true;}
                    }
                    if (send == false) {
                        $("#label_question").html(label_error).addClass('text-error');
                        $("#div_question").addClass('has-error');
                        $("#id_question").focus() ;
                        $("#submit_btn").html("<i class='fa fa-comments'></i> {% trans 'Send questions' %}").prop('disabled', false).removeClass('disabled').attr("clicked", "false");
                    }
                    else {
                        $("#submit_btn").html("<i class='fa fa-spinner fa-pulse'></i> Please wait...").prop('disabled', true);
                    }
                    return send;
                }
            {% endif %}

            {% if my_vacancy and vacancy.status.codename == 'active' %}
                // Functions only available to vacancy owners

                function show_form_answer(question_id){
                    // Shows the corresponding form to answer a question
                    $('#div_form_answer_'+question_id).toggle("slow");
                }

                function answer_question(id_question, answer) {
                    // Ajax function to register a response, validations of previous form
                    return $.ajax({
                        data: {
                            'id': id_question,
                            'answer': answer,
                            'csrfmiddlewaretoken': '{{ csrf_token }}'
                        },
                        url: '/ajax/vacancies-answer-question/',
                        type: 'POST',
                        success: function(data) {
                            console.log("Response sent successfully");
                            return 1;
                        },
                        error: function(xhr, status, error) {
                            console.log("Failed to send response");
                            console.log(xhr.responseText);
                            console.log(error);
                            return 2;
                        }
                    });
                }

                $(document).delegate('form', 'submit', function hello(event) {
                    // Request to question response form is sent
                    var $form = $(this);
                    var id_question = $( this ).find('input:hidden[name=id_question]').val();
                    var answer_button = $("#id_answer_button_"+id_question);
                    var answer_text_area = $("#id_text_answer_"+id_question);
                    var answer = answer_text_area.val();
                    var send = true;
                    var label_error = "";

                    answer_button.html("<i class='fa fa-spinner fa-pulse'></i> PLease wait...").prop('disabled', true);

                    if (answer.length <= 19 || answer.length > 200) {
                        label_error = "Enter an answer between 20 and 200 characters.";
                        send = false;
                    }
                    if (send == false) {
                        $("#id_label_answer_"+id_question).html(label_error).addClass('text-error');
                        $("#div_answer_"+id_question).addClass('has-error');
                        answer_button.html("<i class='fa fa-comments'></i> {% trans 'Answer' %}").prop('disabled', false).removeClass('disabled').attr("clicked", "false");
                        answer_text_area.focus();
                    }

                    if (send == true) {
                        console.log("Sending...");
                        $.when(answer_question(id_question, answer)).done(function(a1){
                            $(document).ajaxStop(function() { location.reload(true); });
                        });
                    }
                    return false;
                });

            {% endif %}{# Only available to owner of Companies #}
        {% endif %}{# if vacancy.questions #}

        {% if user_profile == 'candidate' %}
            function mark_unmark_favorite(vacancy_id) {
                {# Check or uncheck a vacancy as favourite #}
                var btn_fav = $("#btn_fav_" + vacancy_id);
                $.ajax({
                    data: {
                        'id': vacancy_id,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    url: '/ajax/mark-vacancy-asfavorite/',
                    type: 'GET',
                    success: function(data){
                        console.log(data);
                        var message = '';
                        if (data == 'marked'){
                            btn_fav.html('<i class="fa fa-heart text-danger"></i> Forget');
                            console.log('Marked as favourite');
                        }
                        if (data == 'unmarked'){
                            btn_fav.html('<i class="fa fa-heart"></i> Apply Later');
                            console.log('Favourite was removed');
                        }
                        if (data == 'error'){
                            alert("Failed to mark as favourite. Pleas try again in a moment.");
                        }
                    },
                    error: function(xhr, status, error) {
                        alert("Failed to mark as favourite, please try again in a moment");
                    }
                });
            }
        {% endif %}
        {%if not user.is_authenticated %}
            $('#loginform').submit(function(e){
                $this = $(this);
                e.preventDefault();
                var formdata = $this.serializeArray();
                console.log(formdata);
                var url = '{%url "ajax_login"%}';
                $this.find('.error-list').remove();
                $this.find('has-error').removeClass('has-error');
                $.ajax({
                    url:url,
                    type:'post',
                    data:formdata,
                    complete:function(data){
                        $this.find('.btn[type=submit]').html('<i class="fa fa-sign-in fa-lg mr5"></i> Login').prop('disabled',false).removeClass('disabled');

                    },
                    success:function(data){
                        console.log(data);
                        if(data.success == true)
                        {
                            // key = $this.data('key')
                            // if (key)
                            //     location.href = location.href+"?"+key +"=true"
                            location.href = '{% url "vacancies_new_application" vacancy.id %}' 
                        }
                        else {
                            $this.find('.form-control').parents('.input-group').addClass('has-error');
                            $this.prepend('<div class="alert alert-danger error-list">Invalid Username/Password</div>')
                        }
                    }
                })
                return false;
            });
            function changeloginredirect(key){
                $('#loginform').data('key',key)
            }
        {%endif%}
        {%if not user.is_authenticated or recruiter %}
            {%if public_form.errors %}
                $(document).ready(function(){
                    $('#public_apply').modal('show');
                });
            {% endif%}
            // $('#public_apply form').submit(function(e){
                //     $this = $(this);
                //     // console.log($this);
                //     e.preventDefault();
                //     var formdata = $this.serializeArray();
                //     // formdata.append('csrfmiddlewaretoken',$this.find('[name=csrfmiddlewaretoken]').val())
                //     // console.log(formdata);
                //     var url = '/ajax/publicapplication/';
                //     // console.log(url);
                //     $this.find('.error-list').remove();
                //     $this.find('has-error').removeClass('has-error');

                //     $.ajax({
                //         url:url,
                //         type:'post',
                //         datatype:'json',
                //         autoupload:true,
                //         minFileSize:10,
                //         data: formdata,
                //         iframe: true,
                //         files: $this.find('input[type=file]'),
                //         // processData:false,
                //         complete:function(data){
                //             $this.find('.btn[type=submit]').html('<i class="fa fa-check-circle fa-lg"></i> Login').prop('disabled',false).removeClass('disabled');

                //         },
                //         success:function(data){
                //             console.log(data);
                //             if(data.success == true)
                //             {
                //                 location.href = location.href
                //             }
                //             else {
                //                 // $this.find('.form-control').parents('.input-group').addClass('has-error');
                //                 // $this.prepend('<div class="alert alert-danger error-list">Invalid Username/Password</div>')
                //             }
                //         },
                //         error:function(data){
                //             console.log(data)
                //         }
                //     })
                //     return false;
                // });
                // function csrfSafeMethod(method) {
                //     // these HTTP methods do not require CSRF protection
                //     return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                //  }

                // function getFileSize(bytes) {
                //     if (typeof bytes !== 'number') return '';
                //     if (bytes >= 1024000000) return (bytes / 1024000000).toFixed(1) + ' GB';
                //     if (bytes >= 1024000) return (bytes / 1024000).toFixed(1) + ' MB';
                //     return (bytes / 1024).toFixed(1) + ' KB';
                // }

                //  var existing_files = 0;
                // function validateFiles(data, existing_files) {
                //     var maxFileSize = parseInt({{ public_form.max_megas }}) * 1024000;  // Maximum size allowed per file in Megas
                //     var maxFiles = 1; // Maximum no of files permitted
                //     var error_total_files = false;
                //     var error_size = false;
                //     var error_ext = false;

                //     if(data.files.length + existing_files > maxFiles){
                //         alert("You can only upload unto " + maxFiles + " files");
                //         error_total_files = true;
                //     }

                //     $.each(data.files, function (index, file) {
                //         if (file.size > maxFileSize) {
                //             alert('The file size of ' + file.name + ' is greater than ' + maxFileSize + 'MB');
                //             error_size = true;
                //         }
                //         var ext = file.name.split('.').pop().toLowerCase();
                //         if($.inArray(ext, ['png','jpg','jpeg','bmp','doc','docx','xls','xlsx','ppt','pptx','ppsx','pdf']) == -1) {
                //             alert('Only Word, Excel, PowerPoint, PDF and images are allowed.');
                //             error_ext = true;
                //         }
                //     });

                //     return !(error_size == true || error_ext == true || error_total_files == true);
                // }

                // $(function () {
                //     'use strict';
                //     var url = '/upload/file/';
                //     var csrftoken = $.cookie('csrftoken');
                //     var btn_submit = $('#btn-submit');
                //     var vacancy_id = {% if vacancy_id %}{{ vacancy_id }}{% else %}0{% endif %};

                //     $('#id_file').fileupload({
                //         url: url,
                //         dataType: 'json',
                //         // {#                crossDomain: false,#}
                //         autoUpload: false,
                //         minFileSize: 10,
                //         formData: {vacancy_id: vacancy_id},
                //         change : function (e, data) {
                //             return validateFiles(data, existing_files);
                //         },
                //         drop : function (e, data) {
                //             return validateFiles(data, existing_files);
                //         },
                //         beforeSend: function(xhr, settings) {
                //             if (!csrfSafeMethod(settings.type)) {
                //                 xhr.setRequestHeader("X-CSRFToken", csrftoken);
                //             }
                //             btn_submit.attr('disabled', 'disabled').addClass('disabled').html('<i class="glyphicon glyphicon-plus"></i> Subiendo archivos... Por favor espere');
                //         },
                //         done: function (e, data) {
                //             console.log(data);
                //             console.log(e);
                //             $.each(data.result.files, function (index, file) {
                //                 {# Add new files to the template #}

                //                 var ext = file.name.split('.').pop().toLowerCase();
                //                 var fa_icon = "";
                //                 if (ext == 'pdf')
                //                     fa_icon = '<i class="fa fa-file-pdf-o"></i>';
                //                 if (ext == 'doc' || ext == 'docx')
                //                     fa_icon = '<i class="fa fa-file-word-o"></i>';
                //                 if (ext == 'xls' || ext == 'xlsx')
                //                     fa_icon = '<i class="fa fa-file-excel-o"></i>';
                //                 if (ext == 'ppt' || ext == 'pptx')
                //                     fa_icon = '<i class="fa fa-file-powerpoint-o"></i>';
                //                 if (ext == 'jpg' || ext == 'jpeg' || ext == 'png')
                //                     fa_icon = '<i class="fa fa-picture-o"></i>';

                //                 var newFile = $('<p id=file_' + file.pk + '/>').html(
                //                     fa_icon +
                //                     '<a href="{{ MEDIA_URL }}' + file.name + '" target="_blank" class="ml5">' +
                //                         file.name +
                //                     '</a>' +
                //                     ' - <span class="size">' + getFileSize(file.size) + '</span>' +
                //                     ' - ' +
                //                     '<button class="btn btn-danger btn-xs" data-pk="' + file.pk + '">' +
                //                         '<i class="fa fa-times"></i>' +
                //                         '<span>Delete</span>' +
                //                     '</button>'

                //                 );

                //                 $('#div-files').append(newFile);
                //                 data.context = newFile;

                //                 existing_files = data.result.objFiles;
                //                 $('#id-existing-files').text(existing_files);
                //             });
                //         },
                //         progressall: function (e, data) {
                //             {#                     Submit button is enabled after the uploading progress completes #}
                //             var progress_bar = $('#progress .progress-bar');
                //             progress_bar.css('width', progress + '%');
                //             var progress = parseInt(data.loaded / data.total * 100, 10);
                //             $('#progress .progress-bar').css('width', progress + '%');
                //             if (progress == 100) {
                //                 btn_submit.removeAttr("disabled").removeClass('disabled').html('<i class="glyphicon glyphicon-eye"></i>Create Job');
                //             }
                //         },
                //         fail: function (e, data) {
                //             console.log(data.errorThrown);
                //             alert(data.errorThrown);
                //         }
                //     }).prop('disabled', !$.support.fileInput).parent().addClass($.support.fileInput ? undefined : 'disabled');
                // });
        {%endif%}
    </script>
    <script>
        function getParameterByName(name, url) {
            console.log(name)
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
        {%if recruiter and not vacancy.status.codename == 'closed' and vacancy.company|args:'AT_CUSTOM_HIRING_PROCESS'|call:'check_service' %}
            $creating = false;
            var listSelect = {
              sortField:'text',
              openOnFocus:true,
              allowEmptyOption: false,
              allowPrecedence:true,
              hideSelected: true,
              multiple:false,
              selected:null,
              options:[],
              create:function (input, callback){
                if ($creating){
                    console.log('Already creating')
                    return false;
                }
                else {

                    $creating=true;
                    console.log('Lets go');
                }

                $.ajax({
                    url:'/ajax/addstage/',
                    type:'post',
                    data:{
                        'stage_name': input
                    },
                    complete: function(data){
                        // console.log(data);
                        if (this.isLocked){
                            this.unlock();
                            console.log('unlocked')
                        }
                        console.log(this);
                        $creating = false;
                    },
                    success: function(data){
                        console.log(data);
                        console.log('success')
                        if (data.success){
                            console.log('true')
                            console.log(callback)
                            response = {value:data.id,text:input}
                            console.log(response)
                            callback(response);
                        }
                        else {
                            alert('Failed. Try Again!!');
                        }
                    },
                    error: function(data){
                        console.log(data);
                    }
                })

              },
              onItemAdd: function(value,$item){
                console.log('added value')
                // console.log(value)
                // console.log($item)
                $newitem = $('#bucket-list #bucket').append('<div class="row bucket-item" data-id='+value+'>'+$item.html()+'</div>');
                console.log($newitem)
                $newitem.find('.bucket-item:last-child').click(function(e){
                    onclickremove(this)
                })
                this.removeOption(value);
                this.focus();
                $( "#bucket" ).sortable({placeholder: "ui-state-highlight", cancel: ".bucket-item-static"});
              },
            }
            $('#list').selectize(listSelect);
            $('#list')[0].selectize.$control_input.attr('maxlength',50);
            $('#list')[0].selectize.clear();
            $('#list')[0].selectize.open();

            $(document).ready(function(){
                $("#bucket").sortable({placeholder: "ui-state-highlight",cancel: ".bucket-item-static"});
            });

            function onclickremove($this){
                // console.log($this)
                $list = $('#list')[0].selectize;
                // console.log($list)
                $list.addOption({value:$($this).data('id'),text:$($this).html()})
                $list.refreshOptions();
                $($this).remove();
            }
            $('#bucket .bucket-item').click(function(e){
                onclickremove(this)
            });

            popshare = "{{request.session|args:'enableshare'|call:'pop'|default:''}}"
            if(!popshare){
                popshare = getCookie('popshare')
            }
            console.log(popshare)
            $('#app_procees_update').click(function(){
                console.log('saving');
                
                $bucket = $('#bucket-list #bucket');
                formdata = "";
                $this = $(this);
                $(this).html('<i class="fa fa-spinner fa-pulse fa-lg fa-fw"></i> Please Wait');
                $(this).addClass('disabled');
                $(this).prop('disabled',true);
                $bucket.find('.bucket-item').each(function(key,value){
                    formdata+=($(value).data('id')) + ",";
                });
                formdata = formdata.substring(0,formdata.length - 1);
                if (formdata.trim(',') == $('#bucket').data('list')){
                    alert('No changes made');
                    $this.html('<i class="fa fa-check-circle"></i> Save and Update');
                    $this.removeClass('disabled');
                    $this.prop('disabled',false);
                    $($this).parents('.modal').modal('hide');
                    return false;
                }
                else if(popshare){
                    setCookie('popshare','true',1)
                    popshare=false

                }
                $.ajax({
                    url:'/ajax/updatevacancystage/',
                    data: {
                        stage_ids: formdata.trim(','),
                        vacancy: '{{vacancy.id}}',
                    },
                    type:'post',
                    complete: function(data){
                        $this.html('<i class="fa fa-check-circle"></i> Save and Update');
                        $this.removeClass('disabled');
                        $this.prop('disabled',false);
                        
                    },
                    success: function(data){
                        console.log(data)
                        if(data.success){
                            $timeline = $('.timeline');
                            $timeline.html('');
                            for (timeline_item in data.timeline){
                                console.log(data.timeline[timeline_item]);
                                html ='<li><div class="direction-r"><div class="flag-wrapper"><span class="flag">'
                                        +'<a href="'+ data.timeline[timeline_item].href+'">'
                                        +data.timeline[timeline_item].label+'</a></span><span class="time-wrapper"><span class="time">'+data.timeline[timeline_item].count+'</span></span></div></div></li>'
                                $timeline.append(html);
                                // console.log(data.timeline[timeline_item].label);
                            }
                            // console.log(this)
                            $($this).parents('.modal').modal('hide');
                            location.href=location.href.split('?')[0]
                        }
                        else{
                            if (data.msg){
                                alert(data.msg);
                            }
                            else {
                                alert('Could Not Save. Please Try again')
                            }
                        }
                    },
                    error: function(error){
                        console.log(error);
                    },
                });
            })
            $(document).ready(function(){
                console.log('ready')
                if(getParameterByName('manage')){
                    $('#timeline_management').modal('show');
                    if (popshare){
                        $('#timeline_management').on('hidden.bs.modal', function(){
                            if (popshare){
                                popshare = false
                                $('#share-to-social-modal').modal();
                                $('#timeline_management').off('hidden.bs.modal');
                            }
                        })
                    }
                }
                else {
                    if (popshare){
                        popshare = false
                        $('#share-to-social-modal').modal();
                        setCookie('popshare','',0)
                    }
                }
            });
        {%endif%}
        {% if user_profile == 'candidate' or request.user.is_anonymous %}
            console.log('yay')
            $('document').ready(function(){
                if(getParameterByName('apply')){
                    console.log('apply')
                    $('#trm_apply_button').click();
                }
                if(getParameterByName('public_apply')){
                    console.log('public_apply')
                    $('#public_apply').modal('show');
                }
                if(getParameterByName('mark_for_later')){
                    console.log('mark_for_later')
                    $('#btn_fav_{{vacancy.pk}}').click();
                }
            });
        $('.withdraw').click(function(){
            $this = $(this);
            id='{{postulate.id}}';
            $this.html('<i class="fa fa-pulse fa-spinner"></i> Please Wait').prop('disabled', true).addClass('disabled');
            $.ajax ({
                data:{
                    'id':id,
                },
                type: 'POST',
                url: '/ajax/withdraw/',
                complete: function(){
                    $this.html('Withdraw Application').removeClass('disabled').prop('disabled',false);
                },
                success: function(data){
                    console.log(data);
                    if(data.success == true){
                        location.href=location.href;
                    }
                },
                error: function(er){
                    console.log(er);
                }
            });
        });
        {% endif %}
    </script>
    <script>
        $(document).ready(function(){
            // $('#share-to-social-modal').modal();
            // $('#post-to-selector').selectize();
        })
        {% if socialApplication %}
            $(document).ready(function(){
                $('#social-application-modal').modal();
            });
            $('#social-application-modal').on('hidden.bs.modal',function(){
                $('#social-application-modal').remove();
            })
        {% endif %}
        $('#candidate_preview').on('shown.bs.modal',function(){
            $(this).unbind('scroll');
            $(this).scroll(function(){
                topcontainer = $(this).find('.affix-head');
                if ($(this).scrollTop() > $(topcontainer)[0].scrollHeight+20){
                    $(topcontainer).css('visibility','hidden')
                    $('#candidate_preview_top').removeClass('hidden');
                }else{
                   $(topcontainer).css('visibility','visible') 
                   $('#candidate_preview_top').addClass('hidden');
                }
            })
        });
        $('#candidate_edit').on('shown.bs.modal',function(){
            // $(this).unbind('scroll');
            // $(this).scroll(function(){
                // topcontainer = $(this).find('.affix-head');
                // if ($(this).scrollTop() > $(topcontainer)[0].scrollHeight+20){
                    // $(topcontainer).css('visibility','hidden')
                $('#candidate_edit_top').removeClass('hidden');
                // }else{
                   // $(topcontainer).css('visibility','visible') 
                   // $('#candidate_preview_top').addClass('hidden');
                // }
            // })
        });
        $('#candidate_preview').on('hide.bs.modal',function(){
            $('#candidate_preview_top').addClass('hidden');
            $(this).find('.affix-head').css('visibility','visible');
        });
        $('#candidate_edit').on('hide.bs.modal',function(){
            $('#candidate_edit_top').addClass('hidden');
            $(this).find('.affix-head').css('visibility','visible');
        });
        var manage_toggler=function(){
            $('#candidate_preview').modal('hide')
            $('#candidate_preview').on('hidden.bs.modal', function(){
                $('#candidate_edit').modal({
                    backdrop:'static',
                    keyboard: false
                });
            })
        }
        var manage_edit_toggler=function(){
            $('#candidate_edit').modal('hide')
        }
        var dpicker = {
                format: "yyyy-mm-dd",
                startView: 1,
                minViewMode: 3,
                language: "en",
                autoclose: true
        };
        var academic_status_change = function(){
            $this = $(this);
            $form = $this.parents('form');
            if($this.val() == 5) {
                $form.find('#id_end_date').parents('.form-group').hide();
            }
            else {
                $form.find('#id_end_date').parents('.form-group').show();
            }
        }
        var experience_ongoing = function(){
            $this = $(this);
            $form = $this.parents('form');
            if($this[0].checked){
                $form.find('#id_end_date').parents('.form-group').hide();
            }
            else {
                $form.find('#id_end_date').parents('.form-group').show();
            }
        }
        $(document).ready(function () {
           {% if fileForm.file.errors %}
                $('#post-cv-modal').modal();
           {% endif %}
           {% if form_user_photo.errors %}
                $('#updateimage-modal').modal();
            {% endif %}
           {% if candidate %}
               $('#id_skills').selectize({create:true,createOnBlur:true});
               // $('#id_interests').selectize({create:true,createOnBlur:true});
               // $('#id_extra_curricularss').selectize({create:true,createOnBlur:true});
               // $('#id_hobbies').selectize({create:true,createOnBlur:true});
               // $('#id_others').selectize({create:true,createOnBlur:true});
                
                $('.remove-card').click(function(){
                    removeCard(this);
                })
                $('#id_photo').change(function(){
                    console.log('image changed');
                     if(this.files && this.files[0]) {
                        // var file = e.originalEvent.srcElement.files[i];
                        var img = $('#updateimage-modal img.user-photo');
                        if (this.files[0].size > 1*1024*1024){
                            alert('File exceeds 1MB file size')
                            this.value="";
                        }
                        else {
                            // console.log(img);
                            var reader = new FileReader();
                            reader.onload = function(e) {
                                // console.log(img.attr('src'))
                                 img.attr('src',e.target.result);
                                 // console.log(reader.result)
                                 // console.log(img.attr('src'))
                            }
                            reader.readAsDataURL(this.files[0]);
                        }
                        // $("input").after(img);
                    }
                });
            {%endif%}
            $('#academic-section [id=id_status]').change(academic_status_change);
            $('#experience-section [id=id_present]').change(experience_ongoing);
            $('#id_birthday').datepicker({
                    format: "yyyy-mm-dd",
                    startView: 2,
                    minViewMode: 3,
                    language: "en",
                    autoclose: true,
                    startDate: '-60y',
                    endDate: '-18y'
            });
            
            $('[id=id_end_date]').datepicker(dpicker);
            $('[id=id_start_date]').datepicker(dpicker);
        });
        function toreadabledate(d){
            var monthNames = ["Jan.", "Feb.", "Mar.", "Apr.", "May", "Jun.", "Jul.", "Aug.", "Sep.", "Oct.", "Nov.", "Dec."];
            date = new Date(d);
            month = monthNames[date.getMonth()]

            return month + ' ' + date.getDate() + ', ' + date.getYear();
        }
        function discardform(_this,add){
            $section = $(_this).parents('section');
            if($section){
                $section = $(_this).attr('href');
            }
            $(_this).parents('form').parent().remove();
            $(add).show();
            checkforsurvivors($section);
        }
        /* Validating Form */
            //Personal

                $('form#candidate-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);

                    // Clear Error Highlights before submission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).addClass('disabled');

                    //Send Ajax Request
                    $.ajax({
                        url : "/ajax/validate_personal_form/",
                        type: 'post',
                        data: formdata,
                        complete: function(data){
                            //Revert buttons back to original
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if (data.success == true){
                                //Hide form and show details
                                $('.personal-profile').collapse('toggle');
                                //Update each field
                                $('#profile_name').html($('#id_first_name').val() + ' ' + $('#id_last_name').val());
                                if($('#id_birthday').val()){
                                    $('#profile_birthday').html(toreadabledate($('#id_birthday').val()));
                                    $('#profile_birthday').parent().removeClass('hidden');
                                }
                                else {
                                    $('#profile_birthday').html('Not Provided');
                                    $('#profile_birthday').parent().addClass('hidden');                                    
                                }
                                if($('#id_gender').val()){
                                    $('#profile_gender').html($('#id_gender option:selected').text());
                                        $('#profile_gender').parent().removeClass('hidden');
                                }
                                else {
                                    $('#profile_gender').html('Not Provided');
                                    $('#profile_gender').parent().addClass('hidden');
                                }
                                if($('#id_maritalStatus').val()){
                                    $('#profile_marital_status').html($('#id_maritalStatus option:selected').text());
                                    $('#profile_marital_status').parent().removeClass('hidden');
                                }
                                else {
                                    $('#profile_marital_status').html('Not Provided');
                                    $('#profile_marital_status').parent().addClass('hidden');
                                }
                                // $('#profile_image')
                                window.location.hash = '#profile';
                                alert(data.msg);
                            }
                            else if (data.errors){ 
                                //Handle Errors
                                // Show errors for all fields available
                                if ('first_name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_first_name]');
                                    console.log(data.errors.first_name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_first_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.first_name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('last_name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_last_name]');
                                    console.log(data.errors.last_name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_last_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.last_name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('gender' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_gender]');
                                    console.log(data.errors.gender)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_gender').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.gender).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('birthday' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_birthday]');
                                    console.log(data.errors.birthday)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_birthday').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.birthday).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('maritalStatus' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_maritalStatus]');
                                    console.log(data.errors.maritalStatus)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_maritalStatus').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.maritalStatus).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('min_salary' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_min_salary]');
                                    console.log(data.errors.min_salary)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_min_salary').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.min_salary).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('max_salary' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_max_salary]');
                                    console.log(data.errors.max_salary)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_max_salary').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.max_salary).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('travel' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_travel]');
                                    console.log(data.errors.travel)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_travel').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.travel).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('residence' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_residence]');
                                    console.log(data.errors.residence)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_residence').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.residence).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },  
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                });

            //Contact

                $('form#contact-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);

                    // Clear Error Highlights before submission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).addClass('disabled');

                    //Send Ajax Request
                    $.ajax({
                        url : "/ajax/validate_contact_form/",
                        type: 'post',
                        data: formdata,
                        complete: function(data){
                            //Revert buttons back to original
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if (data.success == true){
                                //Hide form and show details
                                $('.contact').collapse('toggle');
                                //Update each field
                                if($('#id_city').val() || $('#id_state').val() || $('#id_nationality').val()){
                                    $('#profile_address').html($('#id_city').val() + ', ' + $('#id_state').val()  + ', ' + $('#id_nationality option:selected').text());
                                    $('#profile_address').parent().removeClass('hidden');                                   
                                }
                                else {
                                    $('#profile_address').parent().addClass('hidden');                                  
                                }
                                if($('#id_phone').val()){                        
                                    $('#profile_phone').html(' ' + $('#id_phone').val().replace('-','').splice(3,0,'-').splice(7,0,'-'));
                                    $('#profile_phone').parent().removeClass('hidden');
                                }
                                else {
                                    $('#profile_phone').parent().addClass('hidden');
                                }
                                if($('#id_cellphone').val()){
                                    $('#profile_cellphone').html(' ' +$('#id_cellphone').val().replace('-','').splice(3,0,'-').splice(7,0,'-'));
                                    $('#profile_cellphone').parent().removeClass('hidden');               
                                }
                                else {
                                    $('#profile_cellphone').parent().addClass('hidden');
                                }
                                if($('#id_twitter').val()){
                                    $('#profile_twitter').attr('href','http://twitter.com/'+$('#id_twitter').val().replace('@',''));
                                    $('#profile_twitter').removeClass('hidden');
                                    $('#profile_twitter').parents('.social-icons').removeClass('hidden');
                                }
                                else {
                                    $('#profile_twitter').addClass('hidden');
                                }
                                if($('#id_facebook').val()){
                                    $('#profile_facebook').attr('href',$('#id_facebook').val());
                                    $('#profile_facebook').removeClass('hidden');
                                    $('#profile_facebook').parents('.social-icons').removeClass('hidden');
                                }
                                else {
                                    $('#profile_facebook').addClass('hidden');
                                }
                                if($('#id_linkedin').val()){
                                    $('#profile_linkedin').attr('href',$('#id_linkedin').val());
                                    $('#profile_linkedin').removeClass('hidden');
                                    $('#profile_linkedin').parents('.social-icons').removeClass('hidden');
                                }
                                else {
                                    $('#profile_linkedin').addClass('hidden');
                                }
                                if($('#id_google').val()){
                                    $('#profile_google').attr('href',$('#id_google').val());
                                    $('#profile_google').removeClass('hidden');
                                    $('#profile_google').parents('.social-icons').removeClass('hidden');
                                }
                                else {
                                    $('#profile_google').addClass('hidden');
                                }
                                // $('#profile_image')
                                window.location.hash = '#contact-section';
                                alert(data.msg);
                            }
                            else if (data.errors){ 
                                //Handle Errors
                                // Show errors for all fields available
                                if ('nationality' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_nationality]');
                                    console.log(data.errors.nationality)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_nationality').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.nationality).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('state' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_state]');
                                    console.log(data.errors.state)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_state').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.state).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('city' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_city]');
                                    console.log(data.errors.city)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_city').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.city).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('phone' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_phone]');
                                    console.log(data.errors.phone)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_phone').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.phone).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('cellphone' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_cellphone]');
                                    console.log(data.errors.cellphone)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_cellphone').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.cellphone).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('linkedin' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_linkedin]');
                                    console.log(data.errors.linkedin)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_linkedin').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.linkedin).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('facebook' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_facebook]');
                                    console.log(data.errors.facebook)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_facebook').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.facebook).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('twitter' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_twitter]');
                                    console.log(data.errors.twitter)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_twitter').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.twitter).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('google' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_google]');
                                    console.log(data.errors.google)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_google').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.google).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },  
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                });
            
            //Objective

                $('form#objective-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this)

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');

                    // Send Ajax request
                    $.ajax({
                        url: '/ajax/validate_objective_form/',
                        type:'post',
                        data:formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel')
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled'); 
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.objective-skills').collapse('toggle');
                                // Update each field
                                $('#profile_objective').html($('#id_objective').val());
                                skills = $('#id_skills').val().split(',');
                                $('#profile_skills').html('');
                                $(skills).each(function(k,el){
                                    html  = '<div class="col-md-4 mb10"><i class="material-icons">label</i> <span class="va-top">'+el+'</span></div>';
                                    $('#profile_skills').append(html);
                                });
                                window.location.hash = '#objective-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('objective' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_objective]');
                                    console.log(data.errors.objective)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_objective').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.objective).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('skills' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_skills]');
                                    console.log(data.errors.skills)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_skills').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.skills).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                });

            //Interests
                $('form#interests-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);
                    //Clear Error Highlights before Submisison
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    formdata[1].value = CKEDITOR.instances['id_interests'].getData();
                    // console.log(formdata)
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).removeClass('disabled');
                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_interests_form/',
                        type: 'post',
                        data: formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false).removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.interests').collapse('toggle');
                                // Update each field
                                $('#profile_interests').html($('#id_interests').val());
                                window.location.hash = '#interests-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('interests' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_interests]');
                                    console.log(data.errors.interests)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_interests').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.interests).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }

                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false; 
                });

            //Hobbies
                $('form#hobbies-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);
                    //Clear Error Highlights before Submisison
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    formdata[1].value = CKEDITOR.instances['id_hobbies'].getData();
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).removeClass('disabled');
                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_hobbies_form/',
                        type: 'post',
                        data: formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false).removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.hobbies').collapse('toggle');
                                // Update each field
                                $('#profile_hobbies').html($('#id_hobbies').val());
                                window.location.hash = '#hobbies-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('hobbies' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_hobbies]');
                                    console.log(data.errors.hobbies)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_hobbies').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.hobbies).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }

                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false; 
                });

            //Extra_curriculars
                $('form#extra_curriculars-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);
                    //Clear Error Highlights before Submisison
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    formdata[1].value = CKEDITOR.instances['id_extra_curriculars'].getData();
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).removeClass('disabled');
                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_extra_curriculars_form/',
                        type: 'post',
                        data: formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false).removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.extra_curriculars').collapse('toggle');
                                // Update each field
                                $('#profile_extra_curriculars').html($('#id_extra_curriculars').val());
                                window.location.hash = '#extra-curriculars-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('extra_curriculars' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_extra_curriculars]');
                                    console.log(data.errors.extra_curriculars)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_extra_curriculars').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.extra_curriculars).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }

                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false; 
                });

            //Others
                $('form#others-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);
                    //Clear Error Highlights before Submisison
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    formdata[1].value = CKEDITOR.instances['id_others'].getData();
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).removeClass('disabled');
                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_others_form/',
                        type: 'post',
                        data: formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false).removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.others').collapse('toggle');
                                // Update each field
                                $('#profile_others').html($('#id_others').val());
                                window.location.hash = '#others-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('others' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_others]');
                                    console.log(data.errors.others)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_others').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.others).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }

                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false; 
                });

            //Experience
                function update_experience(_this,e){
                    $this = $(_this);
                    // alert('submitting');
                    e.preventDefault();

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    id = $this.data('id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id','value':id})

                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_experience_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                                $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                                $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                                $this.find('.btn').prop('disabled',false);
                                $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.experience-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    // $this = $(q + '.form-row');
                                    $row.find('.experience_company').html($this.find('#id_company').val());
                                    // $row.find('.experience_industry').html($this.find('#id_industry option:selected').text());
                                    $row.find('.experience_employment').html($this.find('#id_employment').val());
                                    var duration="--";
                                    $row.find('.experience_duration').html(duration);
                                    $row.find('.experience_tasks').html($this.find('#id_tasks').val());
                                    city = $this.find('#id_city').val()
                                    state = $this.find('#id_state').val()
                                    address=""
                                    if(city){
                                        address = city + ', ';
                                    }
                                    if(state){
                                        address += state + ', ';
                                    }
                                    $row.find('.experience_location').html(address + $this.find('#id_country option:selected').text())
                                    startdate = toreadabledate($this.find('#id_start_date').val());
                                    endddate = toreadabledate($this.find('#id_end_date').val());
                                    if ($this.find('#id_present').val() == "on") {
                                        enddate = "Current Job";
                                    }
                                    $row.find('.experience_date').html(startdate + ' - ' + enddate);
                                }
                                else {
                                    // q='.experience-form-0:not(';
                                    // $(q).collapse('toggle');
                                    // $this = $(q);
                                    city = $this.find('#id_city').val()
                                    state = $this.find('#id_state').val()
                                    address=""
                                    if(city){
                                        address = city + ', ';
                                    }
                                    if(state){
                                        address += state + ', ';
                                    }
                                    address += $this.find('#id_country option:selected').text();
                                    startdate = toreadabledate($this.find('#id_start_date').val());
                                    enddate = toreadabledate($this.find('#id_end_date').val());
                                    if ($this.find('#id_status').val() == 5) {
                                        enddate = "ongoing";
                                    }
                                    var removefunction = "remove_experience('"+$this.find('#id_course_name').val()+"', '"+data.del_url+"')";
                                    removefunction = '<a href type="button" data-toggle="modal" data-target="#del-experience-modal" onclick="'+removefunction+'">'+ ' Remove';
                                    console.log(removefunction)
                                    html = '<div class="row experience-form-'+data.id+' collapse fade in">'+
                                                '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                    '<h4 class="pl15 pr15">'+
                                                        '<i class="fa fa-briefcase"></i> <span class="experience_employment">'+$this.find('#id_employment').val()+'</span>'+
                                                        ' | <small>'+
                                                            '<a data-toggle="collapse" data-target=".experience-form-'+data.id+'" class="clickable">Update</a>'+
                                                            ' - '+
                                                            '<a class="clickable remove-card" data-card=".experience-form-'+data.id+'" data-card-type="experience"> Remove</a>'+
                                                        '</small>'+
                                                        '<small class="pull-right hidden"><i class="fa fa-clock-o"></i> <span class="experience_duration">'+$this.find('#id_start_date').val()+'</span></small>'+
                                                    '</h4>'+
                                                    '<div class="container-fluid">'+
                                                        '<div class="row">'+
                                                            '<div class="col-md-6">'+
                                                                '<h4 class=""><i class="fa fa-building"></i> <span class="#experience_company">'+$this.find('#id_company').val()+'</span></h4>'+
                                                                '<span><i class="fa fa-map-marker"></i> <span class="experience_location">'+address+'</span></span>'+
                                                            '</div>'+
                                                            '<div class="col-md-6 text-right pt10">'+
                                                                '<small class=""><i class="fa fa-calendar"></i> <span class="experience_date">'+startdate + ' - ' + enddate+'</span></small>'+
                                                            '</div>'+
                                                        '</div>'+
                                                        '<p class="mt10"><span class="experience_tasks">'+$this.find('#id_tasks').val()+'</span></p>'
                                                    '</div>'+
                                                '</div>'+
                                            '</div>';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','experience-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('experience-form-0 in');
                                    $this.parent().addClass('experience-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-toggle','.experience-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_experience_form').show();
                                }
                                window.location.hash = '#experience-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('company' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_company]');
                                    console.log(data.errors.company)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_company').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.company).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('industry' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_industry]');
                                    console.log(data.errors.industry)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_industry').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.industry).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('country' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_country]');
                                    console.log(data.errors.country)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_country').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.country).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('employment' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_employment]');
                                    console.log(data.errors.employment)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_employment').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.employment).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('tasks' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_tasks]');
                                    console.log(data.errors.tasks)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_tasks').parent().addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.tasks).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('end_date' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_end_date]');
                                    console.log(data.errors.end_date)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_end_date').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.end_date).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('city' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_city]');
                                    console.log(data.errors.city)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_city').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.city).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('state' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_state]');
                                    console.log(data.errors.state)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_state').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.state).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('start_date' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_start_date]');
                                    console.log(data.errors.start_date)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_start_date').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.start_date).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            } 
                            else if (data.msg) {
                                alert(data.msg)
                            }  
                        },
                        error: function(e){
                            console.log(e);
                        }
                    })
                }
                $('form[id^=experience-form]').submit(function(e){update_experience(this,e);});
                $('.add_experience_form').click(function(){
                    $(this).hide();
                    experience_form = $('#experience_form').clone();
                    experience_form.attr('id','');
                    experience_form.addClass('in form-row');
                    experience_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    })
                    experience_form.find('#id_start_date').datepicker(dpicker);
                    experience_form.find('#id_end_date').datepicker(dpicker);
                    experience_form.find('#id_present').change(experience_ongoing);
                    experience_form.insertAfter($('#experience_form'));
                    $('.form-row #experience-form-0').submit(function(e){update_experience(this,e)});
                });
            
            //Academic
                function update_academic(_this,e){
                    $this = $(_this);
                    e.preventDefault();
                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    // Pars data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    var id = $this.attr('data-id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id', 'value':id})
                    //Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_academic_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.academic-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    // $this = $(q + '.form-row');
                                    $row.find('.academic_coursename').html($this.find('#id_course_name').val()+', '+$this.find('#id_area').val());
                                    $row.find('.academic_degree').html($this.find('#id_degree option:selected').text());
                                    $row.find('.academic_status').html($this.find('#id_status option:selected').text());
                                    $row.find('.academic_school').html($this.find('#id_school').val());
                                    city = $this.find('#id_city').val()
                                    state = $this.find('#id_state').val()
                                    address=""
                                    if(city){
                                        address = city + ', ';
                                    }
                                    if(state){
                                        address += state + ', ';
                                    }
                                    $row.find('.academic_location').html(address + $this.find('#id_country option:selected').text())
                                    startdate = toreadabledate($this.find('#id_start_date').val());
                                    if ($this.find('#id_status').val() == 5) {
                                        enddate = "ongoing";
                                    }
                                    else {
                                        endddate = toreadabledate($this.find('#id_end_date').val());
                                    }
                                    $row.find('.academic_date').html(startdate + ' - ' + enddate);
                                }
                                else {
                                    // q='.academic-form-0:not(';
                                    // $(q).collapse('toggle');
                                    // $this = $(q);
                                    city = $this.find('#id_city').val()
                                    state = $this.find('#id_state').val()
                                    address=""
                                    if(city){
                                        address = city + ', ';
                                    }
                                    if(state){
                                        address += state + ', ';
                                    }
                                    startdate = toreadabledate($this.find('#id_start_date').val());
                                    enddate = toreadabledate($this.find('#id_end_date').val());
                                    if ($this.find('#id_status').val() == 5) {
                                        enddate = "ongoing";
                                    }
                                    html = '<div class="row academic-form-'+data.id+' collapse fade in">'+
                                                '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                    '<h4 class="pl15 pr15">'+
                                                        '<i class="fa fa-certificate"></i> <span class="academic_coursename">'+$this.find('#id_course_name').val()+', '+$this.find('#id_area').val()+'</span>'+
                                                        ' | <small>'+
                                                            '<a data-toggle="collapse" data-target=".academic-form-'+data.id+'" class="clickable">Update</a>'+
                                                            ' - '+
                                                            '<a class="clickable remove-card" data-card=".academic-form-'+data.id+'" data-card-type="academic"> Remove</a>'+
                                                        '</small>'+
                                                        '<small class="pull-right"><i class="fa fa-flag-checkered"></i> <span class="academic_status">'+$this.find('#id_status option:selected').text()+'</span></small>'+
                                                    '</h4>'+
                                                    '<h5 class="pl15 pr15 no-margin-bottom"><i class="fa fa-mortar-board"></i> <span class="academic_degree">'+$this.find('#id_degree option:selected').text()+'</span></h5>'+
                                                    '<div class="container-fluid">'+
                                                        '<div class="row">'+
                                                            '<div class="col-md-6">'+
                                                                '<h5 class=""><i class="fa fa-university"></i> <span class="academic_school">'+$this.find('#id_school').val()+'</span></h5>'+
                                                                '<span><i class="fa fa-map-marker"></i> <span class="academic_location">'+address + $this.find('#id_country option:selected').text()+'</span></span>'+
                                                            '</div>'+
                                                            '<div class="col-md-6 text-right pt10">'+
                                                                '<small class=""><i class="fa fa-calendar"></i> <span class="academic_date">'+startdate + ' - ' + enddate+'</span></small>'+
                                                            '</div>'+
                                                        '</div>'+
                                                    '</div>'+
                                                '</div>'+
                                            '</div>';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','training-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('academic-form-0 in');
                                    $this.parent().addClass('academic-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.academic-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_academic_form').show();
                                }
                                window.location.hash = '#academic-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('area' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_area]');
                                    console.log(data.errors.area)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_area').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.area).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('course_name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_course_name]');
                                    console.log(data.errors.course_name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_course_name').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.course_name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('degree' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_degree]');
                                    console.log(data.errors.degree)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_degree').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.degree).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('city' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_city]');
                                    console.log(data.errors.city)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_city').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.city).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('country' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_country]');
                                    console.log(data.errors.country)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_country').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.country).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('end_date' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_end_date]');
                                    console.log(data.errors.end_date)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_end_date').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.end_date).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('school' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_school]');
                                    console.log(data.errors.school)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_school').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.school).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('state' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_state]');
                                    console.log(data.errors.state)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_state').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.state).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('start_date' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_start_date]');
                                    console.log(data.errors.start_date)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_start_date').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.start_date).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('status' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_status]');
                                    console.log(data.errors.status)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_status').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.status).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            } 
                            else if (data.msg) {
                                alert(data.msg)
                            }  
                        },
                        error: function(e){
                            console.log(e);
                        }
                    })
                }
                $('[id^=academic-form]').submit(function(e){update_academic(this,e)});
                $('.add_academic_form').click(function(){
                    $(this).hide();
                    academic_form = $('#academic_form').clone();
                    academic_form.attr('id','');
                    academic_form.addClass('in form-row');
                    academic_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct'))
                        {
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    })
                    academic_form.find('#id_start_date').datepicker(dpicker);
                    academic_form.find('#id_end_date').datepicker(dpicker);
                    academic_form.find('#id_status').change(academic_status_change);
                    academic_form.insertAfter($('#academic_form'));
                    $('.form-row #academic-form-0').submit(function(e){update_academic(this,e)});
                });

            //Training
                function update_training(_this,e){
                    $this = $(_this);
                        // alert('submitting');
                        e.preventDefault();
                        // Clear Error Highlights before SUbmission
                        $this.find('.error-list').remove();
                        $this.find('.has-error').removeClass('has-error');
                        // Parse data for submission
                        var formdata = $this.serializeArray();
                        formdata.push({'name':'isPublic','value':false})
                        // Disable buttons
                        $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                        $this.find('.btn').prop('disabled',true);
                        $this.find('.btn').removeClass('disabled');
                        id = $this.data('id');
                        if(!id){
                            id=0;
                        }
                        formdata.push({'name':'id','value':id})
                        // Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_training_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.training-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    $row.find('.training_name').html($this.find('#id_name').val());
                                    $row.find('.training_description').html($this.find('#id_description').val());
                                }
                                else {
                                    name = $this.find('#id_name').val()
                                    description = $this.find('#id_description').val()
                                    html =  '<div class="row training-form-'+data.id+' collapse fade in">'+
                                            '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                '<h4 class="pl15 pr15">'+
                                                    '<i class="fa fa-certificate"></i> <span class="training_name">'+name+'</span>'+
                                                    ' | <small>'+
                                                        '<a data-toggle="collapse" data-target=".training-form-'+data.id+'" class="clickable">Update</a>'+
                                                        ' - '+
                                                        '<a class="clickable remove-card" data-card=".training-form-'+data.id+'" data-card-type="training"> Remove</a>'+
                                                    '</small>'+
                                                '</h4>'+
                                                '<div class="container-fluid">'+
                                                    '<div class="row">'+
                                                        '<div class="col-md-12">'+
                                                            '<p class="training_description">'+description+'</p>'+
                                                        '</div>'+
                                                    '</div>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div> ';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','training-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('training-form-0 in');
                                    $this.parent().addClass('training-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.training-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_training_form').show();
                                }
                                window.location.hash = '#training-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_name]');
                                    console.log(data.errors.name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('description' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_description]');
                                    console.log(data.errors.description)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_description').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.description).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }   
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                }
                $('form[id^=training-form]').submit(function(e){update_training(this,e)});
                $('.add_training_form').click(function(){
                    $(this).hide();
                    training_form = $('#training_form').clone();
                    training_form.attr('id','');
                    training_form.addClass('in form-row');
                    training_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    });
                    training_form.insertAfter($('#training_form'));
                    $('.form-row #training-form-0').submit(function(e){update_training(this,e)});
                });

            //Certificate

                function update_certificate(_this,e){
                    $this = $(_this);
                    // alert('submitting');
                    e.preventDefault();

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    id = $this.data('id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id','value':id})

                    // Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_certificate_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.certificate-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    $row.find('.certificate_name').html($this.find('#id_name').val());
                                    $row.find('.certificate_description').html($this.find('#id_description').val());
                                }
                                else {
                                    // q='.certificate-form-0:not(';
                                    // $(q).collapse('toggle');
                                    // $this = $(q);
                                    name = $this.find('#id_name').val()
                                    description = $this.find('#id_description').val()
                                    html =  '<div class="row certificate-form-'+data.id+' collapse fade in">'+
                                            '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                '<h4 class="pl15 pr15">'+
                                                    '<i class="fa fa-certificate"></i> <span class="certificate_name">'+name+'</span>'+
                                                    ' | <small>'+
                                                        '<a data-toggle="collapse" data-target=".certificate-form-'+data.id+'" class="clickable">Update</a>'+
                                                        ' - '+
                                                        '<a class="clickable remove-card" data-card=".certificate-form-'+data.id+'" data-card-type="certificate"> Remove</a>'+
                                                        '</a>'+
                                                    '</small>'+
                                                '</h4>'+
                                                '<div class="container-fluid">'+
                                                    '<div class="row">'+
                                                        '<div class="col-md-12">'+
                                                            '<p class="certificate_description">'+description+'</p>'+
                                                        '</div>'+
                                                    '</div>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div> ';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','certificate-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('certificate-form-0 in');
                                    $this.parent().addClass('certificate-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.certificate-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_certificate_form').show();
                                }
                                window.location.hash = '#certificate-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_name]');
                                    console.log(data.errors.name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('description' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_description]');
                                    console.log(data.errors.description)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_description').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.description).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }   
                            else if (data.msg) {
                                alert(data.msg)
                            }

                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                }
                $('form[id^=certificate-form]').submit(function(e){update_certificate(this,e)});
                $('.add_certificate_form').click(function(){
                    $(this).hide();
                    certificate_form = $('#certificate_form').clone();
                    certificate_form.attr('id','');
                    certificate_form.addClass('in form-row');
                    certificate_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    });
                    certificate_form.insertAfter($('#certificate_form'));
                    $('.form-row #certificate-form-0').submit(function(e){update_certificate(this,e)});
                });

            //Project

                function update_project(_this,e){
                    $this = $(_this);
                    // alert('submitting');
                    e.preventDefault();

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    id = $this.data('id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id','value':id})

                    // Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_project_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.project-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    $row.find('.project_name').html($this.find('#id_name').val());
                                    $row.find('.project_description').html($this.find('#id_description').val());
                                }
                                else {
                                    // q='.project-form-0:not(';
                                    // $(q).collapse('toggle');
                                    // $this = $(q);
                                    name = $this.find('#id_name').val()
                                    description = $this.find('#id_description').val()
                                    html =  '<div class="row project-form-'+data.id+' collapse fade in">'+
                                            '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                '<h4 class="pl15 pr15">'+
                                                    '<i class="fa fa-certificate"></i> <span class="project_name">'+name+'</span>'+
                                                    ' | <small>'+
                                                        '<a data-toggle="collapse" data-target=".project-form-'+data.id+'" class="clickable">Update</a>'+
                                                        ' - '+
                                                        '<a class="clickable remove-card" data-card=".project-form-'+data.id+'" data-card-type="project"> Remove</a>'+
                                                        '</a>'+
                                                    '</small>'+
                                                '</h4>'+
                                                '<div class="container-fluid">'+
                                                    '<div class="row">'+
                                                        '<div class="col-md-12">'+
                                                            '<p class="project_description">'+description+'</p>'+
                                                        '</div>'+
                                                    '</div>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div> ';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','project-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('project-form-0 in');
                                    $this.parent().addClass('project-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.project-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_project_form').show();
                                }
                                window.location.hash = '#project-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_name]');
                                    console.log(data.errors.name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('description' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_description]');
                                    console.log(data.errors.description)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_description').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.description).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }   
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                }
                $('form[id^=project-form]').submit(function(e){update_project(this,e)});
                $('.add_project_form').click(function(){
                    $(this).hide();
                    project_form = $('#project_form').clone();
                    project_form.attr('id','');
                    project_form.addClass('in form-row');
                    project_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    });
                    project_form.insertAfter($('#project_form'));
                    $('.form-row #project-form-0').submit(function(e){update_project(this,e)});
                });

            //Language
                function update_language(_this,e){
                    $this = $(_this);
                    // alert('submitting');
                    e.preventDefault();

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    console.log(formdata)

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    id = $this.data('id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id','value':id})

                    // Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_language_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.language-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    $row.find('.language_name').html($this.find('#id_language option:selected').text());
                                    level = []
                                    if ($this.find('#id_read')[0].checked){
                                        level.push('Read')
                                    }
                                    if ($this.find('#id_write')[0].checked){
                                        level.push('Write')
                                    }
                                    if ($this.find('#id_speak')[0].checked){
                                        level.push('Speak')
                                    }
                                    level = level.join();
                                    $row.find('.language_level').html(level);
                                    
                                }
                                else{
                                    level = []
                                    if ($this.find('#id_read')[0].checked){
                                        level.push('Read')
                                    }
                                    if ($this.find('#id_write')[0].checked){
                                        level.push('Write')
                                    }
                                    if ($this.find('#id_speak')[0].checked){
                                        level.push('Speak')
                                    }
                                    level = level.join();
                                    html = '<div class="row language-form-'+data.id+' collapse fade in">'+
                                                '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                    '<h4 class="pl15 pr15">'+
                                                        '<i class="fa fa-language"></i> <span class="language_name">'+$this.find('#id_language option:selected').text()+'</span>'+
                                                        ' | <small>'+
                                                            '<a data-toggle="collapse" data-target=".language-form-'+data.id+'" class="clickable">Update</a>'+
                                                            ' - '+
                                                            '<a class="clickable remove-card" data-card=".language-form-'+data.id+'" data-card-type="language"> Remove</a>'+
                                                        '<small class="pull-right"><i class="fa fa-flag-checkered"></i> <span class="language_level">'+level+'</span></small>'+
                                                    '</h4>'+
                                                '</div>'+
                                            '</div>';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.parent().removeClass('language-form-0 in');
                                    $this.parent().addClass('language-form-'+data.id);
                                    $this.attr('id','language-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.language-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_language_form').show();
                                }
                                window.location.hash = '#language-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('language' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_name]');
                                    console.log(data.errors.name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('read' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_read]');
                                    console.log(data.errors.read)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_read').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.read).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('write' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_write]');
                                    console.log(data.errors.write)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_write').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.write).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('speak' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_speak]');
                                    console.log(data.errors.speak)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_speak').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.speak).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }   
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                }
                $('form[id^=language-form]').submit(function(e){update_language(this,e)});
                $('.add_language_form').click(function(){
                    $(this).hide();
                    language_form = $('#language_form').clone();
                    language_form.attr('id','');
                    language_form.addClass('in form-row');
                    language_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    });
                    language_form.insertAfter($('#language_form'));
                    $('.form-row #language-form-0').submit(function(e){update_language(this,e)});
                });
            $('#remove-modal').on('hidden.bs.modal',function(){
                $(this).find('.remove').data('card-type','').data('card','');
                $(this).find('.header').html('');
                $(this).find('.msg').html('');
                $(this).find('.btn').html('Remove').prop('disabled',false).removeClass('disabled');
                $(this).find('button').html('Cancel');
            });
            $('#remove-modal .remove').click(function(){
                $this = $(this).parents('.modal');
                $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).addClass('disabled');
                cardtype = $(this).attr('data-card-type');
                cardclass = $(this).attr('data-card');
                console.log(cardtype);
                console.log(cardclass);
                id = cardclass.replace('.'+cardtype+'-form-','')
                console.log(id);
                $.ajax({
                    url: "/ajax/delete_section/",
                    type:'post',
                    data: {
                        id: id,
                        type: cardtype,
                    },
                    complete: function(){
                        $this.find('.btn').html('Remove').prop('disabled',false).removeClass('disabled');
                        $this.find('button').html('Cancel');
                    },
                    success: function(data){
                        console.log(data);
                        if (data.success){
                            $this.modal('hide');
                            $(cardclass).css('border-color:#337ab7');
                            setTimeout(function(){
                                $section = $(cardclass).parents('section');
                                $(cardclass).next('hr').remove();
                                $(cardclass).remove();
                                checkforsurvivors($section);
                            },1000);
                            alert(data.msg);
                        }
                        else {
                            if($this.hasClass('in')){
                                $this.find('msg').html(data.msg);
                                setTimeout(function(){
                                    $this.modal('hide');
                                },2000);
                            }
                            else {
                                alert(data.msg);
                            }
                        }
                    },
                    error: function(error){
                        console.log(error);
                    }
                })
            });
            function removeCard(_this){
                $this = $(_this);
                cardtype = $this.attr('data-card-type');
                cardclass = $this.attr('data-card');
                $('#remove-modal .header').html(cardtype);
                $('#remove-modal .remove').attr('data-card-type',cardtype).attr('data-card',cardclass);
                console.log($('#remove-modal .remove'))
                $('#remove-modal').modal('show');
                // $(cardclass).remove();
            }

        /*End Validation*/
        function checkforsurvivors($this){
            // console.log($this.find('.form-row').length)
            $this = $($this);
            if($this.find('.form-row').length == 0){
                $this.find('.no-card').collapse('show')
            }
        }
        $('.form-add').click(function(){
            $(this).parents('section').find('.no-card').collapse('hide');
        })
        
        String.prototype.splice = function(idx, rem, str) {
            return this.slice(0, idx) + str + this.slice(idx + Math.abs(rem));
        };
    </script>
    <script>
        {% if recruiter and vacancy.company|args:'JM_DURATION'|call:'check_service' %}
            var daterangeoptions = {
                "ranges": {
                    "Next 7 Days": [
                        moment(),
                        moment().add(6, 'days'),
                    ],
                    "Next 30 Days": [
                        moment(),
                        moment().add(29, 'days'),
                    ],
                    'This Month': [
                        moment().startOf('month'), 
                        moment().endOf('month')
                    ],
                    "Next Month": [
                        moment().add(1, 'month').startOf('month'),
                        moment().add(1, 'month').endOf('month')
                    ],
                    "Next 3 Months": [
                        moment().add(1, 'month').startOf('month'),
                        moment().add(3, 'month').endOf('month')
                    ],
                    "Next 6 Months": [
                        moment().add(1, 'month').startOf('month'),
                        moment().add(6, 'month').endOf('month')
                    ]
                },
                "autoApply": true,
                "drops": 'down',
                "autoUpdateInput": true,
                "alwaysShowCalendars": true,
                "startDate": moment(),
                "endDate": moment().add(29,'days'),
                "minDate": moment(),
                "opens": "center",
                "applyClass": "btn-info-inverse",
                "buttonClasses": "btn",
                "cancelLabel": 'Cancel'
            }
            $(document).ready(function(){
                $('#id_pub_date').daterangepicker(daterangeoptions);
            })
        {% endif %}
    </script>
    <script>
        var revoke = function(_this,code){
            $(_this).html('<i class="fa fa-spinner fa-pulse"></i> Please Wait...');
            $.ajax({
                data:{
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                url:'/ajax/revokesocial/' + code + '/',
                type: 'POST',
                complete: function(){

                },
                success: function(data){
                    if(data.success == true){
                        $('.refresh-smart-share').click();
                    }
                    if (data.msg){
                        alert(data.msg)
                    }
                },
                error: function(er){
                    console.log(er)
                }
            })
        }
    </script>
    <script>
        {% if request.session.fill_template == vacancy.id or fill_template == vacancy.id %}
            $(document).ready(function(){
                $('#custom-form').modal('show')
            });
            $('#custom_form_submit').click(function(){
                $this = $(this);
                data = $(this).closest('form').serialize();
                $this.html('<i class="fa fa-pulse fa-spinner"></i> Please Wait...').attr('disabled','disabled');
                $.ajax({
                    data: data,
                    url: '/ajax/template-form/',
                    type:'post',
                    complete: function(){
                        $this.html('Submit').removeAttr('disabled');
                    },
                    success: function(data){
                        if(!data.html){
                            location.reload();
                        }
                        else {
                            $('#custom-form .modal-body').html(data.html)
                        }
                    },
                    error: function(er){
                        console.log(er);
                    }
                })
            })
        {% endif %}
        
    </script>
{% endblock %}