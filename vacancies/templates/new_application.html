{% extends "base/base.html" %}
{% load i18n %}
{#{% load pagination_tags %}#}
{% load TRM_tags %}

{% block title %}{{vacancy.company.name}} | {{ vacancy.employment }}{% endblock %}
{% block css %}
    <link href="{{STATIC_URL}}datepicker/css/datepicker3.css" rel="stylesheet" type="text/css"/>
    <link href="{{STATIC_URL}}daterange/daterangepicker.css" rel="stylesheet">
{% endblock %}

{% block subnav %} 
    {% include 'application_sub_nav.html' %}
    {% include 'vacancies/referer_sub_nav.html' %}
{% endblock %}
{% block content %}
    <div class="container mt40 pt40">
        <div class="row">
			<div class="col-md-8 col-lg-6 col-md-offset-2 col-lg-offset-3">
				<h4 class="text-light no-margin mb5">One step away...</h4>
				<div class="panel panel-info clickable" data-toggle="modal" data-target="#edit-profile-modal">
				    <div class="panel-body row card-highlight no-margin">
				    	<div class="col-xs-12 mt-5 mb5 no-padding">
				    		<button class="btn btn-round btn-sm pull-right ml5 btn-default hidden"><i class="fa fa-ellipsis-v"></i></button>
				    		<button class="btn btn-round btn-sm pull-right ml5 btn-default"><i class="fa fa-pencil"></i></button></div>
				    	<div class='col-xs-5 border-right border-light '>
				    		<p><img class="img-thumbnail" src="{{MEDIA_URL}}{{settings.PHOTO_USER_DEFAULT}}"></p>
				    		<p class="no-margin mb10 text-info {% if not applicant.first_name or not applicant.last_name %}text-danger {% endif %}"><b>{{applicant.full_name|title|default:'Name Required'}}{% if not applicant.first_name or not applicant.last_name %} *{% endif %}</b></p>
				    		<p class="no-margin small mb5 {% if not applicant.public_email and request.user.is_anonymous or not applicant.public_email and request.user.recruiter %}text-danger{% endif %}">{% if request.user.is_anonymous or request.user.recruiter %}{{applicant.public_email|default:'Email Required'}}{% else %}{{applicant.user.email }}{% endif %}{% if not applicant.public_email and request.user.is_anonymous or not applicant.public_email and request.user.recruiter %} *{% endif %}</p>
                            {% if applicant.phone %}
    				    		<p class="no-margin small mb5">{{applicant.phone|default:''}}</p>
                            {% endif %}
                            {% if applicant.get_address %}
    				    		<p class="no-margin small mb5">{{applicant.get_address}}</p>
                            {% endif %}
				    	</div>
				    	<div class='col-xs-7 mh250'>
				    		<p><b>Work <small class="inline-block text-light">({{applicant.total_experience}})</small></b></p>
				    		<ul>
                                {% for experience in applicant.expertise_set.all %}
                                    <li class="lh1 mb5">
                                        <b class="pr10">{{experience.employment|title}}</b>
                                        <small class="inline-block">
                                            <i>{{experience.start_date|no_date}}{% if experience.start_date and experience.end_date or experience.start_date and experience.present %} - {% endif %}{% if experience.present %} Present {% else %}{{experience.end_date|no_date}}{% endif %}</i>
                                        </small>
                                        <br>
                                        <small>{{experience.company|title}}</small>
                                    </li>
                                {% empty %}
                                    <small class="text-light">No Experience</small>
                                {% endfor %}
                            </ul>
                            <p><b>Education</b></p>
                            <ul>
                                {% for education in applicant.academic_set.all %}
                                    <li class="lh1 mb5">
                                        <b class="pr10">{{education.course_name|title}}</b>
                                        <small class="inline-block">
                                            <i>{{education.start_date|no_date}}{% if education.start_date and education.end_date or education.start_date and education.status.codename == 'progress' %} - {% endif %}{% if education.status.codename == 'progress' %} In Progress {% else %}{{education.end_date|no_date}}{% endif %}</i>
                                            </small>
                                        <br>
                                        <small>{{education.school|title}}{% if education.city or education.state or education.country %}, {{education.city|title}}{% if education.city %}, {% endif %}{{education.state}}{% if education.state %}, {% endif %}{{education.country}}{% endif %}</small>
                                    </li>
                                {% empty %}
                                    <small class="text-light">No Education Record</small>
                                {% endfor %}
                            </ul>
				    	</div>
                        {% if not applicant.first_name or not applicant.last_name or not applicant.public_email and request.user.is_anonymous or not applicant.public_email and request.user.recruiter %}
                            <div class="col-xs-12 text-danger"><i class="small"> * {% if request.user.recruiter %}Candidate's{%else %}Your{% endif %} full name and email are required to apply</i></div>
                        {% endif %}
				    </div>
				</div>
                <p class="pl20 pr20"><i class="fa fa-upload"></i> <b> {{uploaded_file|default:"No Attachments"}}</b></p>
                {% if conflicts.education or conflicts.experience %}<hr>{% endif %}
                {% if conflicts.education %}
                    <div class="panel panel-trans panel-conflict">
                        <div class="panel-back box-shadow-light "></div>
                        <div class="panel-body no-padding panel-front box-shadow-light">
                            {% with applicant.academic_set.first as education %}
                                <div class="col-xs-9 col-sm-10 pt5 pb5 no-overflow Mh50">
                                    <div class="pull-left">
                                    <h4 class="no-margin">Academic Qualifications</h4>
                                    <ul class="no-margin" style="list-style:circle;padding-left:20px"><li>. {{education.course_name}} at <small>{{education.school}}</small></li></ul>
                                    </div><div class="text-right pending-action-overlay">
                                        {{conflicts.education|length|limit_number:10}} Pending Actions
                                    </div>
                                </div>
                                <a class="col-xs-3 col-sm-2 pt15 pb15 btn btn-info panel-button pull-right no-border" href="{% url 'vacancies_new_application_resolve_conflicts' vacancy.id 1 %}">Review
                                </a>
                            {% endwith %}
                        </div>
                    </div>
                {% endif %}
                {% if conflicts.experience %}
                    <div class="panel panel-trans panel-conflict">
                        <div class="panel-back box-shadow-light "></div>
                        <div class="panel-body no-padding panel-front box-shadow-light">
                            {% with applicant.expertise_set.first as experience %}
                                <div class="col-xs-10 pt5 pb5 no-overflow Mh50">
                                    <div class="pull-left">
                                    <h4 class="no-margin">Experience</h4>
                                    <ul class="no-margin" style="list-style:circle;padding-left:20px"><li>. {{experience.emloyment}} at <small>{{experience.company}}</small></li></ul>
                                    </div><div class="text-right pending-action-overlay">
                                        {{conflicts.experience|length|limit_number:10}} Pending Actions
                                    </div>
                                </div>
                                <a class="col-xs-2 pt15 pb15 btn btn-info panel-button pull-right no-border" href="{% url 'vacancies_new_application_resolve_conflicts' vacancy.id 2 %}">Review
                                </a>
                            {% endwith %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        {% if sa_profile and request.user.is_anonymous %}
            <div class="row">
                <div class="col-md-8 col-lg-6 col-md-offset-2 col-lg-offset-3 pl40 pr40">
                    <hr>
                    <p class='text-center'>Hi {{applicant.first_name|title|default:'Anonymous'}}, we found your profile with SpotAxis</p>
                    <button class="btn-block btn btn-default" data-toggle="modal" data-target="#trm_apply">Login to apply with full profile</button>
                </div>
            </div>
        {% endif %}
        {% if applicant.first_name and applicant.last_name %}
            {% if applicant.public_email or request.user.is_authenticated %}
        		<form class="row" action="{% url 'vacancies_complete_application' vacancy.id %}" method="post">
        			<div class="col-xs-6 col-xs-offset-3 col-sm-4 col-sm-offset-4 col-lg-2 col-lg-offset-5">
                        <hr>
                        {% csrf_token %}
                        <button class="btn btn-info-trans mt20 btn-block">Apply {% if sa_profile or request.user.is_authenticated %}Anyway{% endif %}</button>
                    </div>
        		</form>
            {% endif %}
        {% endif %}
	</div>
	<div class="modal fade" id="edit-profile-modal" role="dialog" tabindex="-1">
        <div class="modal-dialog">
            <form class="modal-content" method="post" action=".">
                {% csrf_token %}
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4>Edit Profile</h4>
                </div>
                <div class="modal-body">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group">
                            <label for="id_first_name" class="{% if candidate_form.first_name.errors %}text-danger{%endif%}">
                                {% if candidate_form.first_name.errors %}
                                    {% for error in candidate_form.first_name.errors%}
                                        {{error}}<br>
                                    {% endfor %}
                                {% else %}
                                    {% trans 'First Name' %}<span class="required">*</span>
                                {% endif %}
                            </label>
                            <div class="input-group input-group-sm {% if candidate_form.first_name.errors %}has-error{% endif %} ">
                                <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                {{ candidate_form.first_name }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group">
                            <label for="id_last_name" class="{% if candidate_form.last_name.errors %}text-danger{%endif%}">
                                {% if candidate_form.last_name.errors %}
                                    {% for error in candidate_form.last_name.errors%}
                                        {{error}}<br>
                                    {% endfor %}
                                {% else %}
                                    {% trans 'Last Name' %}<span class="required">*</span>
                                {% endif %}
                            </label>
                            <div class="input-group input-group-sm {% if candidate_form.last_name.errors %}has-error{% endif %} ">
                                <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                {{ candidate_form.last_name }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group">
                            <label for="id_public_email" class="{% if candidate_form.public_email.errors %}text-danger{%endif%}">
                                {% if candidate_form.public_email.errors %}
                                    {% for error in candidate_form.public_email.errors%}
                                        {{error}}<br>
                                    {% endfor %}
                                {% else %}
                                    {% trans 'Email' %}<span class="required">*</span>
                                {% endif %}
                            </label>
                            <div class="input-group input-group-sm {% if candidate_form.public_email.errors %}has-error{% endif %} ">
                                <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                {{ candidate_form.public_email }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group">
                            <label for="id_phone" class="{% if candidate_form.phone.errors %}text-danger{%endif%}">
                                {% if candidate_form.phone.errors %}
                                    {% for error in candidate_form.phone.errors%}
                                        {{error}}<br>
                                    {% endfor %}
                                {% else %}
                                    {% trans 'Phone' %}<span class="required"></span>
                                {% endif %}
                            </label>
                            <div class="input-group input-group-sm {% if candidate_form.phone.errors %}has-error{% endif %} ">
                                <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                {{ candidate_form.phone }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group">
                            <label for="id_nationality" class="{% if candidate_form.nationality.errors %}text-danger{%endif%}">
                                {% if candidate_form.nationality.errors %}
                                    {% for error in candidate_form.nationality.errors%}
                                        {{error}}<br>
                                    {% endfor %}
                                {% else %}
                                    {% trans 'Country' %}<span class="required"></span>
                                {% endif %}
                            </label>
                            <div class="input-group input-group-sm {% if candidate_form.nationality.errors %}has-error{% endif %} ">
                                <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                {{ candidate_form.nationality }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group">
                            <label for="id_state" class="{% if candidate_form.state.errors %}text-danger{%endif%}">
                                {% if candidate_form.state.errors %}
                                    {% for error in candidate_form.state.errors%}
                                        {{error}}<br>
                                    {% endfor %}
                                {% else %}
                                    {% trans 'State' %}<span class="required"></span>
                                {% endif %}
                            </label>
                            <div class="input-group input-group-sm {% if candidate_form.state.errors %}has-error{% endif %} ">
                                <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                {{ candidate_form.state }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group">
                            <label for="id_city" class="{% if candidate_form.city.errors %}text-danger{%endif%}">
                                {% if candidate_form.city.errors %}
                                    {% for error in candidate_form.city.errors%}
                                        {{error}}<br>
                                    {% endfor %}
                                {% else %}
                                    {% trans 'City' %}<span class="required"></span>
                                {% endif %}
                            </label>
                            <div class="input-group input-group-sm {% if candidate_form.city.errors %}has-error{% endif %} ">
                                <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                {{ candidate_form.city }}
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-12 text-center text-info clickable mb20 mt10" data-toggle="collapse" data-target=".advanced_form">Advanced <i class="fa fa-caret-down advanced_form collapse fade {% if not advanced_error %} in {% endif %} inline-block"></i> <i class="fa fa-caret-up advanced_form collapse fade{% if advanced_error %} in {% endif %} inline-block"></i></div>
                    <div class="advanced_form collapse fade {% if advanced_error %} in {% endif %}">
                        <div class="col-xs-12">
                            <h3 class="text-light">
                                <span>Experience</span>
                                <a id="add-expertise-form" class=" inline-block clickable"><small><small class="text-info va-mid ml10"><i class="fa fa-plus"></i> Add</small></small></a>
                            </h3>
                        </div>
                        <div id="expertise_section">
                            {{expertise_forms.management_form}}
                            {% for form in expertise_forms.forms %}<div class="col-xs-12"><hr></div>
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}  
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.employment.auto_id}}" class="{% if form.employment.errors %}text-danger{%endif%}">
                                            {% if form.employment.errors %}
                                                {% for error in form.employment.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'Job Role' %}<span class="required">*</span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.employment.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.employment}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.company.auto_id}}" class="{% if form.company.errors %}text-danger{%endif%}">
                                            {% if form.company.errors %}
                                                {% for error in form.company.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'Company' %}<span class="required">*</span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.company.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.company}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <div class="input-group input-group-sm {% if form.present.errors %}has-error{% endif %} ">
                                            {{form.present}}
                                            <label for="{{form.present.auto_id}}" class="ml10">{% trans 'Current Job?' %}</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.employment_start_date.auto_id}}" class="{% if form.employment_start_date.errors %}text-danger{%endif%}">
                                            {% if form.employment_start_date.errors %}
                                                {% for error in form.employment_start_date.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'Start Date' %}<span class="required">*</span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.employment_start_date.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.employment_start_date}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.employment_end_date.auto_id}}" class="{% if form.employment_end_date.errors %}text-danger{%endif%}">
                                            {% if form.employment_end_date.errors %}
                                                {% for error in form.employment_end_date.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'End Date' %}<span class="required"></span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.employment_end_date.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.employment_end_date}}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div id="empty-expertise-form" class="hidden">
                            {% with expertise_forms.empty_form as form %}
                                <div class="col-xs-12"><hr></div>
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}  
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.employment.auto_id}}">{% trans 'Job Role' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.employment.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.employment}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.company.auto_id}}">{% trans 'Company' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.company.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.company}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <div class="input-group input-group-sm {% if form.present.errors %}has-error{% endif %} ">
                                            {{form.present}}
                                            <label for="{{form.present.auto_id}}" class="ml10">{% trans 'Current Job?' %}</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.employment_start_date.auto_id}}">{% trans 'Start Date' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.employment_start_date.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.employment_start_date}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.employment_end_date.auto_id}}">{% trans 'End Date' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.employment_end_date.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.employment_end_date}}
                                        </div>
                                    </div>
                                </div>
                            {% endwith %}
                        </div>
                        <div class="col-xs-12"><hr></div>
                        <div class="col-xs-12">
                            <h3 class="text-light">
                                <span>Education</span>
                                <a id="add-academic-form" class=" inline-block clickable"><small><small class="text-info va-mid ml10"><i class="fa fa-plus"></i> Add</small></small></a>
                            </h3>
                        </div>

                        <div id="academic_section">
                            {{academic_forms.management_form}}
                            {% for form in academic_forms.forms %}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}  
                                <div class="col-xs-12"><hr></div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.course_name.auto_id}}" class="{% if form.course_name.errors %}text-danger{%endif%}">
                                            {% if form.course_name.errors %}
                                                {% for error in form.course_name.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'Course Name' %}<span class="required">*</span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.course_name.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.course_name}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.school.auto_id}}" class="{% if form.school.errors %}text-danger{%endif%}">
                                            {% if form.school.errors %}
                                                {% for error in form.school.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'Institute' %}<span class="required">*</span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.school.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.school}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_country.auto_id}}" class="{% if form.academic_country.errors %}text-danger{%endif%}">
                                            {% if form.academic_country.errors %}
                                                {% for error in form.academic_country.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'Country' %}<span class="required"></span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.academic_country.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_country}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_state.auto_id}}" class="{% if form.academic_state.errors %}text-danger{%endif%}">
                                            {% if form.academic_state.errors %}
                                                {% for error in form.academic_state.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'State' %}<span class="required"></span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.academic_state.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_state}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_city.auto_id}}" class="{% if form.academic_city.errors %}text-danger{%endif%}">
                                            {% if form.academic_city.errors %}
                                                {% for error in form.academic_city.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'City' %}<span class="required"></span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.academic_city.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_city}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.status.auto_id}}" class="{% if form.status.errors %}text-danger{%endif%}">
                                            {% if form.status.errors %}
                                                {% for error in form.status.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'Status' %}<span class="required">*</span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.status.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.status}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_start_date.auto_id}}" class="{% if form.academic_start_date.errors %}text-danger{%endif%}">
                                            {% if form.academic_start_date.errors %}
                                                {% for error in form.academic_start_date.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'Start Date' %}<span class="required"></span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.academic_start_date.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_start_date}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_end_date.auto_id}}" class="{% if form.academic_end_date.errors %}text-danger{%endif%}">
                                            {% if form.academic_end_date.errors %}
                                                {% for error in form.academic_end_date.errors%}
                                                    {{error}}<br>
                                                {% endfor %}
                                            {% else %}
                                                {% trans 'End Date' %}<span class="required"></span>
                                            {% endif %}
                                        </label>
                                        <div class="input-group input-group-sm {% if form.academic_end_date.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_end_date}}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div id="empty-academic-form" class="hidden">

                            {% with academic_forms.empty_form as form %}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}  
                                <div class="col-xs-12"><hr></div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.course_name.auto_id}}">{% trans 'Course Name' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.course_name.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.course_name}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.school.auto_id}}">{% trans 'Institute' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.school.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.school}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_country.auto_id}}">{% trans 'Country' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.academic_country.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_country}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_state.auto_id}}">{% trans 'State' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.academic_state.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_state}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_city.auto_id}}">{% trans 'City' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.academic_city.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_city}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.status.auto_id}}">{% trans 'Status' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.status.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.status}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_start_date.auto_id}}">{% trans 'Start Date' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.academic_start_date.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_start_date}}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label for="{{form.academic_end_date.auto_id}}">{% trans 'End Date' %}<span class="required">*</span></label>
                                        <div class="input-group input-group-sm {% if form.academic_end_date.errors %}has-error{% endif %} ">
                                            <div class="input-group-addon"><i class="fa fa-tag fa-lg"></i></div>
                                            {{form.academic_end_date}}
                                        </div>
                                    </div>
                                </div>
                            {% endwith %}
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info">{% trans 'Update' %}</button>
                </div>
            </form>
        </div>
    </div>
    {% if not user.is_authenticated %}
        <div class="modal fade" tabindex="-1" role="dialog" id="trm_apply">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Apply for {{vacancy.employment}}</h4>
                </div>
                <div class="modal-body">
                    <section id="public-form">
                        {% if my_vacancy or not user_profile %}
                            {% include "login_form.html" %}
                        {% endif %}
                    </section>
                </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    {% endif %}
{% endblock %}
{% block java_script_code %}
    <script src="{{STATIC_URL}}js/jquery-ui.min.js"></script>
    <script src="{{STATIC_URL}}datepicker/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}ckeditor/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}ckeditor/ckeditor-init.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}daterange/moment.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}daterange/daterangepicker.js"></script>
    <script type="text/javascript">
        new Clipboard('.btn-copy');
        {% if my_vacancy or not user_profile %}
            $('#id_file').change(function(){
                if(this.files && this.files[0] && this.files[0].size > 5*1024*1024) {
                    alert('File exceeds 5MB file size')
                    this.value="";
                }
            })
        {% endif %}
        $('.btn-copy').click(function(){
            $this = $(this);
                $this.parents('.copy-block').find('.btn-copy-text').removeClass('hidden')
                $this.parents('.copy-block').find('.btn-copy-text').addClass('animated fadeOutUp');
                setTimeout(function(){
                    console.log($this);
                    $this.parents('.copy-block').find('.btn-copy-text').addClass('hidden');
                    $this.parents('.copy-block').find('.btn-copy-text').removeClass('animated fadeOutUp')
                },500);
            });
        {% if my_vacancy %}
            // Only for job owners
            function finalize_vac(text, href) {
                // Change modal texts to end a job
                $('#fin-vac-modal-text').text(text);
                $('#btn-finalize-vacancy').attr("href", href)
            }

            function publish_vac(text, href) {
                // Change modal texts to publish a job
                $('#pub-vac-modal-text').text(text);
                $('#pub-vac-form').attr("action", href)
                // $('#publish-vac-modal').modal('show')
            }

            function unpublish_vac(text, href) {
                // Change modal texts to publish a job
                $('#unpub-vac-modal-text').text(text);
                $('#btn-unpublish-vacancy').attr("href", href)
                // $('#publish-vac-modal').modal('show')
            }
        {% endif %}

        {% if vacancy.public_cvs and public_form.errors %}
            {% if recruiter or request.user.is_anonymous %}
                console.log("has errors");
                window.location.hash = "public-form";
            {% endif %}
        {% endif %}

        {% if vacancy.postulate and user_profile == 'candidate' %}
            // Nominate a candidate for the vacancy if application is allowed
            function postulate(vacancy_id, _this, xhr) {
                console.log(_this)
                // console.log(this);
                $this = $(_this);
                var btn_postularse = $this;
                btn_postularse.html("<i class='fa fa-spinner fa-pulse'></i> Please wait...");
                btn_postularse.attr('disabled', 'disabled');
                var reset_btn_postularse = true;
                var btn_fav = $("#btn_fav_" + vacancy_id);
                $.ajax({
                    data: {
                        'vacancy_id': vacancy_id,
                        {% if referer %}
                            'referer':{{referer.id}},
                        {% endif %}
                        {% if external_referer %}
                            'external_referer':{{external_referer.id}},
                        {% endif %}
                    },
                    url: '/ajax/vacancies-postulate/',
                    type: 'GET',
                    complete: function(){
                        
                    },
                    success: function(data){
                        console.log(data);
                        var message = '';
                        if (data == 'not-postulate'){
                            message = 'This post does not allow applications';
                        }
                        if (data == 'incomplete'){
                            message = 'Your profile is not complete. Before applying please complete your Profile';
                        }
                        if (data == 'not-exist'){
                            message = 'You can not apply before creating your Profile';
                        }
                        if (data == 'postulated'){
                            message = 'You have already applied for this position';
                            btn_postularse.html("<i class='fa fa-pointer fa-check-square-o'></i> Applied");
                        }
                        if (data == 'error'){
                            message = 'An error has occured, please try again';
                        }
                        if (data == 'success'){
                            message = 'Success! You have successfully applied to this job opening';
                            btn_postularse.html("<i class='fa fa-pointer fa-check-square-o'></i> Applied");
                            // btn_postularse.addClass('btn-info');
                            reset_btn_postularse = false;
                            btn_fav.remove();

                        }
                        else {
                            btn_postularse.html('Apply').removeAttr('disabled')
                        }

                        if (reset_btn_postularse == true){
                            btn_postularse.html("<i class='fa fa-pointer fa-check-square-o'></i> Apply");
                            btn_postularse.removeAttr("disabled");
                        }
                        alert(message);
                        // $('#postulate-modal-text').html(message);
                        // $('#post-vac-modal').modal('show');
                        // setTimeout(function() {$('#post-vac-modal').modal('hide');}, 5000);
                    },
                    error: function(data) {
                        console.log(data)
                        alert ('An error has occured, please try again');
                    }
                });
            }
        {% endif %}

        var spinner = "<h4 class='text-center'><i class='fa fa-spinner text-info fa-pulse'></i></h4>"

        window.sharecount = {
                'fb': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                    'group': {
                        'success': 0,
                        'error': 0,
                    },
                    'page': {
                        'success': 0,
                        'error': 0,
                    }
                },
                'li': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                    'company': {
                        'success': 0,
                        'error': 0,
                    },
                },
                'tw': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                },
            }

        var sharer = function(social_code){
            console.log('sharing')
            var code = social_code.split('-')[0]
            if (code == 'add_referal_link'){
                return true
            }
            link = false;
            if($('#add_referal_link')[0].checked){
                link = true;
            }
            console.log(code)
            return $.ajax({
                data:{
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'social_code': social_code,
                    'message': $('#smart-share-form [name=message]').val(),
                    'vid': '{{vacancy.id}}',
                    'add_referal_link': link
                },
                url: '/ajax/socialshare/',
                type: 'POST',
                complete: function(){
                    console.log('completed')
                },
                success: function(data){
                    if(data.success == true){
                        
                        if (data.msg == true){
                            window.sharecount[code.substr(0,2)][code.substr(2)]['success'] += 1
                        }
                        else {
                            window.sharecount[code.substr(0,2)][code.substr(2)]['error'] += 1
                        }
                    }
                    else if (data.msg){
                        alert(data.msg)
                    }
                    console.log(window.sharecount[code.substr(0,2)][code.substr(2)]['success'])
                },
                error: function(error){
                    window.sharecount[code.substr(0,2)][code.substr(2)]['error'] += 1
                    console.log(error)
                }
            })
        }
        var share_success = function(e){
            // Share the success
            console.log('success')
            sharecount = window.sharecount
            success_message_prefix = "Posted to: "
            success_message = ""
            error_message_prefix = "Posting failed for: "
            error_message = ""
            if (sharecount['fb']['personal']['success'] > 0){
                success_message = "Facebook Wall, "
            }
            if (sharecount['fb']['group']['success'] > 0){
                success_message += sharecount['fb']['group']['success'] + " Facebook Groups, "
            }
            if (sharecount['fb']['page']['success'] > 0){
                success_message += sharecount['fb']['page']['success'] + " Facebook Pages, "
            }
            if (sharecount['li']['personal']['success'] > 0){
                success_message += "Linkedin Stream, "
            }
            if (sharecount['li']['company']['success'] > 0){
                success_message += sharecount['li']['company']['success'] + " Linkedin Company Pages, "
            }
            if (sharecount['tw']['personal']['success'] > 0){
                success_message += "Twitter, "
            }
            if (sharecount['fb']['personal']['error'] > 0){
                error_message = "Facebook Wall, "
            }
            if (sharecount['fb']['group']['error'] > 0){
                error_message += sharecount['fb']['group']['error'] + " Facebook Groups, "
            }
            if (sharecount['fb']['page']['error'] > 0){
                error_message += sharecount['fb']['page']['error'] + " Facebook Pages, "
            }
            if (sharecount['li']['personal']['error'] > 0){
                error_message += "Linkedin Stream, "
            }
            if (sharecount['li']['company']['error'] > 0){
                error_message += sharecount['li']['company']['error'] + " Linkedin Company Pages, "
            }
            if (sharecount['tw']['personal']['error'] > 0){
                error_message += "Twitter, "
            }
            console.log(success_message)
            if (success_message){
                alert(success_message_prefix + success_message.trim(', '))
            }
            if (error_message){
                alert(error_message_prefix + error_message.trim(', '))
            }
        }
        var share_reject = function(e){
            alert('We could not connect to one or more services. Please try again after some time.');
        }

        var smart_share = function(e){
            window.sharecount = {
                'fb': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                    'group': {
                        'success': 0,
                        'error': 0,
                    },
                    'page': {
                        'success': 0,
                        'error': 0,
                    }
                },
                'li': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                    'company': {
                        'success': 0,
                        'error': 0,
                    },
                },
                'tw': {
                    'personal': {
                        'success': 0,
                        'error': 0,
                    },
                },
            }

            e.preventDefault();
            e.stopPropagation();
            $form = $(this);
            $('.modal-backdrop').css('z-index','2000');
            initialtext = $form.find('button[type=submit]')[0].innerHTML;
            $form.find('button[type=submit]')[0].innerHTML = '<i class="fa fa-spinner fa-pulse"></i> Please Wait';
            promises = []
            $boxes = $form.find('[type=checkbox]:checked');
            $media=[]
            $boxes.each(function(index,box){
                $media.push(box.name);
            })
            if (!$boxes.length){
                alert('Please select atleast 1 media to post.')
            }
            Promise.all($media.map(sharer)
                ).then(
                    share_success,
                    share_reject
                ).then(function(){
                    $('.modal-backdrop').css('z-index','1040');
                    $form.find('button[type=submit]')[0].innerHTML = initialtext;
                });
        }
        var refresh_smart_share = function(e) {
            e.preventDefault();
            get_smart_share();
        }

        var get_smart_share = function(){
            $('#smart-share-content').html(spinner)
            $.ajax({
                url: '/ajax/smart-share/{{vacancy.id}}/',
                type: 'POST',
                complete: function(){
                    $('.refresh-smart-share').click(refresh_smart_share);  
                },
                success: function(data){
                    $('#smart-share-content').html(data);
                },
                error: function(data){
                    console.log(data);
                    $('#smart-share-content').html('<h5 class="text-light text-center">Failed to retrieve social integrations</h5><a class="btn btn-sm center-block refresh-smart-share"><i class="fa fa-refresh"></i> Try again</a>');
                }
            });            
        }


        {% if vacancy.questions %}
            {# Functions for sending questions and answers #}
            {% if user_profile == 'candidate' %}
                function do_question(){
                    // Question validation
                    var question =  $("#id_question").val();
                    var send = false;
                    var label_error = "";
                    if (question == "") {
                        label_error = "You must enter a question.";
                    }
                    else {
                        if (question.length <= 19 || question.length > 200) {
                            label_error = "Enter a question between 20 and 200 characters."
                        }
                        else {send = true;}
                    }
                    if (send == false) {
                        $("#label_question").html(label_error).addClass('text-error');
                        $("#div_question").addClass('has-error');
                        $("#id_question").focus() ;
                        $("#submit_btn").html("<i class='fa fa-comments'></i> {% trans 'Send questions' %}").prop('disabled', false).removeClass('disabled').attr("clicked", "false");
                    }
                    else {
                        $("#submit_btn").html("<i class='fa fa-spinner fa-pulse'></i> Please wait...").prop('disabled', true);
                    }
                    return send;
                }
            {% endif %}

            {% if my_vacancy and vacancy.status.codename == 'active' %}
                // Functions only available to vacancy owners

                function show_form_answer(question_id){
                    // Shows the corresponding form to answer a question
                    $('#div_form_answer_'+question_id).toggle("slow");
                }

                function answer_question(id_question, answer) {
                    // Ajax function to register a response, validations of previous form
                    return $.ajax({
                        data: {
                            'id': id_question,
                            'answer': answer,
                            'csrfmiddlewaretoken': '{{ csrf_token }}'
                        },
                        url: '/ajax/vacancies-answer-question/',
                        type: 'POST',
                        success: function(data) {
                            console.log("Response sent successfully");
                            return 1;
                        },
                        error: function(xhr, status, error) {
                            console.log("Failed to send response");
                            console.log(xhr.responseText);
                            console.log(error);
                            return 2;
                        }
                    });
                }

                $(document).delegate('form', 'submit', function hello(event) {
                    // Request to question response form is sent
                    var $form = $(this);
                    var id_question = $( this ).find('input:hidden[name=id_question]').val();
                    var answer_button = $("#id_answer_button_"+id_question);
                    var answer_text_area = $("#id_text_answer_"+id_question);
                    var answer = answer_text_area.val();
                    var send = true;
                    var label_error = "";

                    answer_button.html("<i class='fa fa-spinner fa-pulse'></i> PLease wait...").prop('disabled', true);

                    if (answer.length <= 19 || answer.length > 200) {
                        label_error = "Enter an answer between 20 and 200 characters.";
                        send = false;
                    }
                    if (send == false) {
                        $("#id_label_answer_"+id_question).html(label_error).addClass('text-error');
                        $("#div_answer_"+id_question).addClass('has-error');
                        answer_button.html("<i class='fa fa-comments'></i> {% trans 'Answer' %}").prop('disabled', false).removeClass('disabled').attr("clicked", "false");
                        answer_text_area.focus();
                    }

                    if (send == true) {
                        console.log("Sending...");
                        $.when(answer_question(id_question, answer)).done(function(a1){
                            $(document).ajaxStop(function() { location.reload(true); });
                        });
                    }
                    return false;
                });

            {% endif %}{# Only available to owner of Companies #}
        {% endif %}{# if vacancy.questions #}

        {% if user_profile == 'candidate' %}
            function mark_unmark_favorite(vacancy_id) {
                {# Check or uncheck a vacancy as favourite #}
                var btn_fav = $("#btn_fav_" + vacancy_id);
                $.ajax({
                    data: {
                        'id': vacancy_id,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    url: '/ajax/mark-vacancy-asfavorite/',
                    type: 'GET',
                    success: function(data){
                        console.log(data);
                        var message = '';
                        if (data == 'marked'){
                            btn_fav.html('<i class="fa fa-heart text-danger"></i> Forget');
                            console.log('Marked as favourite');
                        }
                        if (data == 'unmarked'){
                            btn_fav.html('<i class="fa fa-heart"></i> Apply Later');
                            console.log('Favourite was removed');
                        }
                        if (data == 'error'){
                            alert("Failed to mark as favourite. Pleas try again in a moment.");
                        }
                    },
                    error: function(xhr, status, error) {
                        alert("Failed to mark as favourite, please try again in a moment");
                    }
                });
            }
        {% endif %}
        {%if not user.is_authenticated %}
            $('#loginform').submit(function(e){
                $this = $(this);
                e.preventDefault();
                var formdata = $this.serializeArray();
                console.log(formdata);
                var url = '{%url "ajax_login"%}';
                console.log(url);
                $this.find('.error-list').remove();
                $this.find('has-error').removeClass('has-error');
                $.ajax({
                    url:url,
                    type:'post',
                    data:formdata,
                    complete:function(data){
                        $this.find('.btn[type=submit]').html('<i class="fa fa-sign-in fa-lg mr5"></i> Login').prop('disabled',false).removeClass('disabled');

                    },
                    success:function(data){
                        console.log(data);
                        if(data.success == true)
                        {
                            key = $this.data('key')
                            if (key)
                                location.href = location.href+"?"+key +"=true"
                            location.href = location.href   
                        }
                        else {
                            $this.find('.form-control').parents('.input-group').addClass('has-error');
                            $this.prepend('<div class="alert alert-danger error-list">Invalid Username/Password</div>')
                        }
                    }
                })
                return false;
            });
            function changeloginredirect(key){
                $('#loginform').data('key',key)
            }
        {%endif%}
        {%if not user.is_authenticated or recruiter %}
            {%if public_form.errors %}
                $(document).ready(function(){
                    $('#public_apply').modal('show');
                });
            {% endif%}
            // $('#public_apply form').submit(function(e){
                //     $this = $(this);
                //     // console.log($this);
                //     e.preventDefault();
                //     var formdata = $this.serializeArray();
                //     // formdata.append('csrfmiddlewaretoken',$this.find('[name=csrfmiddlewaretoken]').val())
                //     // console.log(formdata);
                //     var url = '/ajax/publicapplication/';
                //     // console.log(url);
                //     $this.find('.error-list').remove();
                //     $this.find('has-error').removeClass('has-error');

                //     $.ajax({
                //         url:url,
                //         type:'post',
                //         datatype:'json',
                //         autoupload:true,
                //         minFileSize:10,
                //         data: formdata,
                //         iframe: true,
                //         files: $this.find('input[type=file]'),
                //         // processData:false,
                //         complete:function(data){
                //             $this.find('.btn[type=submit]').html('<i class="fa fa-check-circle fa-lg"></i> Login').prop('disabled',false).removeClass('disabled');

                //         },
                //         success:function(data){
                //             console.log(data);
                //             if(data.success == true)
                //             {
                //                 location.href = location.href
                //             }
                //             else {
                //                 // $this.find('.form-control').parents('.input-group').addClass('has-error');
                //                 // $this.prepend('<div class="alert alert-danger error-list">Invalid Username/Password</div>')
                //             }
                //         },
                //         error:function(data){
                //             console.log(data)
                //         }
                //     })
                //     return false;
                // });
                // function csrfSafeMethod(method) {
                //     // these HTTP methods do not require CSRF protection
                //     return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                //  }

                // function getFileSize(bytes) {
                //     if (typeof bytes !== 'number') return '';
                //     if (bytes >= 1024000000) return (bytes / 1024000000).toFixed(1) + ' GB';
                //     if (bytes >= 1024000) return (bytes / 1024000).toFixed(1) + ' MB';
                //     return (bytes / 1024).toFixed(1) + ' KB';
                // }

                //  var existing_files = 0;
                // function validateFiles(data, existing_files) {
                //     var maxFileSize = parseInt({{ public_form.max_megas }}) * 1024000;  // Maximum size allowed per file in Megas
                //     var maxFiles = 1; // Maximum no of files permitted
                //     var error_total_files = false;
                //     var error_size = false;
                //     var error_ext = false;

                //     if(data.files.length + existing_files > maxFiles){
                //         alert("You can only upload unto " + maxFiles + " files");
                //         error_total_files = true;
                //     }

                //     $.each(data.files, function (index, file) {
                //         if (file.size > maxFileSize) {
                //             alert('The file size of ' + file.name + ' is greater than ' + maxFileSize + 'MB');
                //             error_size = true;
                //         }
                //         var ext = file.name.split('.').pop().toLowerCase();
                //         if($.inArray(ext, ['png','jpg','jpeg','bmp','doc','docx','xls','xlsx','ppt','pptx','ppsx','pdf']) == -1) {
                //             alert('Only Word, Excel, PowerPoint, PDF and images are allowed.');
                //             error_ext = true;
                //         }
                //     });

                //     return !(error_size == true || error_ext == true || error_total_files == true);
                // }

                // $(function () {
                //     'use strict';
                //     var url = '/upload/file/';
                //     var csrftoken = $.cookie('csrftoken');
                //     var btn_submit = $('#btn-submit');
                //     var vacancy_id = {% if vacancy_id %}{{ vacancy_id }}{% else %}0{% endif %};

                //     $('#id_file').fileupload({
                //         url: url,
                //         dataType: 'json',
                //         // {#                crossDomain: false,#}
                //         autoUpload: false,
                //         minFileSize: 10,
                //         formData: {vacancy_id: vacancy_id},
                //         change : function (e, data) {
                //             return validateFiles(data, existing_files);
                //         },
                //         drop : function (e, data) {
                //             return validateFiles(data, existing_files);
                //         },
                //         beforeSend: function(xhr, settings) {
                //             if (!csrfSafeMethod(settings.type)) {
                //                 xhr.setRequestHeader("X-CSRFToken", csrftoken);
                //             }
                //             btn_submit.attr('disabled', 'disabled').addClass('disabled').html('<i class="glyphicon glyphicon-plus"></i> Subiendo archivos... Por favor espere');
                //         },
                //         done: function (e, data) {
                //             console.log(data);
                //             console.log(e);
                //             $.each(data.result.files, function (index, file) {
                //                 {# Add new files to the template #}

                //                 var ext = file.name.split('.').pop().toLowerCase();
                //                 var fa_icon = "";
                //                 if (ext == 'pdf')
                //                     fa_icon = '<i class="fa fa-file-pdf-o"></i>';
                //                 if (ext == 'doc' || ext == 'docx')
                //                     fa_icon = '<i class="fa fa-file-word-o"></i>';
                //                 if (ext == 'xls' || ext == 'xlsx')
                //                     fa_icon = '<i class="fa fa-file-excel-o"></i>';
                //                 if (ext == 'ppt' || ext == 'pptx')
                //                     fa_icon = '<i class="fa fa-file-powerpoint-o"></i>';
                //                 if (ext == 'jpg' || ext == 'jpeg' || ext == 'png')
                //                     fa_icon = '<i class="fa fa-picture-o"></i>';

                //                 var newFile = $('<p id=file_' + file.pk + '/>').html(
                //                     fa_icon +
                //                     '<a href="{{ MEDIA_URL }}' + file.name + '" target="_blank" class="ml5">' +
                //                         file.name +
                //                     '</a>' +
                //                     ' - <span class="size">' + getFileSize(file.size) + '</span>' +
                //                     ' - ' +
                //                     '<button class="btn btn-danger btn-xs" data-pk="' + file.pk + '">' +
                //                         '<i class="fa fa-times"></i>' +
                //                         '<span>Delete</span>' +
                //                     '</button>'

                //                 );

                //                 $('#div-files').append(newFile);
                //                 data.context = newFile;

                //                 existing_files = data.result.objFiles;
                //                 $('#id-existing-files').text(existing_files);
                //             });
                //         },
                //         progressall: function (e, data) {
                //             {#                     Submit button is enabled after the uploading progress completes #}
                //             var progress_bar = $('#progress .progress-bar');
                //             progress_bar.css('width', progress + '%');
                //             var progress = parseInt(data.loaded / data.total * 100, 10);
                //             $('#progress .progress-bar').css('width', progress + '%');
                //             if (progress == 100) {
                //                 btn_submit.removeAttr("disabled").removeClass('disabled').html('<i class="glyphicon glyphicon-eye"></i>Create Job');
                //             }
                //         },
                //         fail: function (e, data) {
                //             console.log(data.errorThrown);
                //             alert(data.errorThrown);
                //         }
                //     }).prop('disabled', !$.support.fileInput).parent().addClass($.support.fileInput ? undefined : 'disabled');
                // });
        {%endif%}
    </script>
    <script>
        function getParameterByName(name, url) {
            console.log(name)
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
        {%if recruiter and not vacancy.status.codename == 'closed' and vacancy.company|args:'AT_CUSTOM_APPLICATION_PROCESS'|call:'check_service' %}
            $creating = false;
            var listSelect = {
              sortField:'text',
              openOnFocus:true,
              allowEmptyOption: false,
              allowPrecedence:true,
              hideSelected: true,
              multiple:false,
              selected:null,
              options:[],
              create:function (input, callback){
                if ($creating){
                    console.log('Already creating')
                    return false;
                }
                else {

                    $creating=true;
                    console.log('Lets go');
                }

                $.ajax({
                    url:'/ajax/addstage/',
                    type:'post',
                    data:{
                        'stage_name': input
                    },
                    complete: function(data){
                        // console.log(data);
                        if (this.isLocked){
                            this.unlock();
                            console.log('unlocked')
                        }
                        console.log(this);
                        $creating = false;
                    },
                    success: function(data){
                        console.log(data);
                        console.log('success')
                        if (data.success){
                            console.log('true')
                            console.log(callback)
                            response = {value:data.id,text:input}
                            console.log(response)
                            callback(response);
                        }
                        else {
                            alert('Failed. Try Again!!');
                        }
                    },
                    error: function(data){
                        console.log(data);
                    }
                })

              },
              onItemAdd: function(value,$item){
                console.log('added value')
                // console.log(value)
                // console.log($item)
                $newitem = $('#bucket-list #bucket').append('<div class="row bucket-item" data-id='+value+'>'+$item.html()+'</div>');
                console.log($newitem)
                $newitem.find('.bucket-item:last-child').click(function(e){
                    onclickremove(this)
                })
                this.removeOption(value);
                this.focus();
                $( "#bucket" ).sortable({placeholder: "ui-state-highlight", cancel: ".bucket-item-static"});
              },
            }
            $('#list').selectize(listSelect);
            $('#list')[0].selectize.$control_input.attr('maxlength',50);
            $('#list')[0].selectize.clear();
            $('#list')[0].selectize.open();

            $(document).ready(function(){
                $("#bucket").sortable({placeholder: "ui-state-highlight",cancel: ".bucket-item-static"});
            });

            function onclickremove($this){
                // console.log($this)
                $list = $('#list')[0].selectize;
                // console.log($list)
                $list.addOption({value:$($this).data('id'),text:$($this).html()})
                $list.refreshOptions();
                $($this).remove();
            }
            $('#bucket .bucket-item').click(function(e){
                onclickremove(this)
            });

            popshare = "{{request.session|args:'enableshare'|call:'pop'|default:''}}"
            if(!popshare){
                popshare = getCookie('popshare')
            }
            console.log(popshare)
            $('#app_procees_update').click(function(){
                console.log('saving');
                
                $bucket = $('#bucket-list #bucket');
                formdata = "";
                $this = $(this);
                $(this).html('<i class="fa fa-spinner fa-pulse fa-lg fa-fw"></i> Please Wait');
                $(this).addClass('disabled');
                $(this).prop('disabled',true);
                $bucket.find('.bucket-item').each(function(key,value){
                    formdata+=($(value).data('id')) + ",";
                });
                formdata = formdata.substring(0,formdata.length - 1);
                if (formdata.trim(',') == $('#bucket').data('list')){
                    alert('No changes made');
                    $this.html('<i class="fa fa-check-circle"></i> Save and Update');
                    $this.removeClass('disabled');
                    $this.prop('disabled',false);
                    $($this).parents('.modal').modal('hide');
                    return false;
                }
                else if(popshare){
                    setCookie('popshare','true',1)
                    popshare=false

                }
                $.ajax({
                    url:'/ajax/updatevacancystage/',
                    data: {
                        stage_ids: formdata.trim(','),
                        vacancy: '{{vacancy.id}}',
                    },
                    type:'post',
                    complete: function(data){
                        $this.html('<i class="fa fa-check-circle"></i> Save and Update');
                        $this.removeClass('disabled');
                        $this.prop('disabled',false);
                        
                    },
                    success: function(data){
                        console.log(data)
                        if(data.success){
                            $timeline = $('.timeline');
                            $timeline.html('');
                            for (timeline_item in data.timeline){
                                console.log(data.timeline[timeline_item]);
                                html ='<li><div class="direction-r"><div class="flag-wrapper"><span class="flag">'
                                        +'<a href="'+ data.timeline[timeline_item].href+'">'
                                        +data.timeline[timeline_item].label+'</a></span><span class="time-wrapper"><span class="time">'+data.timeline[timeline_item].count+'</span></span></div></div></li>'
                                $timeline.append(html);
                                // console.log(data.timeline[timeline_item].label);
                            }
                            // console.log(this)
                            $($this).parents('.modal').modal('hide');
                            location.href=location.href.split('?')[0]
                        }
                        else{
                            if (data.msg){
                                alert(data.msg);
                            }
                            else {
                                alert('Could Not Save. Please Try again')
                            }
                        }
                    },
                    error: function(error){
                        console.log(error);
                    },
                });
            })
            $(document).ready(function(){
                console.log('ready')
                if(getParameterByName('manage')){
                    $('#timeline_management').modal('show');
                    if (popshare){
                        $('#timeline_management').on('hidden.bs.modal', function(){
                            if (popshare){
                                popshare = false
                                $('#share-to-social-modal').modal();
                                $('#timeline_management').off('hidden.bs.modal');
                            }
                        })
                    }
                }
                else {
                    if (popshare){
                        popshare = false
                        $('#share-to-social-modal').modal();
                        setCookie('popshare','',0)
                    }
                }
            });
        {%endif%}
        {% if user_profile == 'candidate' or request.user.is_anonymous %}
            $('document').ready(function(){
                if(getParameterByName('apply')){
                    console.log('apply')
                    $('#trm_apply_button').click();
                }
                if(getParameterByName('public_apply')){
                    console.log('public_apply')
                    $('#public_apply').modal('show');
                }
                if(getParameterByName('mark_for_later')){
                    console.log('mark_for_later')
                    $('#btn_fav_{{vacancy.pk}}').click();
                }
            });
        $('.withdraw').click(function(){
            $this = $(this);
            id='{{postulate.id}}';
            $this.html('<i class="fa fa-pulse fa-spinner"></i> Please Wait').prop('disabled', true).addClass('disabled');
            $.ajax ({
                data:{
                    'id':id,
                },
                type: 'POST',
                url: '/ajax/withdraw/',
                complete: function(){
                    $this.html('Withdraw Application').removeClass('disabled').prop('disabled',false);
                },
                success: function(data){
                    console.log(data);
                    if(data.success == true){
                        location.href=location.href;
                    }
                },
                error: function(er){
                    console.log(er);
                }
            });
        });
        {% endif %}
    </script>
    <script>
        $(document).ready(function(){
            // $('#share-to-social-modal').modal();
            // $('#post-to-selector').selectize();$('#add-form1').click(function() {
            $('#add-academic-form').click(function() {
                var academic_index = $('#id_academic-TOTAL_FORMS').val();
                $('#academic_section').prepend($('#empty-academic-form').html().replace(/__prefix__/g, academic_index));
                $('#id_academic-TOTAL_FORMS').val(parseInt(academic_index) + 1);
            });

            if ($("#academic_section input").length === 0){
                $("#add-academic-form").trigger("click");
            }
            $('#add-expertise-form').click(function() {
                var expertise_index = $('#id_expertise-TOTAL_FORMS').val();
                $('#expertise_section').prepend($('#empty-expertise-form').html().replace(/__prefix__/g, expertise_index));
                $('#id_expertise-TOTAL_FORMS').val(parseInt(expertise_index) + 1);
            });

            if ($("#expertise_section input").length === 0){
                $("#add-expertise-form").trigger("click");
            }
        });

        {% if socialApplication %}
            $(document).ready(function(){
                $('#social-application-modal').modal();
            });
            $('#social-application-modal').on('hidden.bs.modal',function(){
                $('#social-application-modal').remove();
            })
        {% endif %}
        $('#candidate_preview').on('shown.bs.modal',function(){
            $(this).unbind('scroll');
            $(this).scroll(function(){
                topcontainer = $(this).find('.affix-head');
                if ($(this).scrollTop() > $(topcontainer)[0].scrollHeight+20){
                    $(topcontainer).css('visibility','hidden')
                    $('#candidate_preview_top').removeClass('hidden');
                }else{
                   $(topcontainer).css('visibility','visible') 
                   $('#candidate_preview_top').addClass('hidden');
                }
            })
        });
        $('#candidate_edit').on('shown.bs.modal',function(){
            // $(this).unbind('scroll');
            // $(this).scroll(function(){
                // topcontainer = $(this).find('.affix-head');
                // if ($(this).scrollTop() > $(topcontainer)[0].scrollHeight+20){
                    // $(topcontainer).css('visibility','hidden')
                $('#candidate_edit_top').removeClass('hidden');
                // }else{
                   // $(topcontainer).css('visibility','visible') 
                   // $('#candidate_preview_top').addClass('hidden');
                // }
            // })
        });
        $('#candidate_preview').on('hide.bs.modal',function(){
            $('#candidate_preview_top').addClass('hidden');
            $(this).find('.affix-head').css('visibility','visible');
        });
        $('#candidate_edit').on('hide.bs.modal',function(){
            $('#candidate_edit_top').addClass('hidden');
            $(this).find('.affix-head').css('visibility','visible');
        });
        var manage_toggler=function(){
            $('#candidate_preview').modal('hide')
            $('#candidate_preview').on('hidden.bs.modal', function(){
                $('#candidate_edit').modal({
                    backdrop:'static',
                    keyboard: false
                });
            })
        }
        var manage_edit_toggler=function(){
            $('#candidate_edit').modal('hide')
        }
        var dpicker = {
                format: "yyyy-mm-dd",
                startView: 1,
                minViewMode: 3,
                language: "en",
                autoclose: true
        };
        var academic_status_change = function(){
            $this = $(this);
            $form = $this.parents('form');
            if($this.val() == 5) {
                $form.find('#id_end_date').parents('.form-group').hide();
            }
            else {
                $form.find('#id_end_date').parents('.form-group').show();
            }
        }
        var experience_ongoing = function(){
            $this = $(this);
            $form = $this.parents('form');
            if($this[0].checked){
                $form.find('#id_end_date').parents('.form-group').hide();
            }
            else {
                $form.find('#id_end_date').parents('.form-group').show();
            }
        }
        $(document).ready(function () {
           {% if fileForm.file.errors %}
                $('#post-cv-modal').modal();
           {% endif %}
           {% if form_user_photo.errors %}
                $('#updateimage-modal').modal();
            {% endif %}
           {% if candidate %}
               $('#id_skills').selectize({create:true,createOnBlur:true});
               // $('#id_interests').selectize({create:true,createOnBlur:true});
               // $('#id_extra_curricularss').selectize({create:true,createOnBlur:true});
               // $('#id_hobbies').selectize({create:true,createOnBlur:true});
               // $('#id_others').selectize({create:true,createOnBlur:true});
                
                $('.remove-card').click(function(){
                    removeCard(this);
                })
                $('#id_photo').change(function(){
                    console.log('image changed');
                     if(this.files && this.files[0]) {
                        // var file = e.originalEvent.srcElement.files[i];
                        var img = $('#updateimage-modal img.user-photo');
                        if (this.files[0].size > 1*1024*1024){
                            alert('File exceeds 1MB file size')
                            this.value="";
                        }
                        else {
                            // console.log(img);
                            var reader = new FileReader();
                            reader.onload = function(e) {
                                // console.log(img.attr('src'))
                                 img.attr('src',e.target.result);
                                 // console.log(reader.result)
                                 // console.log(img.attr('src'))
                            }
                            reader.readAsDataURL(this.files[0]);
                        }
                        // $("input").after(img);
                    }
                });
            {%endif%}
            $('#academic-section [id=id_status]').change(academic_status_change);
            $('#experience-section [id=id_present]').change(experience_ongoing);
            $('#id_birthday').datepicker({
                    format: "yyyy-mm-dd",
                    startView: 2,
                    minViewMode: 3,
                    language: "en",
                    autoclose: true,
                    startDate: '-60y',
                    endDate: '-18y'
            });
            
            $('[id=id_end_date]').datepicker(dpicker);
            $('[id=id_start_date]').datepicker(dpicker);
        });
        function toreadabledate(d){
            var monthNames = ["Jan.", "Feb.", "Mar.", "Apr.", "May", "Jun.", "Jul.", "Aug.", "Sep.", "Oct.", "Nov.", "Dec."];
            date = new Date(d);
            month = monthNames[date.getMonth()]

            return month + ' ' + date.getDate() + ', ' + date.getYear();
        }
        function discardform(_this,add){
            $section = $(_this).parents('section');
            if($section){
                $section = $(_this).attr('href');
            }
            $(_this).parents('form').parent().remove();
            $(add).show();
            checkforsurvivors($section);
        }
        /* Validating Form */
            //Personal

                $('form#candidate-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);

                    // Clear Error Highlights before submission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).addClass('disabled');

                    //Send Ajax Request
                    $.ajax({
                        url : "/ajax/validate_personal_form/",
                        type: 'post',
                        data: formdata,
                        complete: function(data){
                            //Revert buttons back to original
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if (data.success == true){
                                //Hide form and show details
                                $('.personal-profile').collapse('toggle');
                                //Update each field
                                $('#profile_name').html($('#id_first_name').val() + ' ' + $('#id_last_name').val());
                                if($('#id_birthday').val()){
                                    $('#profile_birthday').html(toreadabledate($('#id_birthday').val()));
                                    $('#profile_birthday').parent().removeClass('hidden');
                                }
                                else {
                                    $('#profile_birthday').html('Not Provided');
                                    $('#profile_birthday').parent().addClass('hidden');                                    
                                }
                                if($('#id_gender').val()){
                                    $('#profile_gender').html($('#id_gender option:selected').text());
                                        $('#profile_gender').parent().removeClass('hidden');
                                }
                                else {
                                    $('#profile_gender').html('Not Provided');
                                    $('#profile_gender').parent().addClass('hidden');
                                }
                                if($('#id_maritalStatus').val()){
                                    $('#profile_marital_status').html($('#id_maritalStatus option:selected').text());
                                    $('#profile_marital_status').parent().removeClass('hidden');
                                }
                                else {
                                    $('#profile_marital_status').html('Not Provided');
                                    $('#profile_marital_status').parent().addClass('hidden');
                                }
                                // $('#profile_image')
                                window.location.hash = '#profile';
                                alert(data.msg);
                            }
                            else if (data.errors){ 
                                //Handle Errors
                                // Show errors for all fields available
                                if ('first_name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_first_name]');
                                    console.log(data.errors.first_name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_first_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.first_name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('last_name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_last_name]');
                                    console.log(data.errors.last_name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_last_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.last_name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('gender' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_gender]');
                                    console.log(data.errors.gender)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_gender').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.gender).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('birthday' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_birthday]');
                                    console.log(data.errors.birthday)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_birthday').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.birthday).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('maritalStatus' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_maritalStatus]');
                                    console.log(data.errors.maritalStatus)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_maritalStatus').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.maritalStatus).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('min_salary' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_min_salary]');
                                    console.log(data.errors.min_salary)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_min_salary').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.min_salary).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('max_salary' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_max_salary]');
                                    console.log(data.errors.max_salary)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_max_salary').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.max_salary).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('travel' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_travel]');
                                    console.log(data.errors.travel)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_travel').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.travel).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('residence' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_residence]');
                                    console.log(data.errors.residence)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_residence').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.residence).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },  
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                });

            //Contact

                $('form#contact-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);

                    // Clear Error Highlights before submission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).addClass('disabled');

                    //Send Ajax Request
                    $.ajax({
                        url : "/ajax/validate_contact_form/",
                        type: 'post',
                        data: formdata,
                        complete: function(data){
                            //Revert buttons back to original
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if (data.success == true){
                                //Hide form and show details
                                $('.contact').collapse('toggle');
                                //Update each field
                                if($('#id_city').val() || $('#id_state').val() || $('#id_nationality').val()){
                                    $('#profile_address').html($('#id_city').val() + ', ' + $('#id_state').val()  + ', ' + $('#id_nationality option:selected').text());
                                    $('#profile_address').parent().removeClass('hidden');                                   
                                }
                                else {
                                    $('#profile_address').parent().addClass('hidden');                                  
                                }
                                if($('#id_phone').val()){                        
                                    $('#profile_phone').html(' ' + $('#id_phone').val().replace('-','').splice(3,0,'-').splice(7,0,'-'));
                                    $('#profile_phone').parent().removeClass('hidden');
                                }
                                else {
                                    $('#profile_phone').parent().addClass('hidden');
                                }
                                if($('#id_cellphone').val()){
                                    $('#profile_cellphone').html(' ' +$('#id_cellphone').val().replace('-','').splice(3,0,'-').splice(7,0,'-'));
                                    $('#profile_cellphone').parent().removeClass('hidden');               
                                }
                                else {
                                    $('#profile_cellphone').parent().addClass('hidden');
                                }
                                if($('#id_twitter').val()){
                                    $('#profile_twitter').attr('href','http://twitter.com/'+$('#id_twitter').val().replace('@',''));
                                    $('#profile_twitter').removeClass('hidden');
                                    $('#profile_twitter').parents('.social-icons').removeClass('hidden');
                                }
                                else {
                                    $('#profile_twitter').addClass('hidden');
                                }
                                if($('#id_facebook').val()){
                                    $('#profile_facebook').attr('href',$('#id_facebook').val());
                                    $('#profile_facebook').removeClass('hidden');
                                    $('#profile_facebook').parents('.social-icons').removeClass('hidden');
                                }
                                else {
                                    $('#profile_facebook').addClass('hidden');
                                }
                                if($('#id_linkedin').val()){
                                    $('#profile_linkedin').attr('href',$('#id_linkedin').val());
                                    $('#profile_linkedin').removeClass('hidden');
                                    $('#profile_linkedin').parents('.social-icons').removeClass('hidden');
                                }
                                else {
                                    $('#profile_linkedin').addClass('hidden');
                                }
                                if($('#id_google').val()){
                                    $('#profile_google').attr('href',$('#id_google').val());
                                    $('#profile_google').removeClass('hidden');
                                    $('#profile_google').parents('.social-icons').removeClass('hidden');
                                }
                                else {
                                    $('#profile_google').addClass('hidden');
                                }
                                // $('#profile_image')
                                window.location.hash = '#contact-section';
                                alert(data.msg);
                            }
                            else if (data.errors){ 
                                //Handle Errors
                                // Show errors for all fields available
                                if ('nationality' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_nationality]');
                                    console.log(data.errors.nationality)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_nationality').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.nationality).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('state' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_state]');
                                    console.log(data.errors.state)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_state').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.state).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('city' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_city]');
                                    console.log(data.errors.city)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_city').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.city).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('phone' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_phone]');
                                    console.log(data.errors.phone)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_phone').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.phone).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('cellphone' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_cellphone]');
                                    console.log(data.errors.cellphone)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_cellphone').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.cellphone).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('linkedin' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_linkedin]');
                                    console.log(data.errors.linkedin)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_linkedin').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.linkedin).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('facebook' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_facebook]');
                                    console.log(data.errors.facebook)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_facebook').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.facebook).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('twitter' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_twitter]');
                                    console.log(data.errors.twitter)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_twitter').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.twitter).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('google' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_google]');
                                    console.log(data.errors.google)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_google').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.google).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },  
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                });
            
            //Objective

                $('form#objective-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this)

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');

                    // Send Ajax request
                    $.ajax({
                        url: '/ajax/validate_objective_form/',
                        type:'post',
                        data:formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel')
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled'); 
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.objective-skills').collapse('toggle');
                                // Update each field
                                $('#profile_objective').html($('#id_objective').val());
                                skills = $('#id_skills').val().split(',');
                                $('#profile_skills').html('');
                                $(skills).each(function(k,el){
                                    html  = '<div class="col-md-4 mb10"><i class="material-icons">label</i> <span class="va-top">'+el+'</span></div>';
                                    $('#profile_skills').append(html);
                                });
                                window.location.hash = '#objective-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('objective' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_objective]');
                                    console.log(data.errors.objective)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_objective').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.objective).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('skills' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_skills]');
                                    console.log(data.errors.skills)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_skills').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.skills).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                });

            //Interests
                $('form#interests-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);
                    //Clear Error Highlights before Submisison
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    formdata[1].value = CKEDITOR.instances['id_interests'].getData();
                    // console.log(formdata)
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).removeClass('disabled');
                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_interests_form/',
                        type: 'post',
                        data: formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false).removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.interests').collapse('toggle');
                                // Update each field
                                $('#profile_interests').html($('#id_interests').val());
                                window.location.hash = '#interests-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('interests' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_interests]');
                                    console.log(data.errors.interests)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_interests').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.interests).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }

                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false; 
                });

            //Hobbies
                $('form#hobbies-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);
                    //Clear Error Highlights before Submisison
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    formdata[1].value = CKEDITOR.instances['id_hobbies'].getData();
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).removeClass('disabled');
                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_hobbies_form/',
                        type: 'post',
                        data: formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false).removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.hobbies').collapse('toggle');
                                // Update each field
                                $('#profile_hobbies').html($('#id_hobbies').val());
                                window.location.hash = '#hobbies-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('hobbies' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_hobbies]');
                                    console.log(data.errors.hobbies)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_hobbies').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.hobbies).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }

                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false; 
                });

            //Extra_curriculars
                $('form#extra_curriculars-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);
                    //Clear Error Highlights before Submisison
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    formdata[1].value = CKEDITOR.instances['id_extra_curriculars'].getData();
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).removeClass('disabled');
                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_extra_curriculars_form/',
                        type: 'post',
                        data: formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false).removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.extra_curriculars').collapse('toggle');
                                // Update each field
                                $('#profile_extra_curriculars').html($('#id_extra_curriculars').val());
                                window.location.hash = '#extra-curriculars-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('extra_curriculars' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_extra_curriculars]');
                                    console.log(data.errors.extra_curriculars)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_extra_curriculars').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.extra_curriculars).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }

                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false; 
                });

            //Others
                $('form#others-form').submit(function(e){
                    e.preventDefault();
                    $this = $(this);
                    //Clear Error Highlights before Submisison
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    //Parse data for submission
                    var formdata = $(this).serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    formdata[1].value = CKEDITOR.instances['id_others'].getData();
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).removeClass('disabled');
                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_others_form/',
                        type: 'post',
                        data: formdata,
                        complete: function(){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false).removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                // Hide form and show details
                                $('.others').collapse('toggle');
                                // Update each field
                                $('#profile_others').html($('#id_others').val());
                                window.location.hash = '#others-section';
                                alert(data.msg);
                            }
                            else {
                                //show errors
                                if ('others' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_others]');
                                    console.log(data.errors.others)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_others').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.others).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }

                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false; 
                });

            //Experience
                function update_experience(_this,e){
                    $this = $(_this);
                    // alert('submitting');
                    e.preventDefault();

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    id = $this.data('id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id','value':id})

                    //Send Ajax Request
                    $.ajax({
                        url: '/ajax/validate_experience_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                                $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                                $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                                $this.find('.btn').prop('disabled',false);
                                $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.experience-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    // $this = $(q + '.form-row');
                                    $row.find('.experience_company').html($this.find('#id_company').val());
                                    // $row.find('.experience_industry').html($this.find('#id_industry option:selected').text());
                                    $row.find('.experience_employment').html($this.find('#id_employment').val());
                                    var duration="--";
                                    $row.find('.experience_duration').html(duration);
                                    $row.find('.experience_tasks').html($this.find('#id_tasks').val());
                                    city = $this.find('#id_city').val()
                                    state = $this.find('#id_state').val()
                                    address=""
                                    if(city){
                                        address = city + ', ';
                                    }
                                    if(state){
                                        address += state + ', ';
                                    }
                                    $row.find('.experience_location').html(address + $this.find('#id_country option:selected').text())
                                    startdate = toreadabledate($this.find('#id_start_date').val());
                                    endddate = toreadabledate($this.find('#id_end_date').val());
                                    if ($this.find('#id_present').val() == "on") {
                                        enddate = "Current Job";
                                    }
                                    $row.find('.experience_date').html(startdate + ' - ' + enddate);
                                }
                                else {
                                    // q='.experience-form-0:not(';
                                    // $(q).collapse('toggle');
                                    // $this = $(q);
                                    city = $this.find('#id_city').val()
                                    state = $this.find('#id_state').val()
                                    address=""
                                    if(city){
                                        address = city + ', ';
                                    }
                                    if(state){
                                        address += state + ', ';
                                    }
                                    address += $this.find('#id_country option:selected').text();
                                    startdate = toreadabledate($this.find('#id_start_date').val());
                                    enddate = toreadabledate($this.find('#id_end_date').val());
                                    if ($this.find('#id_status').val() == 5) {
                                        enddate = "ongoing";
                                    }
                                    var removefunction = "remove_experience('"+$this.find('#id_course_name').val()+"', '"+data.del_url+"')";
                                    removefunction = '<a href type="button" data-toggle="modal" data-target="#del-experience-modal" onclick="'+removefunction+'">'+ ' Remove';
                                    console.log(removefunction)
                                    html = '<div class="row experience-form-'+data.id+' collapse fade in">'+
                                                '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                    '<h4 class="pl15 pr15">'+
                                                        '<i class="fa fa-briefcase"></i> <span class="experience_employment">'+$this.find('#id_employment').val()+'</span>'+
                                                        ' | <small>'+
                                                            '<a data-toggle="collapse" data-target=".experience-form-'+data.id+'" class="clickable">Update</a>'+
                                                            ' - '+
                                                            '<a class="clickable remove-card" data-card=".experience-form-'+data.id+'" data-card-type="experience"> Remove</a>'+
                                                        '</small>'+
                                                        '<small class="pull-right hidden"><i class="fa fa-clock-o"></i> <span class="experience_duration">'+$this.find('#id_start_date').val()+'</span></small>'+
                                                    '</h4>'+
                                                    '<div class="container-fluid">'+
                                                        '<div class="row">'+
                                                            '<div class="col-md-6">'+
                                                                '<h4 class=""><i class="fa fa-building"></i> <span class="#experience_company">'+$this.find('#id_company').val()+'</span></h4>'+
                                                                '<span><i class="fa fa-map-marker"></i> <span class="experience_location">'+address+'</span></span>'+
                                                            '</div>'+
                                                            '<div class="col-md-6 text-right pt10">'+
                                                                '<small class=""><i class="fa fa-calendar"></i> <span class="experience_date">'+startdate + ' - ' + enddate+'</span></small>'+
                                                            '</div>'+
                                                        '</div>'+
                                                        '<p class="mt10"><span class="experience_tasks">'+$this.find('#id_tasks').val()+'</span></p>'
                                                    '</div>'+
                                                '</div>'+
                                            '</div>';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','experience-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('experience-form-0 in');
                                    $this.parent().addClass('experience-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-toggle','.experience-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_experience_form').show();
                                }
                                window.location.hash = '#experience-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('company' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_company]');
                                    console.log(data.errors.company)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_company').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.company).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('industry' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_industry]');
                                    console.log(data.errors.industry)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_industry').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.industry).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('country' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_country]');
                                    console.log(data.errors.country)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_country').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.country).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('employment' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_employment]');
                                    console.log(data.errors.employment)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_employment').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.employment).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('tasks' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_tasks]');
                                    console.log(data.errors.tasks)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_tasks').parent().addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.tasks).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('end_date' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_end_date]');
                                    console.log(data.errors.end_date)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_end_date').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.end_date).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('city' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_city]');
                                    console.log(data.errors.city)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_city').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.city).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('state' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_state]');
                                    console.log(data.errors.state)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_state').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.state).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('start_date' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_start_date]');
                                    console.log(data.errors.start_date)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_start_date').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.start_date).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            } 
                            else if (data.msg) {
                                alert(data.msg)
                            }  
                        },
                        error: function(e){
                            console.log(e);
                        }
                    })
                }
                $('form[id^=experience-form]').submit(function(e){update_experience(this,e);});
                $('.add_experience_form').click(function(){
                    $(this).hide();
                    experience_form = $('#experience_form').clone();
                    experience_form.attr('id','');
                    experience_form.addClass('in form-row');
                    experience_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    })
                    experience_form.find('#id_start_date').datepicker(dpicker);
                    experience_form.find('#id_end_date').datepicker(dpicker);
                    experience_form.find('#id_present').change(experience_ongoing);
                    experience_form.insertAfter($('#experience_form'));
                    $('.form-row #experience-form-0').submit(function(e){update_experience(this,e)});
                });
            
            //Academic
                function update_academic(_this,e){
                    $this = $(_this);
                    e.preventDefault();
                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');
                    // Pars data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    //Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    var id = $this.attr('data-id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id', 'value':id})
                    //Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_academic_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.academic-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    // $this = $(q + '.form-row');
                                    $row.find('.academic_coursename').html($this.find('#id_course_name').val()+', '+$this.find('#id_area').val());
                                    $row.find('.academic_degree').html($this.find('#id_degree option:selected').text());
                                    $row.find('.academic_status').html($this.find('#id_status option:selected').text());
                                    $row.find('.academic_school').html($this.find('#id_school').val());
                                    city = $this.find('#id_city').val()
                                    state = $this.find('#id_state').val()
                                    address=""
                                    if(city){
                                        address = city + ', ';
                                    }
                                    if(state){
                                        address += state + ', ';
                                    }
                                    $row.find('.academic_location').html(address + $this.find('#id_country option:selected').text())
                                    startdate = toreadabledate($this.find('#id_start_date').val());
                                    if ($this.find('#id_status').val() == 5) {
                                        enddate = "ongoing";
                                    }
                                    else {
                                        endddate = toreadabledate($this.find('#id_end_date').val());
                                    }
                                    $row.find('.academic_date').html(startdate + ' - ' + enddate);
                                }
                                else {
                                    // q='.academic-form-0:not(';
                                    // $(q).collapse('toggle');
                                    // $this = $(q);
                                    city = $this.find('#id_city').val()
                                    state = $this.find('#id_state').val()
                                    address=""
                                    if(city){
                                        address = city + ', ';
                                    }
                                    if(state){
                                        address += state + ', ';
                                    }
                                    startdate = toreadabledate($this.find('#id_start_date').val());
                                    enddate = toreadabledate($this.find('#id_end_date').val());
                                    if ($this.find('#id_status').val() == 5) {
                                        enddate = "ongoing";
                                    }
                                    html = '<div class="row academic-form-'+data.id+' collapse fade in">'+
                                                '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                    '<h4 class="pl15 pr15">'+
                                                        '<i class="fa fa-certificate"></i> <span class="academic_coursename">'+$this.find('#id_course_name').val()+', '+$this.find('#id_area').val()+'</span>'+
                                                        ' | <small>'+
                                                            '<a data-toggle="collapse" data-target=".academic-form-'+data.id+'" class="clickable">Update</a>'+
                                                            ' - '+
                                                            '<a class="clickable remove-card" data-card=".academic-form-'+data.id+'" data-card-type="academic"> Remove</a>'+
                                                        '</small>'+
                                                        '<small class="pull-right"><i class="fa fa-flag-checkered"></i> <span class="academic_status">'+$this.find('#id_status option:selected').text()+'</span></small>'+
                                                    '</h4>'+
                                                    '<h5 class="pl15 pr15 no-margin-bottom"><i class="fa fa-mortar-board"></i> <span class="academic_degree">'+$this.find('#id_degree option:selected').text()+'</span></h5>'+
                                                    '<div class="container-fluid">'+
                                                        '<div class="row">'+
                                                            '<div class="col-md-6">'+
                                                                '<h5 class=""><i class="fa fa-university"></i> <span class="academic_school">'+$this.find('#id_school').val()+'</span></h5>'+
                                                                '<span><i class="fa fa-map-marker"></i> <span class="academic_location">'+address + $this.find('#id_country option:selected').text()+'</span></span>'+
                                                            '</div>'+
                                                            '<div class="col-md-6 text-right pt10">'+
                                                                '<small class=""><i class="fa fa-calendar"></i> <span class="academic_date">'+startdate + ' - ' + enddate+'</span></small>'+
                                                            '</div>'+
                                                        '</div>'+
                                                    '</div>'+
                                                '</div>'+
                                            '</div>';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','training-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('academic-form-0 in');
                                    $this.parent().addClass('academic-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.academic-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_academic_form').show();
                                }
                                window.location.hash = '#academic-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('area' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_area]');
                                    console.log(data.errors.area)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_area').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.area).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('course_name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_course_name]');
                                    console.log(data.errors.course_name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_course_name').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.course_name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('degree' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_degree]');
                                    console.log(data.errors.degree)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_degree').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.degree).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('city' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_city]');
                                    console.log(data.errors.city)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_city').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.city).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('country' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_country]');
                                    console.log(data.errors.country)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_country').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.country).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('end_date' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_end_date]');
                                    console.log(data.errors.end_date)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_end_date').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.end_date).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('school' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_school]');
                                    console.log(data.errors.school)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_school').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.school).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('state' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_state]');
                                    console.log(data.errors.state)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_state').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.state).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('start_date' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_start_date]');
                                    console.log(data.errors.start_date)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_start_date').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.start_date).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('status' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_status]');
                                    console.log(data.errors.status)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_status').parents('.input-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.status).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            } 
                            else if (data.msg) {
                                alert(data.msg)
                            }  
                        },
                        error: function(e){
                            console.log(e);
                        }
                    })
                }
                $('[id^=academic-form]').submit(function(e){update_academic(this,e)});
                $('.add_academic_form').click(function(){
                    $(this).hide();
                    academic_form = $('#academic_form').clone();
                    academic_form.attr('id','');
                    academic_form.addClass('in form-row');
                    academic_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct'))
                        {
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    })
                    academic_form.find('#id_start_date').datepicker(dpicker);
                    academic_form.find('#id_end_date').datepicker(dpicker);
                    academic_form.find('#id_status').change(academic_status_change);
                    academic_form.insertAfter($('#academic_form'));
                    $('.form-row #academic-form-0').submit(function(e){update_academic(this,e)});
                });

            //Training
                function update_training(_this,e){
                    $this = $(_this);
                        // alert('submitting');
                        e.preventDefault();
                        // Clear Error Highlights before SUbmission
                        $this.find('.error-list').remove();
                        $this.find('.has-error').removeClass('has-error');
                        // Parse data for submission
                        var formdata = $this.serializeArray();
                        formdata.push({'name':'isPublic','value':false})
                        // Disable buttons
                        $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                        $this.find('.btn').prop('disabled',true);
                        $this.find('.btn').removeClass('disabled');
                        id = $this.data('id');
                        if(!id){
                            id=0;
                        }
                        formdata.push({'name':'id','value':id})
                        // Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_training_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.training-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    $row.find('.training_name').html($this.find('#id_name').val());
                                    $row.find('.training_description').html($this.find('#id_description').val());
                                }
                                else {
                                    name = $this.find('#id_name').val()
                                    description = $this.find('#id_description').val()
                                    html =  '<div class="row training-form-'+data.id+' collapse fade in">'+
                                            '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                '<h4 class="pl15 pr15">'+
                                                    '<i class="fa fa-certificate"></i> <span class="training_name">'+name+'</span>'+
                                                    ' | <small>'+
                                                        '<a data-toggle="collapse" data-target=".training-form-'+data.id+'" class="clickable">Update</a>'+
                                                        ' - '+
                                                        '<a class="clickable remove-card" data-card=".training-form-'+data.id+'" data-card-type="training"> Remove</a>'+
                                                    '</small>'+
                                                '</h4>'+
                                                '<div class="container-fluid">'+
                                                    '<div class="row">'+
                                                        '<div class="col-md-12">'+
                                                            '<p class="training_description">'+description+'</p>'+
                                                        '</div>'+
                                                    '</div>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div> ';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','training-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('training-form-0 in');
                                    $this.parent().addClass('training-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.training-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_training_form').show();
                                }
                                window.location.hash = '#training-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_name]');
                                    console.log(data.errors.name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('description' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_description]');
                                    console.log(data.errors.description)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_description').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.description).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }   
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                }
                $('form[id^=training-form]').submit(function(e){update_training(this,e)});
                $('.add_training_form').click(function(){
                    $(this).hide();
                    training_form = $('#training_form').clone();
                    training_form.attr('id','');
                    training_form.addClass('in form-row');
                    training_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    });
                    training_form.insertAfter($('#training_form'));
                    $('.form-row #training-form-0').submit(function(e){update_training(this,e)});
                });

            //Certificate

                function update_certificate(_this,e){
                    $this = $(_this);
                    // alert('submitting');
                    e.preventDefault();

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    id = $this.data('id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id','value':id})

                    // Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_certificate_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.certificate-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    $row.find('.certificate_name').html($this.find('#id_name').val());
                                    $row.find('.certificate_description').html($this.find('#id_description').val());
                                }
                                else {
                                    // q='.certificate-form-0:not(';
                                    // $(q).collapse('toggle');
                                    // $this = $(q);
                                    name = $this.find('#id_name').val()
                                    description = $this.find('#id_description').val()
                                    html =  '<div class="row certificate-form-'+data.id+' collapse fade in">'+
                                            '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                '<h4 class="pl15 pr15">'+
                                                    '<i class="fa fa-certificate"></i> <span class="certificate_name">'+name+'</span>'+
                                                    ' | <small>'+
                                                        '<a data-toggle="collapse" data-target=".certificate-form-'+data.id+'" class="clickable">Update</a>'+
                                                        ' - '+
                                                        '<a class="clickable remove-card" data-card=".certificate-form-'+data.id+'" data-card-type="certificate"> Remove</a>'+
                                                        '</a>'+
                                                    '</small>'+
                                                '</h4>'+
                                                '<div class="container-fluid">'+
                                                    '<div class="row">'+
                                                        '<div class="col-md-12">'+
                                                            '<p class="certificate_description">'+description+'</p>'+
                                                        '</div>'+
                                                    '</div>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div> ';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','certificate-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('certificate-form-0 in');
                                    $this.parent().addClass('certificate-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.certificate-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_certificate_form').show();
                                }
                                window.location.hash = '#certificate-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_name]');
                                    console.log(data.errors.name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('description' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_description]');
                                    console.log(data.errors.description)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_description').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.description).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }   
                            else if (data.msg) {
                                alert(data.msg)
                            }

                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                }
                $('form[id^=certificate-form]').submit(function(e){update_certificate(this,e)});
                $('.add_certificate_form').click(function(){
                    $(this).hide();
                    certificate_form = $('#certificate_form').clone();
                    certificate_form.attr('id','');
                    certificate_form.addClass('in form-row');
                    certificate_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    });
                    certificate_form.insertAfter($('#certificate_form'));
                    $('.form-row #certificate-form-0').submit(function(e){update_certificate(this,e)});
                });

            //Project

                function update_project(_this,e){
                    $this = $(_this);
                    // alert('submitting');
                    e.preventDefault();

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    id = $this.data('id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id','value':id})

                    // Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_project_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.project-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    $row.find('.project_name').html($this.find('#id_name').val());
                                    $row.find('.project_description').html($this.find('#id_description').val());
                                }
                                else {
                                    // q='.project-form-0:not(';
                                    // $(q).collapse('toggle');
                                    // $this = $(q);
                                    name = $this.find('#id_name').val()
                                    description = $this.find('#id_description').val()
                                    html =  '<div class="row project-form-'+data.id+' collapse fade in">'+
                                            '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                '<h4 class="pl15 pr15">'+
                                                    '<i class="fa fa-certificate"></i> <span class="project_name">'+name+'</span>'+
                                                    ' | <small>'+
                                                        '<a data-toggle="collapse" data-target=".project-form-'+data.id+'" class="clickable">Update</a>'+
                                                        ' - '+
                                                        '<a class="clickable remove-card" data-card=".project-form-'+data.id+'" data-card-type="project"> Remove</a>'+
                                                        '</a>'+
                                                    '</small>'+
                                                '</h4>'+
                                                '<div class="container-fluid">'+
                                                    '<div class="row">'+
                                                        '<div class="col-md-12">'+
                                                            '<p class="project_description">'+description+'</p>'+
                                                        '</div>'+
                                                    '</div>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div> ';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.attr('id','project-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.parent().removeClass('project-form-0 in');
                                    $this.parent().addClass('project-form-'+data.id);
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.project-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_project_form').show();
                                }
                                window.location.hash = '#project-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('name' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_name]');
                                    console.log(data.errors.name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('description' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_description]');
                                    console.log(data.errors.description)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_description').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.description).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }   
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                }
                $('form[id^=project-form]').submit(function(e){update_project(this,e)});
                $('.add_project_form').click(function(){
                    $(this).hide();
                    project_form = $('#project_form').clone();
                    project_form.attr('id','');
                    project_form.addClass('in form-row');
                    project_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    });
                    project_form.insertAfter($('#project_form'));
                    $('.form-row #project-form-0').submit(function(e){update_project(this,e)});
                });

            //Language
                function update_language(_this,e){
                    $this = $(_this);
                    // alert('submitting');
                    e.preventDefault();

                    // Clear Error Highlights before SUbmission
                    $this.find('.error-list').remove();
                    $this.find('.has-error').removeClass('has-error');

                    // Parse data for submission
                    var formdata = $this.serializeArray();
                    formdata.push({'name':'isPublic','value':false})
                    console.log(formdata)

                    // Disable buttons
                    $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg "></i> Please Wait');
                    $this.find('.btn').prop('disabled',true);
                    $this.find('.btn').removeClass('disabled');
                    id = $this.data('id');
                    if(!id){
                        id=0;
                    }
                    formdata.push({'name':'id','value':id})

                    // Send Ajax request
                    $.ajax({
                        url:'/ajax/validate_language_form/',
                        type:'post',
                        data:formdata,
                        complete: function(data){
                            $this.find('.btn-info').html('<i class="fa fa-check-circle fa-lg"></i> Save and Update');
                            $this.find('.btn-default').html('<i class="fa fa-chevron-circle-left fa-lg"></i> Cancel');
                            $this.find('.btn').prop('disabled',false);
                            $this.find('.btn').removeClass('disabled');
                        },
                        success: function(data){
                            console.log(data);
                            if(data.success == true){
                                if(id>0){
                                    q = '.language-form-'+id
                                    $(q).collapse('toggle');
                                    $row = $(q + ':not(.form-row)');
                                    $row.find('.language_name').html($this.find('#id_language option:selected').text());
                                    level = []
                                    if ($this.find('#id_read')[0].checked){
                                        level.push('Read')
                                    }
                                    if ($this.find('#id_write')[0].checked){
                                        level.push('Write')
                                    }
                                    if ($this.find('#id_speak')[0].checked){
                                        level.push('Speak')
                                    }
                                    level = level.join();
                                    $row.find('.language_level').html(level);
                                    
                                }
                                else{
                                    level = []
                                    if ($this.find('#id_read')[0].checked){
                                        level.push('Read')
                                    }
                                    if ($this.find('#id_write')[0].checked){
                                        level.push('Write')
                                    }
                                    if ($this.find('#id_speak')[0].checked){
                                        level.push('Speak')
                                    }
                                    level = level.join();
                                    html = '<div class="row language-form-'+data.id+' collapse fade in">'+
                                                '<div class="container-fluid bg-white border-bottom border-light br-2 pt20 pb20 pr20 pl20">'+
                                                    '<h4 class="pl15 pr15">'+
                                                        '<i class="fa fa-language"></i> <span class="language_name">'+$this.find('#id_language option:selected').text()+'</span>'+
                                                        ' | <small>'+
                                                            '<a data-toggle="collapse" data-target=".language-form-'+data.id+'" class="clickable">Update</a>'+
                                                            ' - '+
                                                            '<a class="clickable remove-card" data-card=".language-form-'+data.id+'" data-card-type="language"> Remove</a>'+
                                                        '<small class="pull-right"><i class="fa fa-flag-checkered"></i> <span class="language_level">'+level+'</span></small>'+
                                                    '</h4>'+
                                                '</div>'+
                                            '</div>';
                                    $card = $(html).insertBefore($this.parent());
                                    $this.attr('data-id',data.id);
                                    $this.attr('action',$this.attr('action')+data.id+'/');
                                    $this.parent().removeClass('language-form-0 in');
                                    $this.parent().addClass('language-form-'+data.id);
                                    $this.attr('id','language-form-'+data.id);
                                    $card.find('.remove-card').click(function(){removeCard(this);});
                                    $this.find('.form-destruct').unbind('click');
                                    $this.find('.form-destruct').attr('data-toggle','collapse');
                                    $this.find('.form-destruct').attr('data-target','.language-form-'+data.id);
                                    $this.find('.form-destruct').removeClass('form-destruct');
                                    $('.add_language_form').show();
                                }
                                window.location.hash = '#language-section';
                                alert(data.msg);
                            }
                            else  if (data.errors) {
                                //Show error
                                if ('language' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_name]');
                                    console.log(data.errors.name)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_name').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.name).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('read' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_read]');
                                    console.log(data.errors.read)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_read').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.read).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('write' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_write]');
                                    console.log(data.errors.write)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_write').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.write).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                                if ('speak' in data.errors)
                                {
                                    html = "<ul class = 'error-list text-danger'></ul>"
                                    label = $this.find('[for=id_speak]');
                                    console.log(data.errors.speak)
                                    $elist = $(html).insertAfter($(label).next());
                                    $this.find('#id_speak').parents('.form-group').addClass('has-error')
                                    console.log($elist)
                                    $(data.errors.speak).each(function(k,v){
                                        $elist.append('<li>'+v+'</li>');
                                        // $this.find(
                                    });
                                }
                            }   
                            else if (data.msg) {
                                alert(data.msg)
                            }
                        },
                        error: function(e){
                            console.log(e);
                        }
                    });
                    return false;
                }
                $('form[id^=language-form]').submit(function(e){update_language(this,e)});
                $('.add_language_form').click(function(){
                    $(this).hide();
                    language_form = $('#language_form').clone();
                    language_form.attr('id','');
                    language_form.addClass('in form-row');
                    language_form.find('.form-destruct').click(function(){
                        if($(this).hasClass('form-destruct')){
                            add = $(this).parents('section').find('.form-add');
                            discardform(this,add);
                        }
                    });
                    language_form.insertAfter($('#language_form'));
                    $('.form-row #language-form-0').submit(function(e){update_language(this,e)});
                });
            $('#remove-modal').on('hidden.bs.modal',function(){
                $(this).find('.remove').data('card-type','').data('card','');
                $(this).find('.header').html('');
                $(this).find('.msg').html('');
                $(this).find('.btn').html('Remove').prop('disabled',false).removeClass('disabled');
                $(this).find('button').html('Cancel');
            });
            $('#remove-modal .remove').click(function(){
                $this = $(this).parents('.modal');
                $this.find('.btn').html('<i class="fa fa-pulse fa-spinner fa-lg"></i> Please Wait').prop('disabled',true).addClass('disabled');
                cardtype = $(this).attr('data-card-type');
                cardclass = $(this).attr('data-card');
                console.log(cardtype);
                console.log(cardclass);
                id = cardclass.replace('.'+cardtype+'-form-','')
                console.log(id);
                $.ajax({
                    url: "/ajax/delete_section/",
                    type:'post',
                    data: {
                        id: id,
                        type: cardtype,
                    },
                    complete: function(){
                        $this.find('.btn').html('Remove').prop('disabled',false).removeClass('disabled');
                        $this.find('button').html('Cancel');
                    },
                    success: function(data){
                        console.log(data);
                        if (data.success){
                            $this.modal('hide');
                            $(cardclass).css('border-color:#337ab7');
                            setTimeout(function(){
                                $section = $(cardclass).parents('section');
                                $(cardclass).next('hr').remove();
                                $(cardclass).remove();
                                checkforsurvivors($section);
                            },1000);
                            alert(data.msg);
                        }
                        else {
                            if($this.hasClass('in')){
                                $this.find('msg').html(data.msg);
                                setTimeout(function(){
                                    $this.modal('hide');
                                },2000);
                            }
                            else {
                                alert(data.msg);
                            }
                        }
                    },
                    error: function(error){
                        console.log(error);
                    }
                })
            });
            function removeCard(_this){
                $this = $(_this);
                cardtype = $this.attr('data-card-type');
                cardclass = $this.attr('data-card');
                $('#remove-modal .header').html(cardtype);
                $('#remove-modal .remove').attr('data-card-type',cardtype).attr('data-card',cardclass);
                console.log($('#remove-modal .remove'))
                $('#remove-modal').modal('show');
                // $(cardclass).remove();
            }

        /*End Validation*/
        function checkforsurvivors($this){
            // console.log($this.find('.form-row').length)
            $this = $($this);
            if($this.find('.form-row').length == 0){
                $this.find('.no-card').collapse('show')
            }
        }
        $('.form-add').click(function(){
            $(this).parents('section').find('.no-card').collapse('hide');
        })
        
        String.prototype.splice = function(idx, rem, str) {
            return this.slice(0, idx) + str + this.slice(idx + Math.abs(rem));
        };
    </script>
    <script>
        {% if recruiter and vacancy.company|args:'JM_DURATION'|call:'check_service' %}
            var daterangeoptions = {
                "ranges": {
                    "Next 7 Days": [
                        moment(),
                        moment().add(6, 'days'),
                    ],
                    "Next 30 Days": [
                        moment(),
                        moment().add(29, 'days'),
                    ],
                    'This Month': [
                        moment().startOf('month'), 
                        moment().endOf('month')
                    ],
                    "Next Month": [
                        moment().add(1, 'month').startOf('month'),
                        moment().add(1, 'month').endOf('month')
                    ],
                    "Next 3 Months": [
                        moment().add(1, 'month').startOf('month'),
                        moment().add(3, 'month').endOf('month')
                    ],
                    "Next 6 Months": [
                        moment().add(1, 'month').startOf('month'),
                        moment().add(6, 'month').endOf('month')
                    ]
                },
                "autoApply": true,
                "drops": 'down',
                "autoUpdateInput": true,
                "alwaysShowCalendars": true,
                "startDate": moment(),
                "endDate": moment().add(29,'days'),
                "minDate": moment(),
                "opens": "center",
                "applyClass": "btn-info-inverse",
                "buttonClasses": "btn",
                "cancelLabel": 'Cancel'
            }
            $(document).ready(function(){
                $('#id_pub_date').daterangepicker(daterangeoptions);
            })
        {% endif %}
    </script>
    <script>
        var revoke = function(_this,code){
            $(_this).html('<i class="fa fa-spinner fa-pulse"></i> Please Wait...');
            $.ajax({
                data:{
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                url:'/ajax/revokesocial/' + code + '/',
                type: 'POST',
                complete: function(){

                },
                success: function(data){
                    if(data.success == true){
                        $('.refresh-smart-share').click();
                    }
                    if (data.msg){
                        alert(data.msg)
                    }
                },
                error: function(er){
                    console.log(er)
                }
            })
        }
    </script>
    <script>
        {% if not applicant.public_email and not applicant.user or candidate_form.errors or advanced_error or initial_missing or not applicant.full_name %}
            $(document).ready(function(){
                $('#edit-profile-modal').modal('show');
            })
        {% endif %}
    </script>
    <script>

        {%if not user.is_authenticated %}
            $('#loginform').submit(function(e){
                $this = $(this);
                e.preventDefault();
                var formdata = $this.serializeArray();
                console.log(formdata);
                var url = '{%url "ajax_login"%}';
                $this.find('.error-list').remove();
                $this.find('has-error').removeClass('has-error');
                $.ajax({
                    url:url,
                    type:'post',
                    data:formdata,
                    complete:function(data){
                        $this.find('.btn[type=submit]').html('<i class="fa fa-sign-in fa-lg mr5"></i> Login').prop('disabled',false).removeClass('disabled');

                    },
                    success:function(data){
                        console.log(data);
                        if(data.success == true)
                        {
                            // key = $this.data('key')
                            // if (key)
                            //     location.href = location.href+"?"+key +"=true"
                            location.href = '{% url "vacancies_new_application" vacancy.id %}' 
                        }
                        else {
                            $this.find('.form-control').parents('.input-group').addClass('has-error');
                            $this.prepend('<div class="alert alert-danger error-list">Invalid Username/Password</div>')
                        }
                    }
                })
                return false;
            });
            function changeloginredirect(key){
                $('#loginform').data('key',key)
            }
        {%endif%}
    </script>
    <script>
        $('.toggle-checkbox-card').click(function(e){
            if(!$(e.target).parents('.checkbox-card').length > 0){
                $(this).find('>.checkbox-card label').click();
            }
        });
        $('.toggle-checkbox-card>.checkbox-card input').change(function(){
            if($('.toggle-checkbox-card>.checkbox-card input:checked').length> 0){
                $('.checkbox-card-options').removeClass('hidden')
            }
            else {
                $('.checkbox-card-options').addClass('hidden')
            }
        });
        $('#delete_selected_cards').click(function(){
            $cards = $('.toggle-checkbox-card>.checkbox-card input:checked').parents('.resolution-card');
            if($cards.length> 0){
                $ids = [];
                $cards.each(function(i,$card){
                    $ids.push($($card).attr('data-id'))
                });
                $data = {
                        'ids': $ids,
                        'card_type': $cards.attr('data-type')
                    }
                console.log($data)
                $.ajax({
                    url: '/ajax/resolve_conflicts_delete/',
                    type: 'post',
                    data: $data,
                    success: function(data){
                        if (data.reload){
                            location.href = location.href.split('#')[0]
                        }
                        else if (data.msg){
                            alert(data.msg)
                        }
                    },
                    error: function(er){
                        console.log(er);
                    }
                })
            }
            else {
                alert('Select at least 1 card to remove')
            }

        })
        $('#merge_selected_cards').click(function(){
            $cards = $('.toggle-checkbox-card>.checkbox-card input:checked').parents('.resolution-card');
            if($cards.length> 1){
                $cards.each(function(i,$card){
                    if ($($card).hasClass('original-card')){
                        location.href=location.href.split('#')[0]
                    }
                });
            }
            else {
                alert('Select at least 2 cards to merge')
            }

        });
        $('#unconflict_selected_cards').click(function(){
            $cards = $('.toggle-checkbox-card>.checkbox-card input:checked').parents('.resolution-card');
            if($cards.length> 0){
                $ids = [];
                $cards.each(function(i,$card){
                    $ids.push($($card).attr('data-id'))
                });
                $data = {
                        'ids': $ids,
                        'card_type': $cards.attr('data-type')
                    }
                console.log($data)
                $.ajax({
                    url: '/ajax/resolve_conflicts_unconflict/',
                    type: 'post',
                    data: $data,
                    success: function(data){
                        if (data.reload){
                            location.href = location.href.split('#')[0]
                        }
                        else if (data.msg){
                            alert(data.msg)
                        }
                    },
                    error: function(er){
                        console.log(er);
                    }
                })
            }
            else {
                alert('Select at least 1 card to mark as not conflicting.')
            }
        });
    </script>
{% endblock %}